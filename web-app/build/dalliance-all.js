(function e$$0(u,s,l){function p(h,q){if(!s[h]){if(!u[h]){var y="function"==typeof require&&require;if(!q&&y)return y(h,!0);if(r)return r(h,!0);throw Error("Cannot find module '"+h+"'");}y=s[h]={exports:{}};u[h][0].call(y.exports,function(b){var a=u[h][1][b];return p(a?a:b)},y,y.exports,e$$0,u,s,l)}return s[h].exports}for(var r="function"==typeof require&&require,h=0;h<l.length;h++)p(l[h]);return p})({1:[function(c,u,s){function l(){}function p(e,d,t,n,q){function c(f){if(!f)return n(null,"Couldn't access BAM");
f=a(f,f.byteLength);f=new Uint8Array(f);var b=h(f,0);if(b!=k)return n(null,"Not a BAM file, magic=0x"+b.toString(16));for(var g=h(f,4),e="",b=0;b<g;++b)e+=String.fromCharCode(f[b+8]);e=h(f,g+8);g+=12;x.chrToIndex={};x.indexToChr=[];for(b=0;b<e;++b){for(var w=h(f,g),d="",A=0;A<w-1;++A)d+=String.fromCharCode(f[g+4+A]);h(f,g+w+4);x.chrToIndex[d]=b;0==d.indexOf("chr")?x.chrToIndex[d.substring(3)]=b:x.chrToIndex["chr"+d]=b;x.indexToChr.push(d);g=g+8+w}if(x.indices)return n(x)}var x=new l;x.data=e;x.bai=
d;x.indexChunks=t;var H=x.indexChunks?x.indexChunks.minBlockIndex:1E9;if(x.indexChunks){d=x.indexChunks.chunks;x.indices=[];for(var D=0;D<d.length;D++)x.indices[D]=null;x.data.slice(0,H).fetch(c)}else x.bai.fetch(function(f){var a,d,k;if(f){var w=new Uint8Array(f),J=h(w,0);if(J!=g)f=n(null,"Not a BAI file, magic=0x"+J.toString(16));else{J=h(w,4);x.indices=[];for(var A=8,I=0;I<J;++I){var m=A;a=w;var F=k=m;d=h(a,F);for(var F=F+4,R=0;R<d;++R){h(a,F);var G=h(a,F+4),F=F+(8+16*G)}for(var R=h(a,F),F=F+4,
G=1E9,D=F,V=0;V<R;++V){var r=b(a,D),D=D+8;if(r){a=r.block;0<r.offset&&(a+=65536);a<G&&(G=a);break}}F+=8*R;a=G;k=F-k;A+=k;H=Math.min(a,H);0<d&&(x.indices[I]=new Uint8Array(f,m,A-m))}f=!0}}else f="Couldn't access BAI";!0!==f?x.bai.url&&"undefined"===typeof q?(x.bai.url=x.data.url.replace(/.bam$/,".bai"),p(e,x.bai,t,n,!0)):n(null,f):x.data.slice(0,H).fetch(c)})}function r(){}if("undefined"!==typeof c){c("./spans");s=c("./bin");var h=s.readInt,v=s.readShort,q=s.readByte,y=s.readFloat;c=c("./lh3utils");
var b=c.readVob,a=c.unbgzf,n=c.reg2bins,d=c.Chunk}var k=21840194,g=21578050;c={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};l.prototype.blocksForRange=function(a,g,e){var t=this.indices[a];if(!t)return[];a=n(g,e);for(var k=[],q=0;q<a.length;++q)k[a[q]]=!0;a=[];for(var x=[],q=h(t,0),H=4,D=0;D<q;++D){var f=h(t,
H),z=h(t,H+4),H=H+8;if(k[f])for(var B=0;B<z;++B){var K=b(t,H),w=b(t,H+8);(4681>f?x:a).push(new d(K,w));H+=16}else H+=16*z}q=h(t,H);k=null;g=Math.min(g>>14,q-1);e=Math.min(e>>14,q-1);for(q=g;q<=e;++q)(g=b(t,H+4+8*q))&&(!k||g.block<k.block||g.offset<k.offset)&&(k=g);t=[];if(null!=k)for(q=0;q<x.length;++q)e=x[q],e.maxv.block>=k.block&&e.maxv.offset>=k.offset&&t.push(e);x=t;t=[];for(q=0;q<x.length;++q)t.push(x[q]);for(q=0;q<a.length;++q)t.push(a[q]);t.sort(function(w,f){var b=w.minv.block-f.minv.block;
return 0!=b?b:w.minv.offset-f.minv.offset});a=[];if(0<t.length){x=t[0];for(q=1;q<t.length;++q)e=t[q],e.minv.block==x.maxv.block?x=new d(x.minv,e.maxv):(a.push(x),x=e);a.push(x)}return a};l.prototype.fetch=function(b,g,e,d,t){function n(){if(B>=D.length)return d(z);if(K){var w=new Uint8Array(K),w=k.readBamRecords(w,D[B].minv.offset,z,g,e,q,t);K=null;++B;return w?d(z):n()}var f=D[B],w=f.minv.block;k.data.slice(w,f.maxv.block+65536-w).fetch(function(w){K=a(w,f.maxv.block-f.minv.block+1);return n()})}
var k=this;t=t||{};var q=this.chrToIndex[b],D;if(void 0===q)D=[];else{if(null===this.indices[q]&&this.indexChunks.chunks[q]){var f=this.indexChunks.chunks[q];return this.bai.slice(f[0],f[1]).fetch(function(f){f=new Uint8Array(f);this.indices[q]=f;return this.fetch(b,g,e,d,t)}.bind(this))}(D=this.blocksForRange(q,g,e))||d(null,"Error in index fetch")}var z=[],B=0,K;n()};var e="=ACxGxxxTxxxxxxN".split(""),t="MIDNSHP=X???????".split("");l.prototype.readBamRecords=function(b,a,g,d,n,k,x){for(;;){var c=
h(b,a),c=a+c+4;if(c>=b.length)return!1;var D=new r,f=h(b,a+4),z=h(b,a+8),B=h(b,a+12),K=(B&65280)>>8,w=B&255,B=h(b,a+16),J=(B&4294901760)>>16,A=B&65535,B=h(b,a+20),I=h(b,a+24),m=h(b,a+28);h(b,a+32);D.segment=this.indexToChr[f];D.flag=J;D.pos=z;D.mq=K;x.light&&(D.seqLength=B);if(!x.light){0<=I&&(D.nextSegment=this.indexToChr[I],D.nextPos=m);K="";for(z=0;z<w-1;++z)K+=String.fromCharCode(b[a+36+z]);D.readName=K;a=a+36+w;w="";for(z=0;z<A;++z)K=h(b,a),w=w+(K>>4)+t[K&15],a+=4;D.cigar=w;A="";w=B+1>>1;for(z=
0;z<w;++z)K=b[a+z],A+=e[(K&240)>>4],A+=e[K&15];a+=w;D.seq=A;A="";for(z=0;z<B;++z)A+=String.fromCharCode(b[a+z]+33);a+=B;for(D.quals=A;a<c;){A=String.fromCharCode(b[a],b[a+1]);w=String.fromCharCode(b[a+2]);if("A"==w)w=String.fromCharCode(b[a+3]),a+=4;else if("i"==w||"I"==w)w=h(b,a+3),a+=7;else if("c"==w||"C"==w)w=b[a+3],a+=4;else if("s"==w||"S"==w)w=v(b,a+3),a+=5;else if("f"==w)w=y(b,a+3),a+=7;else if("Z"==w||"H"==w)for(a+=3,w="";z=b[a++],0!=z;)w+=String.fromCharCode(z);else if("B"==w){w=String.fromCharCode(b[a+
3]);z=h(b,a+4);if("i"==w||"I"==w||"f"==w)K=4,J="f"==w?y:h;else if("s"==w||"S"==w)K=2,J=v;else if("c"==w||"C"==w)K=1,J=q;else throw"Unknown array type "+w;a+=8;w=[];for(I=0;I<z;++I)w.push(J(b,a)),a+=K}else throw"Unknown type "+w;D[A]=w}}if(!d||D.pos<=n&&D.pos+B>=d)void 0!==k&&f!=k||g.push(D);if(D.pos>n)return!0;a=c}};"undefined"!==typeof u&&(u.exports={makeBam:p,BAM_MAGIC:k,BAI_MAGIC:g,BamFlags:c})},{"./bin":4,"./lh3utils":24,"./spans":35}],2:[function(c,u,s){function l(b){this.type=b}function p(b,
a){this.parser=b;this.sink=a}function r(b,a){this.parser=b;this.sink=a;this.wigState=null}if("undefined"!==typeof c){var h=c("./spans"),v=h.Range,q=h.union,y=h.intersection,h=c("./sourceadapters").registerParserFactory;u=c("./das");var b=u.DASStylesheet,a=u.DASStyle,n=u.DASGroup,d=c("./utils").shallowCopy}l.prototype.createSession=function(b){return"wig"==this.type?new r(this,b):new p(this,b)};var k=/([^=]+)=(.+)/,g=/\s/,e=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.parse=function(b){var a=b.split(g);if(!(3>
a.length)){var k=parseInt(a[1])+1;b=parseInt(a[2]);b={segment:a[0],min:k,max:b};3<a.length&&"."!==a[3]&&(b.label=a[3]);4<a.length&&(b.score=parseFloat(a[4]));5<a.length&&(b.orientation=a[5]);if(8<a.length){var h=a[8];e.test(h)&&(b.itemRgb="rgb("+h+")")}if(12<=a.length){var h=parseInt(a[6]),c=parseInt(a[7]),r=parseInt(a[9]),l=a[10].split(",").map(function(f){return parseInt(f)}),x=a[11].split(",").map(function(f){return parseInt(f)});b.type="transcript";var H=new n;H.id=a[3];H.type="transcript";H.notes=
[];b.groups=[H];if(12<a.length){var D=H=a[12];13<a.length&&(D=a[13]);a=new n;a.id=H;a.label=D;a.type="gene";b.groups.push(a)}a=null;for(H=0;H<r;++H)D=x[H]+k,D=new v(D,D+l[H]),a=a?q(a,D):D;x=a.ranges();for(k=0;k<x.length;++k)l=x[k],r=d(b),r.min=l.min(),r.max=l.max(),this.sink(r);if(c>h&&(h="+"==b.orientation?new v(h,c+3):new v(h-3,c),h=y(a,h)))for(b.type="translation",h=h.ranges(),k=c=0;k<h.length;++k)r=k,"-"==b.orientation&&(r=h.length-k-1),l=h[r],r=d(b),r.min=l.min(),r.max=l.max(),b.readframe=c,
l=l.max()-l.min(),c=(c+l)%3,this.sink(r)}else this.sink(b)}};p.prototype.flush=function(){};r.prototype.parse=function(a){a=a.split(g);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var e=k.exec(a[b]);e&&("chrom"==e[1]?this.chr=e[2]:"start"==e[1]?this.pos=parseInt(e[2]):"step"==e[1]?this.step=parseInt(e[2]):"span"==e[1]&&(this.span=parseInt(e[2])))}}else if("variableStep"==a[0])for(this.wigState="variableStep",this.chr=null,b=
this.span=1;b<a.length;++b)e=k.exec(a[b]),"chrom"==e[1]?this.chr=e[2]:"span"==e[1]&&(this.span=parseInt(e[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),
score:parseFloat(a[3])},this.sink(a))};r.prototype.flush=function(){};l.prototype.getStyleSheet=function(e){var g=new b;if("wig"==this.type){var d=new a;d.glyph="HISTOGRAM";d.BGCOLOR="blue";d.HEIGHT=30;g.pushStyle({type:"default"},null,d)}else d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="blue",d.HEIGHT=8,d.BUMP=!0,d.LABEL=!0,d.ZINDEX=20,g.pushStyle({type:"default"},null,d),d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="red",d.HEIGHT=10,d.BUMP=!0,d.ZINDEX=20,g.pushStyle({type:"translation"},
null,d),d=new a,d.glyph="BOX",d.FGCOLOR="black",d.BGCOLOR="white",d.HEIGHT=10,d.ZINDEX=10,d.BUMP=!0,d.LABEL=!0,g.pushStyle({type:"transcript"},null,d),d=new a,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,g.pushStyle({type:"density"},null,d);return e(g)};h("bed",function(a){return new l(a)});h("wig",function(a){return new l(a)})},{"./das":10,"./sourceadapters":34,"./spans":35,"./utils":50}],3:[function(c,u,s){function l(a,f){return a[f]+a[f+1]*E+a[f+2]*N+a[f+3]*P+a[f+4]*x}function p(){}
function r(a,f,b,e){this.bwg=a;this.cirTreeOffset=f;this.cirTreeLength=b;this.isSummary=e}function h(a,f,b){var e=new p;e.data=a;e.name=b;e.data.slice(0,512).salted().fetch(function(a){if(!a)return f(null,"Couldn't fetch file");var w=new Uint8Array(a),b=new Int16Array(a);a=new Int32Array(a);var g=w[0]+E*w[1]+N*w[2]+P*w[3];g==t?e.type="bigwig":g==R?e.type="bigbed":g==C||g==L?f(null,"Currently don't support big-endian BBI files"):f(null,"Not a supported format, magic=0x"+g.toString(16));e.version=b[2];
e.numZoomLevels=b[3];e.chromTreeOffset=l(w,8);e.unzoomedDataOffset=l(w,16);e.unzoomedIndexOffset=l(w,24);e.fieldCount=b[16];e.definedFieldCount=b[17];e.asOffset=l(w,36);e.totalSummaryOffset=l(w,44);e.uncompressBufSize=a[13];e.extHeaderOffset=l(w,56);e.zoomLevels=[];for(b=0;b<e.numZoomLevels;++b){var g=a[6*b+16],d=l(w,24*b+72),m=l(w,24*b+80);e.zoomLevels.push({reduction:g,dataOffset:d,indexOffset:m})}e.readChromTree(function(){e.getAutoSQL(function(m){e.schema=m;return f(e)})})})}function v(a,f,b,
e,g){this.bbi=a;this.type=f;this.fieldCount=b;this.offset=e;this.field=g}if("undefined"!==typeof c){s=c("./spans");var q=s.Range,y=s.union,b=s.intersection;s=c("./das");var a=s.DASFeature,n=s.DASGroup,d=c("./utils").shallowCopy,k=c("./bin").readInt;c=c("jszlib");var g=c.inflateBuffer,e=c.arrayCopy}var t=2291137574,C=654086024,R=2273964779,L=3958540679,E=256,N=65536,P=16777216,x=4294967296,H=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.readChromTree=function(a){var f=this;this.chromsToIDs={};this.idsToChroms=
{};this.maxID=0;var b=this.unzoomedDataOffset,b=b+4-(b-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,b-this.chromTreeOffset).fetch(function(b){var e=new Uint8Array(b),w=new Int16Array(b),g=(new Int32Array(b))[2];l(e,16);var d=function(a){var m=e[a],b=w[a/2+1];a+=4;for(var z=0;z<b;++z)if(0==m){a+=g;var G=l(e,a);a+=8;G-=f.chromTreeOffset;d(G)}else{for(var G="",k=0;k<g;++k){var n=e[a++];0!=n&&(G+=String.fromCharCode(n))}k=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;f.chromsToIDs[G]=k;
0==G.indexOf("chr")&&(f.chromsToIDs[G.substr(3)]=k);f.idsToChroms[k]=G;f.maxID=Math.max(f.maxID,k)}};d(32);a(f)})};r.prototype.readWigData=function(a,f,b,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.readWigDataById(a,f,b,e)};r.prototype.readWigDataById=function(a,f,b,e){var g=this;if(this.cirHeader){var w=[],d=0;Date.now();var A=function(m,w,e,g){return(0>a||m==a)&&w<=b&&e>=f},I=function(f,a){g.bwg.instrument&&console.log("level="+a+"; offset="+f+"; time="+(Date.now()|0));d+=f.length;
if(1==f.length&&48==f[0]-g.cirTreeOffset&&g.cachedCirRoot)F(g.cachedCirRoot,0,a),--d,0==d&&g.fetchFeatures(A,w,e);else{for(var b=4+32*g.cirBlockSize,z,I=0;I<f.length;++I){var k=new q(f[I],f[I]+b);z=z?y(z,k):k}b=z.ranges();for(z=0;z<b.length;++z)m(f,b[z],a)}},m=function(f,m,a,b){m.max();m.min();g.bwg.data.slice(m.min(),m.max()-m.min()).fetch(function(b){for(var z=0;z<f.length;++z)m.contains(f[z])&&(F(b,f[z]-m.min(),a),48==f[z]-g.cirTreeOffset&&0==f[z]-m.min()&&(g.cachedCirRoot=b),--d,0==d&&g.fetchFeatures(A,
w,e))})},F=function(m,e,g){var d=new Uint8Array(m),A=new Int16Array(m);m=new Int32Array(m);var F=d[e],A=A[e/2+1];e+=4;if(0!=F)for(F=0;F<A;++F){var k=e/4,n=m[k],J=m[k+1],B=m[k+2],k=m[k+3],t=l(d,e+16);g=l(d,e+24);(0>a||n<a||n==a&&J<=b)&&(0>a||B>a||B==a&&k>=f)&&w.push({offset:t,size:g});e+=32}else{for(var q=[],F=0;F<A;++F)k=e/4,n=m[k],J=m[k+1],B=m[k+2],k=m[k+3],t=l(d,e+16),(0>a||n<a||n==a&&J<=b)&&(0>a||B>a||B==a&&k>=f)&&q.push(t),e+=24;0<q.length&&I(q,g+1)}};I([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(m){g.cirHeader=m;m=new Int32Array(g.cirHeader);g.cirBlockSize=m[1];g.readWigDataById(a,f,b,e)})};r.prototype.fetchFeatures=function(b,f,d){var k=this;f.sort(function(f,w){return(f.offset|0)-(w.offset|0)});if(0==f.length)d([]);else{var n=[],w=function(f,w,m,b){b||(b={});var e=new a;e._chromId=f;e.segment=k.bwg.idsToChroms[f];e.min=w;e.max=m;e.type="bigwig";for(var g in b)e[g]=b[g];n.push(e)},J=function(){if(0==f.length)Date.now(),d(n);else{var a=f[0];if(a.data)k.parseFeatures(a.data,
w,b),f.splice(0,1),J();else{for(var I=a.offset,m=a.size,a=1;a<f.length&&f[a].offset==I+m;)m+=f[a].size,++a;k.bwg.data.slice(I,m).fetch(function(w){for(var a=0,b=0;a<m;){var d=f[b],A;0<k.bwg.uncompressBufSize?A=g(w,a+2,d.size-2):(A=new Uint8Array(d.size),e(new Uint8Array(w,a,d.size),0,A,0,d.size),A=A.buffer);d.data=A;a+=d.size;++b}J()})}}};J()}};r.prototype.parseFeatures=function(a,f,e){var g=new Uint8Array(a);if(this.isSummary)for(var k=new Int16Array(a),w=new Int32Array(a),J=new Float32Array(a),
g=a.byteLength/32,k=0;k<g;++k){a=w[8*k];var A=w[8*k+1],I=w[8*k+2],m=w[8*k+3],F=J[8*k+5],t=J[8*k+6];e(a,A+1,I)&&(m={type:"bigwig",score:t/m,maxScore:F},"bigbed"==this.bwg.type&&(m.type="density"),f(a,A+1,I,m))}else if("bigwig"==this.bwg.type)if(k=new Int16Array(a),w=new Int32Array(a),J=new Float32Array(a),a=w[0],F=w[1],t=w[3],m=w[4],A=g[20],g=k[11],3==A)for(k=0;k<g;++k){var G=J[k+6],w=F+k*t+1,A=F+k*t+m;e(a,w,A)&&f(a,w,A,{score:G})}else if(2==A)for(k=0;k<g;++k)A=w[2*k+6]+1,I=A+m-1,G=J[2*k+7],e(a,A,
I)&&f(a,A,I,{score:G});else if(1==A)for(k=0;k<g;++k)A=w[3*k+6]+1,I=w[3*k+7],G=J[3*k+8],A>I&&(A=I),e(a,A,I)&&f(a,A,I,{score:G});else console.log("Currently not handling bwgType="+A);else if("bigbed"==this.bwg.type)for(k=0,m=this.bwg.definedFieldCount,F=this.bwg.schema;k<g.length;){a=g[k+3]<<24|g[k+2]<<16|g[k+1]<<8|g[k+0];A=g[k+7]<<24|g[k+6]<<16|g[k+5]<<8|g[k+4];I=g[k+11]<<24|g[k+10]<<16|g[k+9]<<8|g[k+8];k+=12;for(G="";;)if(t=g[k++],0!=t)G+=String.fromCharCode(t);else break;var t={},h;h=0<G.length?
G.split("\t"):[];0<h.length&&3<m&&(t.label=h[0]);1<h.length&&4<m&&(G=parseInt(h[1]),isNaN(G)||(t.score=G));2<h.length&&5<m&&(t.orientation=h[2]);5<h.length&&8<m&&(G=h[5],H.test(G)&&(t.itemRgb="rgb("+G+")"));if(h.length>m-3&&F)for(G=m-3;G<h.length;++G)t[F.fields[G+3].name]=h[G];if(e(a,A+1,I,h))if(12>m)f(a,A+1,I,t);else{var G=h[3]|0,C=h[4]|0,c=h[6]|0,x=h[7].split(","),r=h[8].split(",");t.exonFrames&&(J=t.exonFrames.split(","),t.exonFrames=void 0);t.type="transcript";var l=new n;for(w in t)l[w]=t[w];
l.id=h[0];l.segment=this.bwg.idsToChroms[a];l.min=A+1;l.max=I;l.notes=[];t.groups=[l];if(9<h.length){var E=I=t.geneName||h[9];10<h.length&&(E=h[10]);t.geneName2&&(E=t.geneName2);h=d(l);h.id=I;h.label=E;h.type="gene";t.groups.push(h)}I=[];for(h=0;h<c;++h)l=(r[h]|0)+A,l=new q(l,l+(x[h]|0)),I.push(l);x=y(I);c=x.ranges();for(A=0;A<c.length;++A)I=c[A],f(a,I.min()+1,I.max(),t);if(C>G&&(A="+"==t.orientation?new q(G,C+3):new q(G-3,C),A=b(x,A))){t.type="translation";G=A.ranges();for(x=C=0;G[0].min()>c[x].max();)x++;
for(A=0;A<G.length;++A)c=A,"-"==t.orientation&&(c=G.length-A-1),I=G[c],t.readframe=C,J&&(c=parseInt(J[c+x]),"number"===typeof c&&0<=c&&2>=c&&(t.readframe=c,t.readframeExplicit=!0)),c=I.max()-I.min(),C=(C+c)%3,f(a,I.min()+1,I.max(),t)}}}else throw Error("Don't know what to do with "+this.bwg.type);};r.prototype.getFirstAdjacent=function(a,f,b,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.getFirstAdjacentById(a,f,b,e)};r.prototype.getFirstAdjacentById=function(a,f,b,e){var g=this;if(this.cirHeader){var w=
null,d=-1,A=-1,k=0;Date.now();var m=function(a,m){k+=a.length;for(var f=4+32*g.cirBlockSize,w,b=0;b<a.length;++b){var e=new q(a[b],a[b]+f);w=w?y(w,e):e}f=w.ranges();for(w=0;w<f.length;++w)F(a,f[w],m)},F=function(m,d,A,F){d.max();d.min();g.bwg.data.slice(d.min(),d.max()-d.min()).fetch(function(F){for(var t=0;t<m.length;++t)if(d.contains(m[t])&&(n(F,m[t]-d.min(),A),--k,0==k)){if(!w)return 0<b&&(0!=a||0<f)?g.getFirstAdjacentById(0,0,b,e):0>b&&(a!=g.bwg.maxID||1E9>f)?g.getFirstAdjacentById(g.bwg.maxID,
1E9,b,e):e([]);g.fetchFeatures(function(m,w,e,g){return 0>b&&(m<a||e<f)||0<b&&(m>a||w>f)},[w],function(a){for(var m=null,f=-1,w=-1,g=0;g<a.length;++g){var d=a[g],A=d._chromId,F=d.min,k=d.max;if(null==m||0>b&&(A>f||k>w)||0<b&&(A<f||F<w))m=d,w=0>b?k:F,f=A}return null!=m?e([m]):e([])})}})},n=function(e,F,k){var I=new Uint8Array(e),n=new Int16Array(e);e=new Int32Array(e);var t=I[F],n=n[F/2+1];F+=4;if(0!=t)for(t=0;t<n;++t){var B=F/4,h=e[B],q=e[B+1],c=e[B+2],C=e[B+3],B=l(I,F+16);k=l(I,F+24);(0>b&&(h<a||
h==a&&q<=f)||0<b&&(c>a||c==a&&C>=f))&&!/_random/.exec(g.bwg.idsToChroms[h])&&(null==w||0>b&&(c>d||c==d&&C>A)||0<b&&(h<d||h==d&&q<A))&&(w={offset:B,size:k},A=0>b?C:q,d=0>b?c:h);F+=32}else{for(var x=I=-1,t=0;t<n;++t){B=F/4;h=e[B];q=e[B+1];c=e[B+2];C=e[B+3];B=e[B+4]<<32|e[B+5];if(0>b&&(h<a||h==a&&q<=f)&&c>=a||0<b&&(c>a||c==a&&C>=f)&&h<=a)if(0>I||C>x)I=B,x=0>b?C:q;F+=24}0<=I&&m([I],k+1)}};m([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(m){g.cirHeader=m;m=new Int32Array(g.cirHeader);
g.cirBlockSize=m[1];g.getFirstAdjacentById(a,f,b,e)})};p.prototype.readWigData=function(a,f,b,e){this.getUnzoomedView().readWigData(a,f,b,e)};p.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new r(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};p.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new r(this,a.indexOffset,4E3,!0));return a.view};
p.prototype._tsFetch=function(a,f,b,e,g){var w=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var d=[],A=this.topLevelReductionCache,k=0;k<A.length;++k)A[k]._chromId==f&&d.push(A[k]);return g(d)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(m){w.topLevelReductionCache=m;return w._tsFetch(a,f,b,e,g)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(f,b,e,g)};p.prototype.thresholdSearch=function(a,f,b,e,g){function w(){if(0==
A.length)return g(null);A.sort(function(a,m){var f=a.zoom-m.zoom;if(0!=f)return f;f=a.chrOrd-m.chrOrd;return 0!=f?f:a.min-m.min*b});var a=A.splice(0,1)[0];d._tsFetch(a.zoom,a.chr,a.min,a.max,function(m){var d=0<b?0:3E8;a.fromRef&&(d=f);for(var k=0;k<m.length;++k){var I=m[k],n;n=void 0!=I.maxScore?I.maxScore:I.score;if(0<b){if(n>e)if(0>a.zoom){if(I.min>d)return g(I)}else I.max>d&&A.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:I.min,max:I.max,fromRef:a.fromRef})}else if(n>e)if(0>a.zoom){if(I.max<
d)return g(I)}else I.min<d&&A.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:I.min,max:I.max,fromRef:a.fromRef})}w()})}b=0>b?-1:1;var d=this;a=this.chromsToIDs[a];for(var A=[{chrOrd:0,chr:a,zoom:d.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],k=1;k<=this.maxID+1;++k){var m=(a+b*k)%(this.maxID+1);0>m&&(m+=this.maxID+1);A.push({chrOrd:k,chr:m,zoom:d.zoomLevels.length-1,min:0,max:3E8})}w()};p.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(f){var b=
new Uint8Array(f);f="";for(var e=0;e<b.length&&0!=b[e];++e)f+=String.fromCharCode(b[e]);var b=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,g=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(f);if(g){e={declType:g[1],name:g[2],comment:g[4],fields:[]};f=f.substring(g[0]);for(g=b.exec(f);null!=g;g=b.exec(f))e.fields.push({type:g[1],name:g[2],comment:g[4]});return a(e)}})};p.prototype.getExtraIndices=function(a){var f=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,
64).fetch(function(b){if(!b)return a(null,"Couldn't fetch extension header");var e=new Uint8Array(b),g=new Int16Array(b);new Int32Array(b);var w=g[1];b=l(e,4);if(0==w)return a(null);f.data.slice(b,20*w).fetch(function(b){if(!b)return a(null,"Couldn't fetch index info");var e=new Uint8Array(b),g=new Int16Array(b);new Int32Array(b);b=[];for(var m=0;m<w;++m){var d=g[10*m],k=g[10*m+1],z=l(e,20*m+4),d=new v(f,d,k,z,g[10*m+8]);b.push(d)}a(b)})})};v.prototype.lookup=function(a,f){var b=this;this.bbi.data.slice(this.offset,
32).fetch(function(e){function g(m){b.bbi.data.slice(m,4+d*(A+I)).fetch(function(m){var w=new Uint8Array(m),e=new Uint16Array(m);new Uint32Array(m);e=e[1];m=4;if(0==w[0]){for(var d=null,n=0;n<e;++n){for(var t="",J=0;J<A;++J){var h=w[m++];0!=h&&(t+=String.fromCharCode(h))}J=l(w,m);m+=8;if(0>a.localeCompare(t)&&d){g(d);return}d=J}g(d)}else{for(n=0;n<e;++n){t="";for(J=0;J<A;++J)h=w[m++],0!=h&&(t+=String.fromCharCode(h));if(t==a)return e=l(w,m),w=k(w,m+8),b.bbi.getUnzoomedView().fetchFeatures(function(m,
f,w,e){if(e&&e.length>b.field-3)return e[b.field-3]==a},[{offset:e,size:w}],f);m+=I}return f([])}})}var w=new Uint8Array(e);new Int16Array(e);e=new Int32Array(e);var d=e[1],A=e[2],I=e[3];l(w,16);g(b.offset+32)})};"undefined"!==typeof u&&(u.exports={makeBwg:h,BIG_BED_MAGIC:R,BIG_WIG_MAGIC:t})},{"./bin":4,"./das":10,"./spans":35,"./utils":50,jszlib:66}],4:[function(c,u,s){function l(a){this.blob=a}function p(a,b,d,k){k||("object"===typeof b?(k=b,b=void 0):k={});this.url=a;this.start=b||0;d&&(this.end=
d);this.opts=k}function r(a){if(!a)return null;for(var b=new Uint8Array(a.length),d=0;d<b.length;++d)b[d]=a.charCodeAt(d);return b.buffer}function h(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function v(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function q(a,b){return a[b+1]<<8|a[b]}function y(a,b){return a[b]}function b(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof c)var a=c("./utils").shallowCopy,n=c("./sha1").b64_sha1;l.prototype.slice=function(a,b){var d;
d=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new l(d)};l.prototype.salted=function(){return this};l.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(d){a(r(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var d=b.readAsArrayBuffer(this.blob);a(d)}catch(k){a(null,k)}};p.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var d=
this.start,k=this.end,d=d&&a?d+a:a||d;return new p(this.url,d,b&&d?d+b-1:k||b-1,this.opts)};var d=0,k=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");p.prototype.fetchAsText=function(a){var b=new XMLHttpRequest,t=this.url;(k||this.opts.salt)&&0>t.indexOf("?")&&(t=t+"?salt="+n(""+Date.now()+","+ ++d));b.open("GET",t,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==
b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")};p.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new p(this.url,this.start,this.end,b)};p.prototype.fetch=function(a,b,t){var h=this;b=b||1;if(3<b)return a(null);var q=new XMLHttpRequest,c,l=this.url;(k||this.opts.salt)&&0>l.indexOf("?")&&(l=l+"?salt="+n(""+Date.now()+","+ ++d));q.open("GET",l,!0);q.overrideMimeType("text/plain; charset=x-user-defined");
if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";q.setRequestHeader("Range","bytes="+this.start+"-"+this.end);c=this.end-this.start+1}q.responseType="arraybuffer";q.onreadystatechange=function(){if(4==q.readyState){if(200==q.status||206==q.status){if(q.response){var d=q.response.byteLength;return!c||c==d||t&&d==t?a(q.response):h.fetch(a,b+1,d)}if(q.mozResponseArrayBuffer)return a(q.mozResponseArrayBuffer);d=q.responseText;return!c||c==d.length||t&&d.length==t?a(r(q.responseText)):h.fetch(a,
b+1,d.length)}return h.fetch(a,b+1)}};this.opts.credentials&&(q.withCredentials=!0);q.send("")};(function(a){var b=new ArrayBuffer(8),d=new Uint8Array(b),k=new Float32Array(b);a.readFloat=function(a,b){d[0]=a[b];d[1]=a[b+1];d[2]=a[b+2];d[3]=a[b+3];return k[0]}})(this);"undefined"!==typeof u&&(u.exports={BlobFetchable:l,URLFetchable:p,readInt:v,readIntBE:b,readInt64:h,readShort:q,readByte:y,readFloat:this.readFloat})},{"./sha1":33,"./utils":50}],5:[function(c,u,s){function l(h){var c="bp";1E9<h?(h/=
1E9,c="Gb"):1E6<h?(h/=1E6,c="Mb"):1E3<h&&(h/=1E3,c="kb");return""+Math.round(h)+c}if("undefined"!==typeof c){var p=c("./cbrowser").Browser,r=c("./utils").makeElement,h=c("./numformats").formatLongInt,v=c("./zoomslider");c("./tier-edit");c("./export-config");c("./export-ui");c("./export-image");c("./svg-export");c("./session")}p.prototype.initUI=function(q,c){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(r("link",
"",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var b=this;b.disableDefaultFeaturePopup||this.addFeatureListener(function(a,m,f,w){b.featurePopup(a,m,f,w)});q.classList.add("dalliance");var a=b.toolbar=r("div",null,{className:"btn-toolbar toolbar"}),n=b.coordSystem.speciesName+" "+b.nameForCoordSystem(b.coordSystem);this.setDocumentTitle&&(document.title=n+" :: dalliance");var d=r("input","",{className:"loc-field"});b.makeTooltip(d,"Enter a genomic location or gene name");var k=
r("p","",{className:"loc-status"}),g=r("a",[r("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),e=new v;b.makeTooltip(e,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var t=r("a",[r("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),C=r("a",[r("i",null,{className:"fa fa-eraser"})],{className:"btn"}),p=r("a",[r("i",null,{className:"fa fa-plus"})],{className:"btn"}),L=r("a",[r("i",null,{className:"fa fa-bookmark"})],
{className:"btn"}),E=r("a",[r("i",null,{className:"fa fa-print"})],{className:"btn"});r("a",[r("i",null,{className:"fa fa-refresh"})],{className:"btn"});var N=r("a",[r("i",null,{className:"fa fa-cogs"})],{className:"btn"}),P=r("a",[r("i",null,{className:"fa fa-question"})],{className:"btn"}),x=r("a",[r("i",null,{className:"fa fa-road"})],{className:"btn"});b.makeTooltip(x,"Configure currently selected track(s) (E)");var H=r("a",[r("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),
D=r("a",[r("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),f=r("div",null,{className:"btn-group pull-right"});this.noTrackAdder||f.appendChild(p);this.noTrackEditor||f.appendChild(x);this.noExport||f.appendChild(E);this.noOptions||f.appendChild(N);this.noHelp||f.appendChild(P);this.setUiMode=function(a){this.uiMode=a;var b={help:P,add:p,opts:N,"export":E,tier:x},f;for(f in b)f==a?b[f].classList.add("active"):b[f].classList.remove("active")};this.noLeapButtons||
a.appendChild(D);f.firstChild&&a.appendChild(f);this.noLeapButtons||a.appendChild(H);this.noTitle||a.appendChild(r("div",r("h4",n,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(r("div",[d,k],{className:"btn-group loc-group"}));this.noClearHighlightsButton||a.appendChild(C);this.noZoomSlider||a.appendChild(r("div",[g,r("span",e,{className:"btn"}),t],{className:"btn-group"}));this.toolbarBelow?(q.appendChild(c),q.appendChild(a)):(q.appendChild(a),q.appendChild(c));
var z=Math.log(2)/Math.log(10),B=Math.log(5)/Math.log(10),K=function(a){var m=(a/b.zoomExpt+Math.log(b.zoomBase))/Math.log(10);a=m|0;m-=a;return((0.01>m?a:m<=z+0.01?a+z:m<=B+0.01?a+B:a+1)*Math.log(10)-Math.log(b.zoomBase))*b.zoomExpt},w=function(a){e.addLabel(a,l(Math.exp(a/b.zoomExpt)*b.zoomBase))};this.addViewListener(function(a,m,f,k,A){d.value=a+":"+h(m)+".."+h(f);e.min=A.min|0;e.max=A.max|0;A.isSnapZooming?(e.value=A.alternate,e.value2=A.current,e.active=2):(e.value=A.current,e.value2=A.alternate,
e.active=1);A.current==A.min?g.classList.add("disabled"):g.classList.remove("disabled");A.current==A.max?t.classList.add("disabled"):t.classList.remove("disabled");e.removeLabels();a=A.min;A=A.max;m=A-a;w(K(a));w(K(a+1*m/3));w(K(a+2*m/3));w(K(A));b.storeStatus&&b.storeViewStatus();C.style.display=0<b.highlights.length?"inline-block":"none"});this.addTierListener(function(){b.storeStatus&&b.storeTierStatus()});d.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),
b.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),b.search(d.value,function(a){k.textContent=a?""+a:""})},!1);var J;p.addEventListener("click",function(a){J&&J.displayed?b.removeAllPopups():J=b.showTrackAdder(a)},!1);b.makeTooltip(p,"Add a new track from the registry or an indexed file. (A)");g.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(-10)},!1);b.makeTooltip(g,"Zoom in (+)");t.addEventListener("click",function(a){a.stopPropagation();
a.preventDefault();b.zoomStep(10)},!1);b.makeTooltip(t,"Zoom out (-)");e.addEventListener("change",function(a){a=2==e.active;a!=b.isSnapZooming&&(b.savedZoom=b.zoomSliderValue-b.zoomMin,b.isSnapZooming=a);a=1==e.active?e.value:e.value2;b.zoomSliderValue=1*a;b.zoom(Math.exp(1*a/b.zoomExpt))},!1);L.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);b.makeTooltip(L,"Favourite regions");E.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.openExportPanel()},
!1);b.makeTooltip(E,"Export publication-quality SVG. (X)");N.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleOptsPopup(a)},!1);b.makeTooltip(N,"Configure options.");P.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleHelpPopup(a)});b.makeTooltip(P,"Help; Keyboard shortcuts. (H)");x.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]])},
!1);H.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?-1:1,!1)},!1);b.makeTooltip(H,function(a){a=b.getSelectedTier();var m;0<=a&&(m=b.tiers[a]);return m&&m.featureSource&&b.sourceAdapterIsCapable(m.featureSource,"quantLeap")&&"number"==typeof m.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(m.config.name||m.dasSource.name)+'"" (ctrl+LEFT)':m&&m.featureSource&&b.sourceAdapterIsCapable(m.featureSource,"leap")?'Jump to the next feature in the selected track "'+
(m.config.name||m.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});D.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?1:-1,!1)},!1);b.makeTooltip(D,function(a){a=b.getSelectedTier();var m;0<=a&&(m=b.tiers[a]);return m&&m.featureSource&&b.sourceAdapterIsCapable(m.featureSource,"quantLeap")&&"number"==typeof m.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(m.config.name||m.dasSource.name)+'"" (ctrl+RIGHT)':m&&m.featureSource&&
b.sourceAdapterIsCapable(m.featureSource,"leap")?'Jump to the next feature in the selected track "'+(m.config.name||m.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});b.addTierSelectionListener(function(){var a=b.getSelectedTier(),m;0<=a&&(m=b.tiers[a]);a=!1;m&&m.featureSource&&(b.sourceAdapterIsCapable(m.featureSource,"quantLeap")&&"number"==typeof m.quantLeapThreshold?a=!0:b.sourceAdapterIsCapable(m.featureSource,"leap")&&(a=!0));H.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";
D.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});C.addEventListener("click",function(a){b.clearHighlights()},!1);b.makeTooltip(C,"Clear highlights (C)");b.addTierSelectionWrapListener(function(a){0>a&&(b.setSelectedTier(null),d.focus())});b.addTierSelectionListener(function(a){"tier"===b.uiMode&&(0==a.length?(b.hideToolPanel(),b.manipulatingTier=null,b.uiMode="none"):(a=b.tiers[a[0]],a!=b.manipulatingTier&&b.openTierPanel(a)))});var A=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),
a.stopPropagation(),b.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),b.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),b.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),b.clearHighlights()};q.addEventListener("focus",
function(a){q.addEventListener("keydown",A,!1)},!1);q.addEventListener("blur",function(a){q.removeEventListener("keydown",A,!1)},!1);q.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==b.uiMode&&(a.preventDefault(),a.stopPropagation(),b.setUiMode("none"),b.hideToolPanel(),b.selectedTiers&&0<b.selectedTiers.length&&b.browserHolder.focus())},!1)};p.prototype.showToolPanel=function(h,c){var b=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
var a;a=c?h:r("div",h,{},{overflowY:"auto",width:"100%"});var n=r("div",r("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});n.addEventListener("click",function(a){b.hideToolPanel();b.setUiMode("none")},!1);this.makeTooltip(n,"Close tool panel (ESC)");this.activeToolPanel=r("div",[n,a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();b=this};p.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};p.prototype.toggleHelpPopup=function(h){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(h=r("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(h,!1),this.setUiMode("help"))};p.prototype.toggleOptsPopup=function(h){var c=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{h=r("div",null,{className:"form-horizontal"},
{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var b=r("table");b.cellPadding=5;var a=r("input","",{type:"checkbox",checked:c.reverseScrolling});a.addEventListener("change",function(b){c.reverseScrolling=a.checked;c.storeStatus()},!1);b.appendChild(r("tr",[r("td","Reverse trackpad scrolling",{align:"right"}),r("td",a)]));var n=r("input","",{type:"checkbox",checked:c.reverseKeyScrolling});n.addEventListener("change",function(a){c.reverseKeyScrolling=
n.checked;c.storeStatus()},!1);b.appendChild(r("tr",[r("td","Reverse scrolling buttons and keys",{align:"right"}),r("td",n)]));var d=r("select");d.appendChild(r("option","Left",{value:"left"}));d.appendChild(r("option","Center",{value:"center"}));d.appendChild(r("option","Right",{value:"right"}));d.appendChild(r("option","None",{value:"none"}));d.value=c.rulerLocation;d.addEventListener("change",function(a){c.rulerLocation=d.value;c.positionRuler();for(a=0;a<c.tiers.length;++a)c.tiers[a].paintQuant();
c.storeStatus()},!1);b.appendChild(r("tr",[r("td","Vertical guideline",{align:"right"}),r("td",d)]));var k=r("input","",{type:"checkbox",checked:c.singleBaseHighlight});k.addEventListener("change",function(a){c.singleBaseHighlight=k.checked;c.positionRuler();c.storeStatus()},!1);k.setAttribute("id","singleBaseHightlightButton");b.appendChild(r("tr",[r("td","Display and highlight current genome location",{align:"right"}),r("td",k)]));h.appendChild(b);b=r("button","Reset browser",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});b.addEventListener("click",function(a){c.reset()},!1);h.appendChild(b);this.showToolPanel(h);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":37,"./tier-edit":43,"./utils":50,"./zoomslider":53}],6:[function(c,u,s){function l(a,b,f){this.min=b;this.max=f;this.chr=a}function p(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=
[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry=null;this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=
100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new k;this.defaultSources=
[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new d;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];this.baseColors=a.baseColors?a.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");
for(var b in a)this[b]=a[b];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=a.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(this.prefix="//"+window.location.hostname+this.prefix);0===this.prefix.indexOf("//")&&(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));
if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var f=this;"complete"===document.readyState?f.realInit():window.addEventListener("load",function(a){f.realInit()},!1)}function r(a,b,f){if(f)for(var e=0;e<b.length;++e)b[e].mapping=f;a.set(b)}function h(a){return a.uri?a.uri:a.blob?"file:"+a.blob.name:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+
a.bamBlob.name:a.twoBitBlob?"file:"+a.twoBitBlob.name:a.bwgURI||a.bamURI||a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function v(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type||a.twoBitURI||a.twoBitBlob?"http://www.biodalliance.org/magic/sequence":h(a)}function q(a,b){if(h(a)!=h(b)||a.mapping!=b.mapping||a.tier_type!=b.tier_type)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var f=0;f<a.overlay.length;++f)if(!q(a.overlay[f],
b.overlay[f]))return!1}else if(b.overlay)return!1;return!0}function y(a,b){if(h(a)!=h(b)||v(a)!=v(b)||a.mapping!=b.mapping||a.tier_type!=b.tier_type)return!1;if(a.overlay){if(!b.overlay||b.overlay.length!=a.overlay.length)return!1;for(var f=0;f<a.overlay.length;++f)if(!y(a.overlay[f],b.overlay[f]))return!1}else if(b.overlay)return!1;return!0}function b(a,f,e,d){d=d||[];for(var m=a.length-1;0<=m;--m){var g=a[m];if(!g.notSelectable&&g.min()<=f&&g.max()>=f&&(!g.minY||!(e<g.minY()||e>g.maxY()))){g.feature?
d.push(g.feature):g.group&&d.push(g.group);if(g.glyphs)return b(g.glyphs,f,e,d);if(g.glyph)return b([g.glyph],f,e,d);break}}return d}function a(a,b){var f=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=b;this.worker.onmessage=function(a){var b=f.callbacks[a.data.tag];b&&(b(a.data.result,a.data.error),delete f.callbacks[a.data.tag])}}function n(b){var f=b.resolveURL(b.workerPath);0==f.indexOf("//")&&(f="https:"==window.location.protocol?"https:"+f:"http:"+f);var e=new Blob(['importScripts("'+
f+'");'],{type:"application/javascript"});return new D(function(f,m){var d=new Worker(URL.createObjectURL(e));d.onmessage=function(m){"init"===m.data.tag&&(console.log("Worker initialized"),f(new a(b,d)))};d.onerror=function(a){m(a.message)}})}function d(){this.sourcesByURI={}}if("undefined"!==typeof c){s=c("./utils");var k=s.Observed,g=s.makeElement,e=s.removeChildren,t=s.miniJSONify,C=s.shallowCopy,R=c("./tier").DasTier,L=c("./sha1").hex_sha1,E=c("./thub").connectTrackHub,N=c("./version");s=c("./numformats");
var P=s.formatQuantLabel,x=s.formatLongInt,H=c("./chainset").Chainset,D=c("es6-promise").Promise}p.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};p.prototype.realInit=function(){var a=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var b=navigator.userAgent||"dummy";0<=b.indexOf("Trident")&&0<=b.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;
this.defaultEnd=this.viewEnd;this.defaultSources=[];for(b=0;b<this.sources.length;++b){var f=this.sources[b];f&&this.defaultSources.push(f)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var d=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=g("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=
this.maxHeight&&(this.browserHolder.style.maxHeight=null);e(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=g("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=g("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=g("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=g("span","",{className:"loc-single-base"});b=g("div",this.locSingleBase,
{className:"loc-single-base-holder"});this.addViewListener(function(b,f,m,e,d,g,k){f=Math.round((k+g)/2);a.locSingleBase.appendChild(document.createTextNode(b+":"+x(f)));a.locSingleBase.removeChild(a.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=g("div",[b,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=
g("div");this.disablePoweredBy||(this.bhtmlRoot.appendChild(g("span",["Powered by ",g("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+N],{className:"powered-by"})),this.bhtmlRoot.appendChild(g("span",[" | ",g("a","Link to Ensembl",{href:"http://www.ensembl.org/",id:"enslink",target:"_newtab"})," "],{className:"powered-by"})));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(a){d.resizeViewer()},!1);this.ruler=g("div",null,{className:"guideline"});
this.ruler2=g("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var m in this.chainConfigs)b=this.chainConfigs[m],b instanceof H&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[m]=new H(b);if(0<this.maxWorkers){m=[];for(b=0;b<this.maxWorkers;++b)m.push(n(this));m=D.all(m)}else m=D.resolve([]);this.fetchWorkers=
null;this.nextWorker=0;m.then(function(a){console.log("Booted "+a.length+" workers");d.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if("none"!=window.getComputedStyle(d.browserHolderHolder).display&&0<d.tierHolder.getBoundingClientRect().width)setTimeout(function(){d.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(d.browserHolderHolder).display&&0<d.tierHolder.getBoundingClientRect().width&&(clearInterval(a),d.realInit2())},
300)})}};p.prototype.realInit2=function(){var a=this;e(this.tierHolder);e(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);
this.tierHolderHolder.addEventListener("mousewheel",function(b){b.stopPropagation();b.preventDefault();if(b.wheelDeltaX){var f=b.wheelDeltaX/5;a.reverseScrolling||(f=-f);a.move(f)}b.wheelDeltaY&&(f=b.wheelDeltaY,a.reverseScrolling&&(f=-f),a.tierHolder.scrollTop+=f)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(b){b.stopPropagation();b.preventDefault();1==b.axis?0!=b.detail&&(b=b.detail/4,a.reverseScrolling&&(b=-b),a.move(b)):(b=b.detail,a.reverseScrolling||(b=-b),a.tierHolder.scrollTop+=
b)},!1);this.tierHolderHolder.addEventListener("touchstart",function(b){return a.touchStartHandler(b)},!1);this.tierHolderHolder.addEventListener("touchmove",function(b){return a.touchMoveHandler(b)},!1);this.tierHolderHolder.addEventListener("touchend",function(b){return a.touchEndHandler(b)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(b){return a.touchCancelHandler(b)},!1);var b=function(b){if(13==b.keyCode){var f=!1;for(b=0;b<a.tiers.length;++b){var m=a.tiers[b];m.wantedLayoutHeight&&
m.wantedLayoutHeight!=m.layoutHeight&&(m.layoutHeight=m.wantedLayoutHeight,m.clipTier(),f=!0)}f&&a.arrangeTiers()}else if(32==b.keyCode||32==b.charCode)a.isSnapZooming?(a.isSnapZooming=!1,f=(a.savedZoom||20)+a.zoomMin):(a.isSnapZooming=!0,f=(a.savedZoom||0)+a.zoomMin),a.savedZoom=a.zoomSliderValue-a.zoomMin,a.zoomSliderValue=f,a.zoom(Math.exp(1*f/a.zoomExpt)),b.stopPropagation(),b.preventDefault();else if(85==b.keyCode)"opts"===a.uiMode&&(f=document.getElementById("singleBaseHightlightButton").checked,
document.getElementById("singleBaseHightlightButton").checked=!f),a.singleBaseHighlight=!a.singleBaseHighlight,a.positionRuler(),b.stopPropagation(),b.preventDefault();else if(39==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,-1);else if(37==b.keyCode)b.stopPropagation(),b.preventDefault(),a.scrollArrowKey(b,1);else if(38==b.keyCode||87==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(f=a.tiers[b],b=f.forceHeight||f.subtiers[0].height,
40<=b&&f.mergeConfig({height:b-10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),!(0>b)&&(f=a.tiers[b],f.quantLeapThreshold)){var m=f.subtiers[0].height,e=f.subtiers[0].quant;e&&(b=1*e.min,e=1*e.max,m=(e-b)/m,f.mergeConfig({quantLeapThreshold:b+((Math.round((f.quantLeapThreshold-b)/m)|0)+1)*m}),f.notify("Threshold: "+P(f.quantLeapThreshold)))}}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var d=!0,f=[],m=0;m<a.selectedTiers.length;++m)f.push(a.tiers[a.selectedTiers[m]]),
0<m&&1!=a.selectedTiers[m]-a.selectedTiers[m-1]&&(d=!1);if(!(d&&0>=b)){for(m=a.selectedTiers.length-1;0<=m;--m)a.tiers.splice(a.selectedTiers[m],1);a.selectedTiers.splice(0,e);b=d?b-1:b;for(m=0;m<f.length;++m)a.tiers.splice(b+m,0,f[m]),a.selectedTiers.push(b+m);a.withPreservedSelection(a._ensureTiersGrouped);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else if(b=a.getSelectedTier(),0<b){if(a.setSelectedTier(b-1),b=a.tiers[a.getSelectedTier()],f=b.row.offsetTop,b=
f+b.row.offsetHeight,f<a.tierHolder.scrollTop||b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight)a.tierHolder.scrollTop=f}else a.notifyTierSelectionWrap(-1);else if(40==b.keyCode||83==b.keyCode)if(b.stopPropagation(),b.preventDefault(),b.shiftKey)b=a.getSelectedTier(),0>b||(f=a.tiers[b],b=f.forceHeight||f.subtiers[0].height,f.mergeConfig({height:b+10}));else if(b.ctrlKey||b.metaKey){if(b=a.getSelectedTier(),!(0>b)&&(f=a.tiers[b],f.quantLeapThreshold&&(m=f.subtiers[0].height,e=f.subtiers[0].quant)))b=
1*e.min,e=1*e.max,m=(e-b)/m,e=Math.round((f.quantLeapThreshold-b)/m)|0,1<e&&(f.mergeConfig({quantLeapThreshold:b+(e-1)*m}),f.notify("Threshold: "+P(f.quantLeapThreshold)))}else if(b.altKey){if(e=a.selectedTiers.length,0!=e){b=a.selectedTiers[0];for(var g=0,f=[],m=0;m<a.selectedTiers.length;++m)f.push(a.tiers[a.selectedTiers[m]]),0<m&&(g+=a.selectedTiers[m]-a.selectedTiers[m-1]-1);d=0==g;if(!(d&&b+e>=a.tiers.length)){for(m=a.selectedTiers.length-1;0<=m;--m)a.tiers.splice(a.selectedTiers[m],1);a.selectedTiers.splice(0,
e);b=d?b+1:b+g;for(m=0;m<f.length;++m)a.tiers.splice(b+m,0,f[m]),a.selectedTiers.push(b+m);a.withPreservedSelection(function(){a._ensureTiersGrouped(!0)});a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else{if(b=a.getSelectedTier(),b<a.tiers.length-1&&(a.setSelectedTier(b+1),b=a.tiers[a.getSelectedTier()],f=b.row.offsetTop,b=f+b.row.offsetHeight,f<a.tierHolder.scrollTop||b>a.tierHolder.scrollTop+a.tierHolder.offsetHeight))a.tierHolder.scrollTop=Math.min(f,b-a.tierHolder.offsetHeight)}else if(187==
b.keyCode||61==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(-10);else if(189==b.keyCode||173==b.keyCode)b.stopPropagation(),b.preventDefault(),a.zoomStep(10);else if(73==b.keyCode||105==b.keyCode)b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(m=a.tiers[b],m.infoVisible?(m.infoElement.style.display="none",m.updateHeight(),m.infoVisible=!1):(m.infoElement.style.display="block",m.updateHeight(),m.infoVisible=!0));else if(84==b.keyCode||116==b.keyCode)if(b.shiftKey)for(b.stopPropagation(),
b.preventDefault(),b=0;b<a.tiers.length;++b)m=a.tiers[b],m.dasSource.collapseSuperGroups&&(void 0===f&&(f=!m.bumped),m.mergeConfig({bumped:f}));else b.ctrlKey||b.metaKey||(b.stopPropagation(),b.preventDefault(),b=a.getSelectedTier(),0>b||(m=a.tiers[b],m.dasSource.collapseSuperGroups&&(void 0===f&&(f=!m.bumped),m.mergeConfig({bumped:f}))));else if(77==b.keyCode||109==b.keyCode)b.stopPropagation(),b.preventDefault(),(b.ctrlKey||b.metaKey)&&1<a.selectedTiers.length&&a.mergeSelectedTiers();else if(68==
b.keyCode||100==b.keyCode){if(b.stopPropagation(),b.preventDefault(),b.ctrlKey||b.metaKey)b=a.getSelectedTier(),0>b||a.addTier(a.tiers[b].dasSource)}else if(80==b.keyCode||112==b.keyCode)if(b.ctrlKey||b.metaKey){f=[];for(b=0;b<a.selectedTiers.length;++b)f.push(a.tiers[a.selectedTiers[b]]);for(b=0;b<f.length;++b)f[b].mergeConfig({pinned:!f[b].pinned})}};this.browserHolder.addEventListener("focus",function(f){a.browserHolder.addEventListener("keydown",b,!1)},!1);this.browserHolder.addEventListener("blur",
function(f){a.browserHolder.removeEventListener("keydown",b,!1)},!1);this.hPopupHolder=g("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var f=0;f<this.sources.length;++f){var d=this.sources[f];if(d){var m={};this.restoredConfigs&&(m=this.restoredConfigs[f]);d.disabled||this.makeTier(d,m)}}a._ensureTiersGrouped();a.arrangeTiers();a.reorderTiers();a.refresh();
a.setSelectedTier(1);a.positionRuler();(f=this.getSequenceSource())&&f.getSeqInfo(this.chr,function(b){a.currentSeqMax=b?b.length:-1});this.queryRegistry();for(var k in this.chains)this.queryRegistry(k,!0);if(this.hubs)for(k=0;k<this.hubs.length;++k)f=this.hubs[k],"string"==typeof f&&(f={url:f}),function(b){E(b.url,function(f,m){if(m)console.log(m);else{var e;if(e=b.genome?f.genomes[b.genome]:f.genomes[a.coordSystem.ucscName])b.mapping&&(e.mapping=b.mapping),a.hubObjects.push(e)}},b)}(f);this.fullScreen&&
this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(k=0;k<this.initListeners.length;++k)try{this.initListeners[k].call(this)}catch(n){console.log(n)}};p.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};p.prototype.touchMoveHandler=function(a){a.stopPropagation();
a.preventDefault();if(1==a.touches.length){var b=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&b!=this.touchOriginX&&this.move(b-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=b;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){b=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(b!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var f=this.viewStart+a/this.scale|0;this.scale=b/
this.zoomInitialSep*this.zoomInitialScale;this.viewStart=f-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=b}};p.prototype.touchEndHandler=function(a){};p.prototype.touchCancelHandler=function(a){};p.prototype.makeTier=function(a,b){try{return this.realMakeTier(a,b)}catch(f){console.log("Error initializing",a),console.log(f.stack||f)}};p.prototype.realMakeTier=function(a,f){var e=this,d=null;this.tierBackgroundColors&&(d=this.tierBackgroundColors[this.tiers.length%
this.tierBackgroundColors.length]);var m=new R(this,a,f,d);m.oorigin=this.viewStart;var g=!1,k,n,z,t=function(a,f){var d=m.subtiers;if(d){var g=0;for(f-=m.padding;g<d.length&&f>d[g].height&&g<d.length-1;)f=f-d[g].height-m.padding,++g;if(!(g>=d.length))return d=d[g].glyphs,a-=(m.glyphCacheOrigin-e.viewStart)*e.scale,b(d,a,f)}},h=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=n&&(e.move(a-n,!0),n=a);e.isDragging=!0},c=function(a){window.removeEventListener("mousemove",h,!0);window.removeEventListener("mouseup",
c,!0);e.move(a.clientX-n)};m.viewport.addEventListener("mousedown",function(a){e.browserHolder.focus();a.preventDefault();m.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",h,!0);window.addEventListener("mouseup",c,!0);k=n=a;e.isDragging=!1},!1);m.viewport.addEventListener("mousemove",function(a){var b=m.row.getBoundingClientRect(),f=a.clientX-b.left,d=a.clientY-b.top,b=t(f,d);m.row.style.cursor=b&&0<b.length?"pointer":"default";z&&clearTimeout(z);g||(z=setTimeout(function(){var b=
t(f,d);b&&0<b.length&&e.notifyFeatureHover(a,b[b.length-1],b,m)},1E3))});var B=null;m.viewport.addEventListener("mouseup",function(a){var b=m.row.getBoundingClientRect(),f=a.clientX-b.left,b=a.clientY-b.top,d=t(f,b);d&&0<d.length&&!e.isDragging&&(B?(clearTimeout(B),B=null,e.featureDoubleClick(d,f,b)):B=setTimeout(function(){B=null;e.notifyFeature(a,d[d.length-1],d,m)},500));if(e.isDragging&&f!=k&&m.sequenceSource){var b=e.viewStart+f/e.scale,g=e.viewStart+k/e.scale;b<g?(f=b|0,b=g|0):(f=g|0,b|=0);
e.notifyRegionSelect(e.chr,f,b)}e.isDragging=!1},!1);m.viewport.addEventListener("mouseout",function(a){g=!1});m.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<e.tiers.length;++a)if(e.tiers[a]===m){e.removeTier({index:a});break}},!1);m.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;for(var b=0;b<e.tiers.length;++b)if(e.tiers[b]===m){a=b;break}0<=a&&(b=e.selectedTiers.indexOf(a),0<=b?e.selectedTiers.splice(b,
1):(e.selectedTiers.push(a),e.selectedTiers.sort()),e.markSelectedTiers(),e.notifyTierSelection(),0<e.selectedTiers.length?e.browserHolder.focus():e.notifyTierSelectionWrap(-1))}else{for(b=0;b<e.tiers.length;++b)if(e.tiers[b]===m&&(e.browserHolder.focus(),1!=e.selectedTiers.length||e.selectedTiers[0]!=b)){e.setSelectedTier(b);return}m.infoVisible?(m.infoElement.style.display="none",m.updateHeight(),m.infoVisible=!1):(m.infoElement.style.display="block",m.updateHeight(),m.infoVisible=!0)}},!1);m.bumpButton.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();var b;m.dasSource.collapseSuperGroups&&(void 0===b&&(b=!m.bumped),m.mergeConfig({bumped:b}))},!1);var q,C,x,r,l,H=!1,E=function(a){var b=m.label;a.stopPropagation();a.preventDefault();if(!q){C=m.pinned?e.pinnedTierHolder:e.tierHolder;x=C.scrollHeight-C.offsetHeight;q=b.cloneNode(!0);q.style.cursor="pointer";C.appendChild(q);b.style.visibility="hidden";for(var f=0;f<e.tiers.length;++f)if(e.tiers[f]===m){r=f;break}l=a.clientY}var d=C.getBoundingClientRect();
q.style.left=b.getBoundingClientRect().left-d.left+"px";q.style.top=a.clientY-d.top+C.scrollTop-10+"px";b=a.clientY-d.top+C.scrollTop;for(f=0;f<e.tiers.length;++f)if(d=e.tiers[f],!(d.pinned^m.pinned)&&(d=d.row.getBoundingClientRect(),b-=d.bottom-d.top,0>b)){if(f<r&&a.clientY<l||f>r&&a.clientY>l){e.withPreservedSelection(function(){e.tiers.splice(r,1);e.tiers.splice(f,0,m);e._ensureTiersGrouped(f>r)});for(b=0;b<e.tiers.length;++b)e.tiers[b]==m&&(r=b);l=a.clientY;e.reorderTiers();C.appendChild(q);H=
!0}break}q.offsetTop<C.scrollTop?C.scrollTop-=C.scrollTop-q.offsetTop:q.offsetTop+q.offsetHeight>C.scrollTop+C.offsetHeight&&(C.scrollTop=Math.min(C.scrollTop+(q.offsetTop+q.offsetHeight)-(C.scrollTop+C.offsetHeight),x))},p=function(a){var b=m.label;a.stopPropagation();a.preventDefault();q&&(q.style.cursor="auto",C.removeChild(q),q=null,b.style.visibility="visible");document.removeEventListener("mousemove",E,!1);document.removeEventListener("mouseup",p,!1);if(H){for(a=0;a<e.tiers.length;++a)if(e.tiers[a]==
m){e.setSelectedTier(a);break}e.notifyTier()}};m.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();H=!1;document.addEventListener("mousemove",E,!1);document.addEventListener("mouseup",p,!1)},!1);this.tiers.push(m);m.init();m.currentlyHeight=50;this.updateHeight();m.updateLabel();m.featureSource&&m.featureSource.addActivityListener&&m.featureSource.addActivityListener(function(a){m.loaderButton.style.display=0<a?"inline-block":"none";e.pingActivity()});this.withPreservedSelection(e._ensureTiersGrouped);
m._updateFromConfig();this.reorderTiers();return m};p.prototype.reorderTiers=function(){e(this.tierHolder);e(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,b=[],f=[],d=0;d<this.tiers.length;++d){var m=this.tiers[d];m.pinned&&!this.disablePinning?(b.push(m),this.pinnedTierHolder.appendChild(this.tiers[d].row),a=!0):(f.push(m),this.tierHolder.appendChild(this.tiers[d].row))}this.withPreservedSelection(function(){this.tiers.splice(0,
this.tiers.length);for(var a=0;a<b.length;++a)this.tiers.push(b[a]);for(a=0;a<f.length;++a)this.tiers.push(f[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};p.prototype.withPreservedSelection=function(a){for(var b=[],f=0;f<this.selectedTiers.length;++f)b.push(this.tiers[this.selectedTiers[f]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=b.indexOf(this.tiers[a])&&
this.selectedTiers.push(a)};p.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};p.prototype._ensureTiersGrouped=function(a){for(var b={},f=0;f<this.tiers.length;++f){var e=this.tiers[f];e.dasSource.tierGroup&&pusho(b,e.dasSource.tierGroup,e)}var m=[];a&&this.tiers.reverse();for(f=0;f<this.tiers.length;++f)if(e=this.tiers[f],e.dasSource.tierGroup){var d=b[e.dasSource.tierGroup];if(d){a&&d.reverse();for(var g=0;g<d.length;++g)m.push(d[g]);b[e.dasSource.tierGroup]=null}}else m.push(e);
a&&m.reverse();this.tiers.splice(0,this.tiers.length);for(g=0;g<m.length;++g)this.tiers.push(m[g])};p.prototype.arrangeTiers=function(){for(var a=[],b={},f=0;f<this.tiers.length;++f){var e=this.tiers[f];e.pinned&&(a.push(e),e.dasSource.tierGroup&&pusho(b,e.dasSource.tierGroup,e))}for(f=0;f<this.tiers.length;++f)e=this.tiers[f],e.pinned||(a.push(e),e.dasSource.tierGroup&&pusho(b,e.dasSource.tierGroup,e));for(var m in b){var e=b[m],d=this.tierGroups[m];d||(d={element:g("div",g("span",m,{className:"tier-group-label"}),
{className:"tier-group"})},this.tierGroups[m]=d);d.element.parentNode&&d.element.parentNode.removeChild(d.element);for(var k=e[0].pinned?this.pinnedTierHolder:this.tierHolder,n=1E7,z=0,f=0;f<e.length;++f)var t=e[f].row,n=Math.min(n,t.offsetTop),z=Math.max(z,t.offsetTop+t.offsetHeight);d.element.style.top=n+"px";d.element.style.left="0px";d.element.style.height=z-n+"px";k.appendChild(d.element)}if(this.tierBackgroundColors)for(f=0;f<a.length;++f)e=a[f],e.setBackground(this.tierBackgroundColors[f%this.tierBackgroundColors.length]),
e.label.style.left=e.dasSource.tierGroup?"18px":"2px",e.background=this.tierBackgroundColors[f%this.tierBackgroundColors.length]};p.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,b=1E3/this.scale|0,f=(this.viewStart+this.viewEnd)/2,e=f-this.origin;this.origin=f;this.scaleAtLastRedraw=this.scale;for(f=0;f<this.tiers.length;++f){var m=e;this.tiers[f].originHaxx&&(m+=this.tiers[f].originHaxx);this.tiers[f].originHaxx=m}e=this.targetQuantRes/this.scale;f=Math.max(1,(this.viewStart|
0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);m=Math.max(1,(this.viewStart|0)-b);b=Math.min((this.viewEnd|0)+b,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var d=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new B(this.tiers,this.chr,m,b,e,d)}(d=this.knownSpace.bestCacheOverlapping(this.chr,f,a))&&d.min<=f&&d.max>=a?(this.drawnStart=Math.max(d.min,m),this.drawnEnd=
Math.min(d.max,b)):(this.drawnStart=m,this.drawnEnd=b);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,e);this.drawOverlays();this.positionRuler()};p.prototype.queryRegistry=function(a,b){if(!this.registry)return;var f,e;a?(f=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new k),e=this.mappableSources[a]):(f=this.coordSystem,e=this.availableSources);var m=L(t(f));if(b){var d=localStorage["dalliance.registry."+m+".last_queried"];if(d)try{if(r(e,JSON.parse(localStorage["dalliance.registry."+
m+".sources"]),a),432E5>(Date.now()|0)-(d|0))return}catch(g){console.log("Bad registry cache: "+g)}}d=this.registry;if(0==d.indexOf("//")){var n=window.location.protocol;"https:"!=n&&"http:"!=n&&(d="http:"+d)}(new K(d)).sources(function(b){for(var d=[],g=0;g<b.length;++g){var k=b[g];if(k.coords&&0!=k.coords.length){var n=k.coords[0];n.taxon==f.taxon&&n.auth==f.auth&&n.version==f.version&&d.push(k)}}localStorage["dalliance.registry."+m+".sources"]=JSON.stringify(d);localStorage["dalliance.registry."+
m+".last_queried"]=""+Date.now();r(e,d,a)},function(a){},f)};p.prototype.move=function(a,b){var f=this.viewEnd-this.viewStart,e=this.viewStart-1*a/this.scale,m=e+f;b||(0<this.currentSeqMax&&m>this.currentSeqMax&&(m=this.currentSeqMax,e=this.viewEnd-f),1>e&&(e=1,m=e+f));this.setLocation(null,e,m,null,b)};p.prototype.zoomStep=function(a){var b=1*this.zoomSliderValue;a=b+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=b&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};
p.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);
this.notifyLocation();this.refresh()};p.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};p.prototype.resizeViewer=function(a){var b=this.tierHolder.getBoundingClientRect().width|0;if(0!=b){var f=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=b|0;f!=
this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/f,b=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-
b+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+b-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};p.prototype.setFullScreenHeight=function(){var a=this.browserHolder.getBoundingClientRect();this.browserHolder.style.maxHeight=Math.max(100,window.innerHeight-a.top-12)+"px"};p.prototype.addTier=function(a){a=C(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};
p.prototype.removeTier=function(a,b){var f=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)f=a.index;else for(var e=0;e<this.tiers.length;++e)if(y(a,this.tiers[e].dasSource)){f=e;break}if(0>f)throw"Couldn't find requested tier";this.tiers.splice(f,1);for(var e=[],m=0;m<this.selectedTiers.length;++m){var d=this.selectedTiers[m];d<f?e.push(d):d>f&&e.push(d-1)}this.selectedTiers=e;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};p.prototype.getSequenceSource=
function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};p.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new f(b):new z(b)}};p.prototype.setLocation=function(a,
b,f,e,m){if("number"!==typeof b)throw Error("minimum must be a number (got "+JSON.stringify(b)+")");if("number"!==typeof f)throw Error("maximum must be a number (got "+JSON.stringify(f)+")");if(b>f){var d=b;b=f;f=d}else b===f&&(f+=1);e||(e=function(a){if(a)throw a;});var g=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,b,f,null,e,m);var k=this.getSequenceSource();if(!k)return e("Need a sequence source");var n=a||this.chr;k.getSeqInfo(n,function(d){if(d)return g._setLocation(a,
b,f,d,e,m);var z;z=0==n.indexOf("chr")?n.substr(3):"chr"+n;k.getSeqInfo(z,function(d){return!d&&a?e("Couldn't find sequence '"+a+"'"):d?g._setLocation(z,b,f,d,e,m):g._setLocation(null,b,f,null,e,m)})})};p.prototype._setLocation=function(a,b,f,e,m,d){var g=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(g=!0),this.chr=a,this.currentSeqMax=e.length);b=parseFloat(b);f=parseFloat(f);a=Math.max(10,f-b+1);d||(d=this.currentSeqMax,0>=d&&(d=1E12),1>b&&(b=1,f=b+a-1),f>d&&(f=d,b=Math.max(1,f-a+
1)));this.viewStart=b;this.viewEnd=f;b=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);d=1E-6<Math.abs(b-this.scale);this.scale=b;f=this.zoomSliderValue;this.zoomSliderValue=b=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(d||g){for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left="5000px",this.tiers[g].overlay.style.left="5000px";this.refresh();this.savedZoom?(b-=this.zoomMin,f-=this.zoomMin,g=b-this.savedZoom,Math.abs(b-f)>Math.abs(g)&&
(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=f)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[g].norigin)*this.scale)|0)-1E3)+"px",this.tiers[g].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return m()};p.prototype.setCenterLocation=function(a,b){var f=(this.viewEnd-this.viewStart)/2;this.setLocation(a,b-f,b+
f)};p.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,b=0;b<this.tiers.length;++b)"none"!==this.tiers[b].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};p.prototype.addInitListener=function(a){this.initListeners.push(a)};p.prototype.addFeatureListener=function(a,b){this.featureListeners.push(a)};p.prototype.notifyFeature=function(a,b,f,e){for(var m=0;m<
this.featureListeners.length;++m)try{if(this.featureListeners[m](a,b,f,e))break}catch(d){console.log(d.stack)}};p.prototype.addFeatureHoverListener=function(a,b){this.featureHoverListeners.push(a)};p.prototype.notifyFeatureHover=function(a,b,f,e){for(var m=0;m<this.featureHoverListeners.length;++m)try{this.featureHoverListeners[m](a,b,f,e)}catch(d){console.log(d.stack)}};p.prototype.addViewListener=function(a,b){this.viewListeners.push(a)};p.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|
0),b=this.viewEnd|0;0<this.currentSeqMax&&b>this.currentSeqMax&&(b=this.currentSeqMax);for(var f=0;f<this.viewListeners.length;++f)try{this.viewListeners[f](this.chr,a,b,this.zoomSliderValue,{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(e){console.log(e.stack)}};p.prototype.addTierListener=function(a){this.tierListeners.push(a)};p.prototype.notifyTier=function(){for(var a=
0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(b){console.log(b.stack)}};p.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};p.prototype.notifyRegionSelect=function(a,b,f){for(var e=0;e<this.regionSelectListeners.length;++e)try{this.regionSelectListeners[e](a,b,f)}catch(m){console.log(m.stack)}};p.prototype.highlightRegion=function(a,b,f){var e=this;if(a==this.chr)return this._highlightRegion(a,b,f);var m=this.getSequenceSource();if(!m)throw"Need a sequence source";
m.getSeqInfo(a,function(d){if(d)return e._highlightRegion(a,b,f);var g;g=0==a.indexOf("chr")?a.substr(3):"chr"+a;m.getSeqInfo(g,function(a){if(a)return e._highlightRegion(g,b,f)})})};p.prototype._highlightRegion=function(a,b,f){for(var e=0;e<this.highlights.length;++e){var m=this.highlights[e];if(m.chr==a&&m.min==b&&m.max==f)return}this.highlights.push(new l(a,b,f));e=this.viewStart-1E3/this.scale;m=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&b<m&&f>e&&this.drawOverlays();this.notifyLocation()};
p.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};p.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};p.prototype.featuresInRegion=function(a,b,f){var e=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var m=this.tiers[a].currentFeatures||[],d=0;d<m.length;++d){var g=m[d];g.min<=f&&g.max>=b&&e.push(g)}return e};p.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?
this.selectedTiers[0]:-1};p.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};p.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var b=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?b.classList.add("active"):b.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+
window.innerHeight&&this.browserHolder.focus())};p.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};p.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(b){console.log(b.stack)}};p.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};p.prototype.notifyTierSelectionWrap=function(a){for(var b=0;b<this.tierSelectionWrapListeners.length;++b)try{this.tierSelectionWrapListeners[b](a)}catch(f){console.log(f.stack)}};
p.prototype.positionRuler=function(){var a="none",b="",f="";"center"==this.rulerLocation?(a="block",b=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",b="0px"):"right"==this.rulerLocation?(a="block",f="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=b;this.ruler.style.right=f;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):
(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var e=
0;e<this.tiers.length;++e){var m=this.tiers[e],d=m.quantOverlay,g;m.subtiers&&0<m.subtiers.length&&(g=m.subtiers[0].quant);d&&(d.style.display=g?a:"none",d.style.left=b,d.style.right=f)}};p.prototype.featureDoubleClick=function(a,b,f){if(a&&0!=a.length&&(f=a[a.length-1],f.min&&f.max)){var e=((f.min|0)-(this.viewStart|0))*this.scale,m=(f.max-f.min+1)*this.scale;a=((f.min|0)+(f.max|0))/2;10<m&&(b=1*(b-e)/m,0.3>b?a=f.min|0:0.7<b&&(a=(f.max|0)+1));b=this.viewEnd-this.viewStart;this.setLocation(null,a-
b/2,a+b/2)}};p.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};p.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};p.prototype.updateHeight=function(){for(var a=0,b=0;b<this.tiers.length;++b)a+=this.tiers[b].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="flex"};p.prototype.scrollArrowKey=function(a,b){this.reverseKeyScrolling&&
(b=-b);if(a.ctrlKey||a.metaKey){var f=!1;a.shiftKey&&(f=!0);this.leap(b,f)}else if(1<this.scale){var f=(this.viewStart+this.viewEnd)/2,f=f-Math.round(f),e=1;a.shiftKey&&(e*=10);0<b?(e=-e-f,0<f&&(e+=1)):(e-=f,0>f&&(e-=1));this.setLocation(null,this.viewStart+e,this.viewEnd+e)}else this.move(a.shiftKey?100*b:25*b)};p.prototype.leap=function(a,b){var f=this,e=(f.viewStart+f.viewEnd+1)/2|0;0<a&&1>=f.viewStart?e-=1E8:0>a&&f.viewEnd>=f.currentSeqMax&&(e+=1E8);var m=f.getSelectedTier();0>m||((m=f.tiers[m])&&
(m.featureSource&&this.sourceAdapterIsCapable(m.featureSource,"quantLeap")&&"number"==typeof m.quantLeapThreshold||m.featureSource&&this.sourceAdapterIsCapable(m.featureSource,"leap"))?m.findNextFeature(f.chr,e,-a,b,function(m){if(m){var d=m.min,g=m.max;b&&(0<a?d>e+1?g=d:(g++,d=g):g<e-1?(g++,d=g):g=d);var k=f.viewEnd-f.viewStart+1;parseFloat(k/2)==parseInt(k/2)&&k--;d=(d+g-k)/2+1;f.setLocation(m.segment,d,d+k-1)}else alert("no next feature")}):this.move(100*a))};p.prototype.nameForCoordSystem=function(a){var b=
null,f=null;this.assemblyNamePrimary&&(b=""+a.auth,"undefined"!==typeof a.version&&(b+=a.version));this.assemblyNameUcsc&&(f=a.ucscName);return null!=b&&null!=f?b+"/"+f:b||f||"unknown"};p.prototype.makeLoader=function(a){var b=1<window.devicePixelRatio;return 20>(a||16)?g("img",null,{src:this.resolveURL("$$img/spinner_"+(b?16:32)+".gif"),width:"16",height:"16"}):g("img",null,{src:this.resolveURL("$$img/spinner_"+(b?24:48)+".gif"),width:"24",height:"24"})};p.prototype.getWorker=function(){if(!this.useFetchWorkers||
!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};a.prototype.postCommand=function(a,b,f){var e="x"+ ++this.tagSeed;a.tag=e;this.callbacks[e]=b;this.worker.postMessage(a,f)};if("undefined"!==typeof u){u.exports={Browser:p,sourcesAreEqual:y,sourceDataURI:h};c("./browser-ui");c("./track-adder");c("./track-adder-custom");c("./feature-popup");c("./tier-actions");c("./domui");c("./search");
u=c("./sourceadapters");var f=u.TwoBitSequenceSource,z=u.DASSequenceSource,B=c("./kspace").KnownSpace,K=c("./das").DASRegistry}d.prototype.get=function(a){var b=this.sourcesByURI[h(a)];if(b)for(var f=0;f<b.configs.length;++f)if(q(b.configs[f],a))return b.sources[f]};d.prototype.put=function(a,b){var f=h(a),e=this.sourcesByURI[f];e||(e={configs:[],sources:[]},this.sourcesByURI[f]=e);e.configs.push(a);e.sources.push(b)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,
"./kspace":23,"./numformats":26,"./search":30,"./sha1":33,"./sourceadapters":34,"./thub":41,"./tier":44,"./tier-actions":42,"./track-adder":46,"./track-adder-custom":45,"./utils":50,"./version":52,"es6-promise":54}],7:[function(c,u,s){function l(a,b,e,g){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=e,this.coords=g):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=d(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest=
{};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new r(this.uri,this.credentials):"alias"==this.type?new y(a):new p(this.uri,this.srcTag,this.destTag)}function p(a,e,d){this.source=new b(a);this.srcTag=e;this.destTag=d}function r(a,b){var d=this;this.uri=a;this.credentials=b;this.bwg=new t(function(a,b){e(new g(d.uri,{credentials:d.credentials}),function(e,d){e?a(e):b(d)})});this.bwg.then(function(a,b){b&&console.log(b)})}function h(a){return parseInt(a)}
function v(a){return 0==a.indexOf("chr")?a.substr(3):a}function q(a){var b={srcChr:v(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:v(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},e=a.srcStarts.split(",").map(h),d=a.destStarts.split(",").map(h);a=a.blockLens.split(",").map(h);for(var g=0;g<e.length;++g)b.blocks.push([e[g],d[g],a[g]]);return b}function y(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var e=
a[b];if(!(2>e.length)){for(var d=[],g=0;g<e.length-1;++g)d.push(e[g]);this.forwardAliases[e[e.length-1]]=d}}}if("undefined"!==typeof c){s=c("./das");var b=s.DASSource,a=s.DASSegment;s=c("./utils");var n=s.pusho,d=s.shallowCopy,k=c("./cigar").parseCigar,g=c("./bin").URLFetchable,e=c("./bigwig").makeBwg,t=c("es6-promise").Promise}l.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};l.prototype.mapPoint=
function(a,b){for(var e=this.chainsBySrc[a]||[],d=0;d<e.length;++d){var g=e[d];if(b>=g.srcMin&&b<=g.srcMax){var k;k="-"==g.srcOri?g.srcMax-b:b-g.srcMin;for(var n=g.blocks,t=0;t<n.length;++t){var h=n[t],f=h[0],z=h[1],h=h[2];if(k>=f&&k<=f+h)return e=k-f,{seq:g.destChr,pos:"-"==g.destOri?g.destMax-z-e:e+z+g.destMin,flipped:g.srcOri!=g.destOri}}}}return null};l.prototype.mapSegment=function(a,b,e){a=this.chainsBySrc[a]||[];for(var d=[],g=0;g<a.length;++g){var k=a[g];if(e>=k.srcMin&&b<=k.srcMax){var n,
t;"-"==k.srcOri?(n=k.srcMax-e,t=k.srcMax-b):(n=b-k.srcMin,t=e-k.srcMin);for(var h=k.blocks,f=0;f<h.length;++f){var z=h[f],q=z[0],c=z[1],z=z[2];if(t>=q&&n<=q+z){var w={segment:k.destChr,flipped:"-"==k.srcOri^"-"==k.destOri};"-"==k.destOri?(n>=q?w.max=k.destMax-c-n+q:(w.max=k.destMax-c,w.partialMax=q-n),t<=q+z?w.min=k.destMax-c-t+q:(w.min=k.destMax-c-z,w.partialMin=t-q-z)):(n>=q?w.min=k.destMin+c+n-q:(w.min=k.destMin+c,w.partialMin=q-n),t<=q+z?w.max=k.destMin+c+t-q:(w.max=k.destMin+c+z,w.partialMax=
t-q-z));d.push(w)}}}}return d};l.prototype.unmapPoint=function(a,b){for(var e=this.chainsByDest[a]||[],d=0;d<e.length;++d){var g=e[d];if(b>=g.destMin&&b<=g.destMax){var k;k="-"==g.srcOri?g.destMax-b:b-g.destMin;for(var n=g.blocks,t=0;t<n.length;++t){var h=n[t],f=h[0],z=h[1],h=h[2];if(k>=z&&k<=z+h)return e=k-z,d=e+f+g.srcMin,d="-"==g.destOri?g.srcMax-f-e:e+f+g.srcMin,{seq:g.srcChr,pos:d,flipped:g.srcOri!=g.destOri}}}}return null};l.prototype.sourceBlocksForRange=function(b,e,d,g){for(var k=this,t=
e/this.granularity|0,h=d/this.granularity|0,q=!1,c=t;c<=h;++c){var f=b+"_"+c;2!=this.fetchedTiles[f]&&(q=!0,1!=this.fetchedTiles[f]&&(this.fetchedTiles[f]=1))}if(q)this.postFetchQueues[b]||this.chainFetcher.fetchChains(b,t*this.granularity,(h+1)*this.granularity-1).then(function(a){k.chainsByDest||(k.chainsByDest[b]=[]);for(var f=0;f<a.length;++f){var m=a[f],e=k.chainsBySrc[m.srcChr];if(e){for(var d=!1,g=0;g<e.length;++g){var n=e[g];if(n.srcMin==m.srcMin&&n.srcMax==m.srcMax){d=!0;break}}d||e.push(m)}else k.chainsBySrc[m.srcChr]=
[m];if(e=k.chainsByDest[m.destChr]){d=!1;for(g=0;g<e.length;++g)if(n=e[g],n.destMin==m.destMin&&n.destMax==m.destMax){d=!0;break}d||e.push(m)}else k.chainsByDest[m.destChr]=[m]}for(a=t;a<=h;++a)k.fetchedTiles[b+"_"+a]=2;if(k.postFetchQueues[b]){a=k.postFetchQueues[b];for(f=0;f<a.length;++f)a[f]();k.postFetchQueues[b]=null}}).catch(function(a){console.log(a)}),n(this.postFetchQueues,b,function(){k.sourceBlocksForRange(b,e,d,g)});else{q=[];c=this.chainsByDest[b]||[];for(f=0;f<c.length;++f){var z=c[f];
if(e<=z.destMax&&d>=z.destMin){var B,r;"-"==z.srcOri?(B=z.destMax-d,r=z.destMax-e):(B=e-z.destMin,r=d-z.destMin);for(var w=z.blocks,l=0;l<w.length;++l){var A=w[l],p=A[0],m=A[1],F=A[2];r>=m&&B<=m+F&&(A=Math.max(B,m)-m,m=Math.min(r,m+F)-m,"-"==z.destOri?q.push(new a(z.srcChr,z.srcMax-p-m,z.srcMax-p-A)):q.push(new a(z.srcChr,z.srcMin+A+p,z.srcMin+m+p)))}}}g(q)}};p.prototype.fetchChains=function(a,b,e){var d=this;return new t(function(b,e){d.source.alignments(a,{},function(a){for(var e=[],g=0;g<a.length;++g)for(var f=
a[g],n=0;n<f.blocks.length;++n){for(var t=f.blocks[n],h,q,c=0;c<t.segments.length;++c){var r=t.segments[c],l=f.objects[r.object];l.dbSource===d.srcTag?h=r:l.dbSource===d.destTag&&(q=r)}if(h&&q){for(var t={srcChr:f.objects[h.object].accession,srcMin:h.min|0,srcMax:h.max|0,srcOri:h.strand,destChr:f.objects[q.object].accession,destMin:q.min|0,destMax:q.max|0,destOri:q.strand,blocks:[]},c=k(h.cigar),r=k(q.cigar),m=l=0,F=0,C=0;F<c.length&&C<r.length;)if("M"==c[F].op&&"M"==r[C].op){var p=Math.min(c[F].cnt,
r[C].cnt);t.blocks.push([l,m,p]);c[F].cnt==p?++F:c[F].cnt-=p;r[C].cnt==p?++C:r[C]-=p;l+=p;m+=p}else"I"==c[F].op?m+=c[F++].cnt:"I"==r[C].op&&(l+=r[C++].cnt);e.push(t)}}b(e)})})};r.prototype.fetchChains=function(a,b,e){return this.bwg.then(function(d,g){if(!d)throw Error("No BWG");return new t(function(g,k){d.getUnzoomedView().readWigData(a,b,e,function(a){g(a.map(q))})})})};y.prototype.fetchChains=function(a,b,e){b=[];e=this.forwardAliases[a]||[];for(var d=0;d<e.length;++d)b.push({srcChr:e[d],srcMin:1,
srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return t.resolve(b)};"undefined"!==typeof u&&(u.exports={Chainset:l})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":50,"es6-promise":54}],8:[function(c,u,s){function l(c){for(var h=[],l;null!=(l=p.exec(c));){var q=l[1];0==q.length&&(q=1);h.push({cnt:q|0,op:l[2]})}return h}var p=/([0-9]*)([MIDS])/g;"undefined"!==typeof u&&(u.exports={parseCigar:l})},{}],9:[function(c,u,s){function l(a,b,d,k){this.red=
a|0;this.green=b|0;this.blue=d|0;k&&(this.name=k)}function p(a){a="00"+a.toString(16);return a.substring(a.length-2)}function r(a){var n=q[a];n||((n=y.exec(a))?n=new l("0x"+n[1]|0,"0x"+n[2]|0,"0x"+n[3]|0,a):(n=b.exec(a))?n=new l(n[1]|0,n[2]|0,n[3]|0,a):(console.log("couldn't handle color: "+a),n=q.black),q[a]=n);return n}function h(a,b,d){for(var k=[],g=0;g<d.length;++g)k.push(r(d[g]));d=[];g=0;a:for(;g<a;++g){for(var e=b[0]+1*g/(a-1)*(b[b.length-1]-b[0]),t=0;t<b.length-1;++t)if(e>=b[t]&&e<=b[t+1]){var e=
(e-b[t])/(b[t+1]-b[t]),h=k[t],t=k[t+1],t=(new l(h.red*(1-e)+t.red*e|0,h.green*(1-e)+t.green*e|0,h.blue*(1-e)+t.blue*e|0)).toSvgString();d.push(t);continue a}throw"Bad step";}return d}function v(a,b,d,k){return k?h(a,[0,0.5,1],[b,d,k]):h(a,[0,1],[b,d])}l.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};l.prototype.toHexString=function(){return"#"+p(this.red)+p(this.green)+p(this.blue)};var q={red:new l(255,0,0,"red"),green:new l(0,
255,0,"green"),blue:new l(0,0,255,"blue"),yellow:new l(255,255,0,"yellow"),white:new l(255,255,255,"white"),black:new l(0,0,0,"black"),gray:new l(180,180,180,"gray"),grey:new l(180,180,180,"grey"),lightskyblue:new l(135,206,250,"lightskyblue"),lightsalmon:new l(255,160,122,"lightsalmon"),hotpink:new l(255,105,180,"hotpink")},y=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,b=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof u&&(u.exports={makeColourSteps:h,makeGradient:v,dasColourForName:r})},
{}],10:[function(c,u,s){function l(a,b,f,e){this.name=a;this.start=b;this.end=f;this.description=e}function p(a,b){var f;"string"==typeof a?(this.uri=a,f=b||{}):f=a||{};for(var e in f)"function"!=typeof f[e]&&(this[e]=f[e]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function r(){}function h(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function v(a,b,f,e,d){this.name=
a;this.start=b;this.end=f;this.alphabet=e;this.seq=d}function q(){}function y(a){a&&(this.id=a)}function b(a,b){this.desc=a;this.uri=b}function a(a){this.type=a;this.objects={};this.blocks=[]}function n(){this.styles=[]}function d(){}function k(a,b){b=b||{};this.uri=a;this.opts=b}function g(a,b){var f=a.getElementsByTagName(b);if(0<f.length&&f[0].firstChild){f=f[0];if(1==f.childNodes.length)return f.firstChild.nodeValue;for(var e="",d=0;d<f.childNodes.length;++d)e+=f.childNodes[d].nodeValue;return e}return null}
function e(a){for(var e=[],f=a.getElementsByTagName("LINK"),d=0;d<f.length;++d){var g=f[d];g.parentNode==a&&e.push(new b(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return e}function t(a){var b=[];a=a.getElementsByTagName("NOTE");for(var f=0;f<a.length;++f)a[f].firstChild&&b.push(a[f].firstChild.nodeValue);return b}function C(a,b,f,e){if(window.XDomainRequest){var d=new XDomainRequest;d.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(d.responseText);
b(a)};d.open("get",a)}else Date.now(),d=new XMLHttpRequest,d.onreadystatechange=function(){4==d.readyState&&(200<=d.status||0==d.status)&&b(d.responseXML,d)},d.open("get",a,!0),f&&(d.withCredentials=!0),e&&d.setRequestHeader("X-DAS-Authorisation",e),d.overrideMimeType("text/xml"),d.setRequestHeader("Accept","application/xml,*/*");d.send("")}function R(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function L(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function E(a){var b=
N(a);b.styles=[];for(var f=0;f<a.styles.length;++f){var e=b.styles[f]=N(a.styles[f]);e._methodRE=e._labelRE=e._typeRE=void 0;e.style=N(e.style);e.style.id=void 0;e.style._gradient=void 0}return b}if("undefined"!==typeof c){s=c("./utils");var N=s.shallowCopy,P=s.pusho,x=c("./color").makeColourSteps}l.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};l.prototype.isBounded=function(){return this.start&&this.end};l.prototype.toDASQuery=function(){var a="segment="+this.name;
this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};p.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var f=[];b=b.getElementsByTagName("SEGMENT");for(var e=0;e<b.length;++e){var d=b[e],g=d.getAttribute("id"),k=d.getAttribute("size"),n;k?(n=1,k|=0):((n=d.getAttribute("start"))&&(n|=0),(k=d.getAttribute("stop"))&&(k|=0));var t=null;d.firstChild&&(t=d.firstChild.nodeValue);f.push(new l(g,n,k,t))}a(f)})};p.prototype.sequence=
function(a,b){var f=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(f,function(a){if(a){var f=[];a=a.getElementsByTagName("SEQUENCE");for(var e=0;e<a.length;++e){var d=a[e],g=d.getAttribute("id"),k=d.getAttribute("start"),n=d.getAttribute("stop"),m=null;if(d.firstChild)for(var d=d.firstChild.nodeValue,m="",t=0;;){var h=d.indexOf("\n",t);if(0<=h)m+=d.substring(t,h).toUpperCase(),t=h+1;else{m+=d.substring(t).toUpperCase();break}}f.push(new v(g,k,n,"DNA",m))}b(f)}else b([])})};p.prototype.features=
function(a,b,f){b=b||{};var d;if(this.features_uri)d=this.features_uri;else{var k=[];if(a)k.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)k.push("group_id="+a);else for(var n=0;n<a.length;++n)k.push("group_id="+a[n]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),n=0;n<a.length;++n)k.push("adjacent="+a[n]);if(b.type)if("string"==typeof b.type)k.push("type="+b.type);else for(a=0;a<b.type.length;++a)k.push("type="+b.type[a]);b.maxbins&&k.push("maxbins="+b.maxbins);
0<k.length?d=this.dasBaseURI+"features?"+k.join(";"):f([],"No filters specified")}this.doCrossDomainRequest(d,function(a,b){if(a){for(var d=[],k={},m=a.getElementsByTagName("SEGMENT"),n=0;n<m.length;++n){var h=m[n],z=h.getAttribute("id");k[z]={min:h.getAttribute("start"),max:h.getAttribute("stop")};for(var h=h.getElementsByTagName("FEATURE"),c=0;c<h.length;++c){var r=h[c],l=new q;l.segment=z;l.id=r.getAttribute("id");l.label=r.getAttribute("label");var B=g(r,"START"),x=g(r,"END");(B|0)>(x|0)?(l.min=
x|0,l.max=B|0):(l.min=B|0,l.max=x|0);B=r.getElementsByTagName("TYPE");0<B.length&&(B=B[0],B.firstChild&&(l.type=B.firstChild.nodeValue),l.typeId=B.getAttribute("id"),l.typeCv=B.getAttribute("cvId"));l.type=g(r,"TYPE");!l.type&&l.typeId&&(l.type=l.typeId);l.method=g(r,"METHOD");(B=g(r,"ORIENTATION"))||(B="0");l.orientation=B;l.score=g(r,"SCORE");l.links=e(r);l.notes=t(r);B=r.getElementsByTagName("GROUP");for(x=0;x<B.length;++x){var p=B[x],C=new y;C.type=p.getAttribute("type");C.id=p.getAttribute("id");
C.links=e(p);C.notes=t(p);l.groups?l.groups.push(C):l.groups=Array(C)}if(l.notes)for(B=0;B<l.notes.length;++B)x=l.notes[B],0==x.indexOf("Genename=")&&(p=new y,p.type="gene",p.id=x.substring(9),l.groups?l.groups.push(p):l.groups=Array(p));B=r.getElementsByTagName("PART");if(0<B.length){p=[];for(x=0;x<B.length;++x)p.push(B[x].getAttribute("id"));l.parts=p}B=r.getElementsByTagName("PARENT");if(0<B.length){r=[];for(x=0;x<B.length;++x)r.push(B[x].getAttribute("id"));l.parents=r}d.push(l)}}f(d,void 0,k)}else f([],
"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){f([],a)})};p.prototype.alignments=function(b,e,f){var d=this.dasBaseURI+"alignment?query="+b;this.doCrossDomainRequest(d,function(b){if(b){var e=[];b=b.getElementsByTagName("alignment");for(var k=0;k<b.length;++k){for(var n=b[k],t=new a(n.getAttribute("alignType")),h=n.getElementsByTagName("alignObject"),m=0;m<h.length;++m){var q=h[m],q={id:q.getAttribute("intObjectId"),accession:q.getAttribute("dbAccessionId"),
version:q.getAttribute("objectVersion"),dbSource:q.getAttribute("dbSource"),dbVersion:q.getAttribute("dbVersion")};t.objects[q.id]=q}n=n.getElementsByTagName("block");for(h=0;h<n.length;++h){for(var q=n[h],m={order:q.getAttribute("blockOrder"),segments:[]},q=q.getElementsByTagName("segment"),c=0;c<q.length;++c){var l=q[c],l={object:l.getAttribute("intObjectId"),min:l.getAttribute("start"),max:l.getAttribute("end"),strand:l.getAttribute("strand"),cigar:g(l,"cigar")};m.segments.push(l)}t.blocks.push(m)}e.push(t)}f(e)}else f([],
"Failed request "+d)})};n.prototype.pushStyle=function(a,b,f){a||(a={type:"default"});a=N(a);b&&(a.zoom=b);a.style=f;this.styles.push(a)};p.prototype.stylesheet=function(a,b){var f,e=this.credentials;this.stylesheet_uri?(f=this.stylesheet_uri,e=!1):f=this.dasBaseURI+"stylesheet";C(f,function(f){if(f){var e=new n;f=f.getElementsByTagName("TYPE");for(var g=0;g<f.length;++g){var k=f[g],t={};t.type=k.getAttribute("id");t.label=k.getAttribute("label");t.method=k.getAttribute("method");for(var k=k.getElementsByTagName("GLYPH"),
h=0;h<k.length;++h){var m=k[h],q=m.getAttribute("zoom"),c;a:{if(m.hasChildNodes()){m=m.firstChild;do{if(m.nodeType==Node.ELEMENT_NODE){c=m;break a}m=m.nextSibling}while(null!=m)}c=null}m=new d;m.glyph=c.localName;for(c=c.firstChild;c;){if(c.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==c.localName){var z=m,l=c.localName,r,p=c;r=(r=p.getAttribute("steps"))?r|0:50;for(var C=[],y=[],p=p.getElementsByTagName("STOP"),E=0;E<p.length;++E){var v=p[E];C.push(1*v.getAttribute("score"));y.push(v.firstChild.nodeValue)}r=
x(r,C,y);z[l]=r}else m[c.localName]=c.firstChild.nodeValue;c=c.nextSibling}e.pushStyle(t,q,m)}}a(e)}else b&&b()},e)};k.prototype.sources=function(a,b,f){f||(f={});var e=[];f.taxon&&e.push("organism="+f.taxon);f.auth&&e.push("authority="+f.auth);f.version&&e.push("version="+f.version);f=this.uri;0<e.length&&(f=f+"?"+e.join("&"));C(f,function(f){if(!f&&b)b();else{var e=[];f=f.getElementsByTagName("SOURCE");for(var d=0;d<f.length;++d){var g=f[d],k=g.getElementsByTagName("VERSION");if(!(1>k.length)){for(var n=
k[0],m=n.getElementsByTagName("COORDINATES"),k=[],t=0;t<m.length;++t){var h=m[t],c=new r;c.auth=h.getAttribute("authority");c.taxon=h.getAttribute("taxid");c.version=h.getAttribute("version");k.push(c)}for(var m=[],h=n.getElementsByTagName("CAPABILITY"),q,t=0;t<h.length;++t)c=h[t],m.push(c.getAttribute("type")),"das1:features"==c.getAttribute("type")&&(q=c.getAttribute("query_uri"),q=q.substring(0,q.length-8));t={};n=n.getElementsByTagName("PROP");for(h=0;h<n.length;++h)P(t,n[h].getAttribute("name"),
n[h].getAttribute("value"));q&&(g=new p(q,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),desc:g.getAttribute("description"),coords:k,props:t,capabilities:m}),e.push(g))}}a(e)}})};p.prototype.doCrossDomainRequest=function(a,b,f){var e;this.xUser&&(e="Basic "+btoa(this.xUser+":"+this.xPass));try{return C(a,b,this.credentials,e)}catch(d){if(f)f(d);else throw d;}};"undefined"!==typeof u&&(u.exports={DASGroup:y,DASFeature:q,DASStylesheet:n,DASStyle:d,DASSource:p,DASSegment:l,DASRegistry:k,
DASSequence:v,DASLink:b,isDasBooleanTrue:R,isDasBooleanNotFalse:L,copyStylesheet:E,coordsMatch:h})},{"./color":9,"./utils":50}],11:[function(c,u,s){function l(h,c,l){function b(){l?(a.className="fa fa-caret-down",c.style.display="table"):(a.className="fa fa-caret-right",c.style.display="none")}var a=r("i");b();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();l=!l;b()},!1);h=r("h6",[a," ",h],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",
margin:"0px"});return r("div",[h,c],{})}if("undefined"!==typeof c){var p=c("./cbrowser").Browser;c=c("./utils");var r=c.makeElement,h=c.removeChildren}p.prototype.removeAllPopups=function(){h(this.hPopupHolder);h(this.popupHolder)};p.prototype.makeTooltip=function(h,c){var l=!1,b=this,a=null,n;n=function(b){l=!1;a&&(clearTimeout(a),a=null);h.removeEventListener("mouseout",n,!1)};var d=function(k){var g=k.clientX+window.scrollX,e=k.clientY+window.scrollY;a||(a=setTimeout(function(){var k;k="function"===
typeof c?c():c;var n=r("div",[r("div",null,{className:"tooltip-arrow"}),r("div",k,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(e+20)+"px",left:""+Math.max(g-30,20)+"px"});b.hPopupHolder.appendChild(n);var p;p=function(a){try{b.hPopupHolder.removeChild(n)}catch(e){}window.removeEventListener("mousemove",p,!1);l&&null!=h.offsetParent&&d(a)};window.addEventListener("mousemove",p,!1);a=null},1E3))};h.addEventListener("mouseover",function(a){l=!0;h.addEventListener("mouseout",
n,!1);d(a)},!1);h.addEventListener("DOMNodeRemovedFromDocument",function(b){l=!1;a&&(clearTimeout(a),a=null)},!1)};p.prototype.popit=function(h,c,l,b){var a=this;b||(b={});h||(h={});var n=b.width||200,d;h.clientX?(b=h.clientX,d=h.clientY):(b=500,d=50);b+=document.documentElement.scrollLeft||document.body.scrollLeft;d+=document.documentElement.scrollTop||document.body.scrollTop;var k=window.innerWidth,g=d,e=Math.min(b-n/2-4,k-n-30),t=r("div");t.className="popover fade "+(h.clientX?"bottom ":"")+"in";
t.style.display="block";t.style.position="absolute";t.style.top=""+g+"px";t.style.left=""+e+"px";t.style.width=n+"px";276<n&&(t.style.maxWidth=n+"px");t.appendChild(r("div",null,{className:"arrow"}));if(c){var p=r("button","",{className:"close"});p.innerHTML="&times;";p.addEventListener("mouseover",function(a){p.style.color="red"},!1);p.addEventListener("mouseout",function(a){p.style.color="black"},!1);p.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();a.removeAllPopups()},
!1);h=r("h4",[r("span",c,null,{maxWidth:"200px"}),p],{},{paddingLeft:"10px",paddingRight:"10px"});var R,L,E,N;E=function(a){a.stopPropagation();a.preventDefault();e+=a.clientX-R;8>e&&(e=8);e>k-n-32&&(e=k-n-26);g+=a.clientY-L;g=Math.max(10,g);t.style.top=""+g+"px";t.style.left=""+Math.min(e,k-n-10)+"px";R=a.clientX;L=a.clientY};N=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",E,!1);window.removeEventListener("mouseup",N,!1)};h.addEventListener("mousedown",
function(a){a.preventDefault();a.stopPropagation();R=a.clientX;L=a.clientY;window.addEventListener("mousemove",E,!1);window.addEventListener("mouseup",N,!1)},!1);t.appendChild(h)}t.appendChild(r("div",l,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(t);var P={node:t,displayed:!0};t.addEventListener("DOMNodeRemoved",function(a){a.target==t&&(P.displayed=!1)},!1);return P};"undefined"!==typeof u&&(u.exports={makeTreeTableSection:l})},{"./cbrowser":6,"./utils":50}],12:[function(c,
u,s){function l(c,q){0>c.indexOf("?")&&(c+="?soft=true");return new h(function(h,b){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)if(300<=a.status)b("Error code "+a.status);else{var n=JSON.parse(a.response);h(q?n:n.location)}};a.open("GET",c,!0);a.setRequestHeader("Accept","application/json");a.responseType="text";a.send("")})}function p(h){this.rawurl=h}function r(h,c,l,b){b||("object"===typeof c?(b=c,c=void 0):b={});this.url="string"===typeof h?new p(h):h;this.start=
c||0;l&&(this.end=l);this.opts=b}if("undefined"!==typeof c)var h=c("es6-promise").Promise;p.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=l(this.rawurl,!0).then(function(h){return h.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};r.prototype.slice=function(h,c){if(0>h)throw"Bad slice "+h;var l=this.start,b=this.end,l=l&&h?l+h:h||l;return new r(this.url,l,c&&l?l+c-1:b||c-1,this.opts)};r.prototype.fetchAsText=function(h){var c=
this,l=new XMLHttpRequest;c.url.getURLPromise().then(function(b){l.open("GET",b,!0);if(c.end){if(1E8<c.end-c.start)throw"Monster fetch!";l.setRequestHeader("Range","bytes="+c.start+"-"+c.end)}l.onreadystatechange=function(){if(4==l.readyState)return 200==l.status||206==l.status?h(l.responseText):h(null)};c.opts.credentials&&(l.withCredentials=!0);l.send("")}).catch(function(b){console.log(b);return h(null)})};r.prototype.salted=function(){return this};r.prototype.fetch=function(h,c,l){var b=this;
c=c||1;if(3<c)return h(null);b.url.getURLPromise().then(function(a){var n=new XMLHttpRequest,d;n.open("GET",a,!0);n.overrideMimeType("text/plain; charset=x-user-defined");if(b.end){if(1E8<b.end-b.start)throw"Monster fetch!";n.setRequestHeader("Range","bytes="+b.start+"-"+b.end);d=b.end-b.start+1}n.responseType="arraybuffer";n.onreadystatechange=function(){if(4==n.readyState){if(200==n.status||206==n.status){if(n.response){var a=n.response.byteLength;return!d||d==a||l&&a==l?h(n.response):b.fetch(h,
c+1,a)}if(n.mozResponseArrayBuffer)return h(n.mozResponseArrayBuffer);a=n.responseText;if(!d||d==a.length||l&&a.length==l){if(a=n.responseText){for(var g=new Uint8Array(a.length),e=0;e<g.length;++e)g[e]=a.charCodeAt(e);a=g.buffer}else a=null;return h(a)}return b.fetch(h,c+1,a.length)}return b.fetch(h,c+1)}};b.opts.credentials&&(n.withCredentials=!0);n.send("")}).catch(function(a){console.log(a)})};"undefined"!==typeof u&&(u.exports={lookupEncodeURI:l,EncodeFetchable:r})},{"es6-promise":54}],13:[function(c,
u,s){function l(h){this.source=h;this.base=h.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var b=window.location.protocol;"http:"!=b&&"https:"!=b&&(this.base="http:"+this.base)}this.species=h.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof h.type?[h.type]:h.type||["regulatory"]}if("undefined"!==typeof c){var p=c("./sourceadapters").registerSourceAdapterFactory;c=c("./das");var r=c.DASStylesheet,h=c.DASStyle,v=c.DASFeature,q=c.DASGroup}l.prototype.addActivityListener=
function(h){this.activityListeners.push(h)};l.prototype.notifyActivity=function(){for(var h=0;h<this.activityListeners.length;++h)try{this.activityListeners[h](this.busy)}catch(b){console.log(b)}};l.prototype.getStyleSheet=function(c){var b=new r,a=new h;a.glyph="__NONE";0<=this.type.indexOf("exon")&&b.pushStyle({type:"transcript"},null,a);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,a);a=new h;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="red";a.HEIGHT=
8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=10;b.pushStyle({type:"cds"},null,a);a=new h;a.glyph="SQUARE";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:".+_UTR_variant"},null,a);a=new h;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"missense_variant"},null,a);a=new h;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,a);
a=new h;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,a);a=new h;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="rgb(50,80,255)";a.STROKECOLOR="black";b.pushStyle({type:"variation"},null,a);a=new h;a.glyph="SQUARE";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,a);a=new h;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL=
"no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},null,a);a=new h;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,a);a=new h;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,a);a=new h;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";
a.FGCOLOR="red";a.STROKECOLOR="black";b.pushStyle({type:"indel"},null,a);a=new h;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="orange";a.HEIGHT=8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=20;b.pushStyle({type:"default"},null,a);return c(b)};l.prototype.getScales=function(){return[]};l.prototype.fetch=function(h,b,a,n,d,k,g){var e=this;b=this.base+"/overlap/region/"+this.species+"/"+h+":"+b+"-"+a;a=[];for(n=0;n<this.type.length;++n)a.push("feature="+this.type[n]);a.push("content-type=application/json");b=b+"?"+a.join(";");
var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState)if(e.busy--,e.notifyActivity(),300<=t.status){var a="Error code "+t.status;try{var b=JSON.parse(t.response);b.error&&(a=b.error)}catch(d){}g(a,null)}else{for(var a=JSON.parse(t.response),b=[],k=0;k<a.length;++k){var n=a[k],c=[],l=new v;l.segment=h;l.min=n.start|0;l.max=n.end|0;l.type=n.feature_type||"unknown";l.id=n.ID;if(n.Parent){var r=new q;r.id=n.Parent;l.groups=[r]}n.strand&&(0>n.strand?l.orientation="-":0<n.strand&&
(l.orientation="+"));n.consequence_type&&(l.method=n.consequence_type);n.alt_alleles&&(c.push("Alleles="+n.alt_alleles.join("/")),1<n.alt_alleles.length&&(n.alt_alleles[1].length!=n.alt_alleles[0].length||"-"==n.alt_alleles[1])&&(l.type="indel"));0<c.length&&(l.notes=c);b.push(l)}g(null,b)}};e.busy++;e.notifyActivity();t.open("GET",b,!0);t.responseType="text";t.send("")};p("ensembl",function(h){return{features:new l(h)}})},{"./das":10,"./sourceadapters":34}],14:[function(c,u,s){if("undefined"!==typeof c)var l=
c("./cbrowser").Browser,p=c("./utils").shallowCopy,r=c("./sha1").hex_sha1,h=c("./das").copyStylesheet;l.prototype.exportFullConfig=function(h){h={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+r(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(h.prefix=this.prefix);return h};l.prototype.exportChains=function(){var h={},c=this.chains||{},l;for(l in c)h[l]=c[l].exportConfig();return h};l.prototype.exportSourceConfig=
function(c){c=[];for(var l=0;l<this.tiers.length;++l){var r=this.tiers[l],b=p(r.dasSource);b.noPersist||(b.coords=void 0,b.props=void 0,b.disabled||(b.disabled=void 0),r.config.stylesheet?(b.style=h(r.config.stylesheet).styles,b.stylesheet_uri=void 0):b.style&&(b.style=h({styles:b.style}).styles),"string"===typeof r.config.name&&(b.name=r.config.name),void 0!==r.config.height&&(b.forceHeight=r.config.height),void 0!==r.config.forceMin&&(b.forceMin=r.config.forceMin),r.config.forceMinDynamic&&(b.forceMinDynamic=
r.config.forceMinDynamic),void 0!==r.config.forceMax&&(b.forceMax=r.config.forceMax),void 0!==r.config.bumped&&(b.bumped=r.config.bumped),r.config.forceMaxDynamic&&(b.forceMaxDynamic=r.config.forceMaxDynamic),c.push(b))}return c};l.prototype.exportPageTemplate=function(h){h=h||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(h),
null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":50}],15:[function(c,u,s){if("undefined"!==typeof c)var l=c("./cbrowser").Browser,p=c("./glyphs").OverlayLabelCanvas,r=c("./numformats").formatQuantLabel,h=c("./sequence-draw").drawSeqTierGC;l.prototype.exportImage=function(c){c=c||{};for(var l=this.featurePanelWidth,y=0,b=0;b<this.tiers.length;++b){0<b&&(y+=3);var a=this.tiers[b];
void 0!==a.layoutHeight&&(y+=a.layoutHeight)}var n=c.resolutionMultiplier||1,b=(l+200)*n|0,a=y*n|0,y=makeElement("canvas",null,{width:b,height:a}),d=y.getContext("2d");d.fillStyle="white";d.fillRect(0,0,b,a);d.scale(n,n);for(b=n=0;b<this.tiers.length;++b){var a=this.tiers[b],k=(a.glyphCacheOrigin-this.viewStart)*this.scale,g=new p;d.save();d.translate(0,n);d.save();d.beginPath();d.moveTo(200,0);d.lineTo(200+l,0);d.lineTo(200+l,a.layoutHeight);d.lineTo(200,a.layoutHeight);d.closePath();d.clip();d.translate(200,
0);d.save();d.translate(k,0);a.subtiers?a.paintToContext(d,g,k+1E3):h(a,a.currentSequence,d);d.restore();d.save();d.translate(k,0);g.draw(d,-k,l-k);d.restore();d.restore();for(var g=!1,e=0,t=a.subtiers||[],C=0;C<t.length;++C){var R=t[C];if(R.quant){var g=!0,L=R.quant,E=R.height,N=2;40<E&&(N=1+(E/20|0));var E=E/(N-1),P=(L.max-L.min)/(N-1);d.beginPath();d.moveTo(205,e);d.lineTo(200,e);d.lineTo(200,e+R.height);d.lineTo(205,e+R.height);for(var x=1;x<N-1;++x){var H=x*E;d.moveTo(200,e+H);d.lineTo(203,e+
H)}d.strokeStyle="black";d.strokeWidth=2;d.stroke();d.fillStyle="black";var x=r(L.max),D=e+7;d.fillText(x,197-d.measureText(x).width,D);x=r(L.min);D=e+R.height;d.fillText(x,197-d.measureText(x).width,D);for(x=1;x<N-1;++x)H=x*E,D=r(1*L.max-x*P),H=e+H+3,d.fillText(D,197-d.measureText(D).width,H)}e+=R.height+3}e="string"===typeof a.config.name?a.config.name:a.dasSource.name;t=d.measureText(e).width;d.fillStyle="black";d.fillText(e,200-(g?22:12)-t,(a.layoutHeight+6)/2);d.restore();n+=a.layoutHeight+3}if(c.highlights){d.save();
d.beginPath();d.moveTo(200,0);d.lineTo(200+l,0);d.lineTo(200+l,n);d.lineTo(200,n);d.closePath();d.clip();d.translate(200+k,0);k=l=this.viewStart;b=this.viewEnd;for(a=0;a<this.highlights.length;++a)E=this.highlights[a],(E.chr===this.chr||E.chr==="chr"+this.chr)&&E.min<b&&E.max>k&&(d.globalAlpha=this.defaultHighlightAlpha,d.fillStyle=this.defaultHighlightFill,d.fillRect((E.min-l)*this.scale,0,(E.max-E.min)*this.scale,n));d.restore()}l=-1;"center"==c.ruler?l=200+(this.viewEnd-this.viewStart+1)*this.scale/
2:"left"==c.ruler?l=200:"right"==c.ruler&&(l=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=l&&(d.strokeStyle="blue",d.beginPath(),d.moveTo(l,0),d.lineTo(l,n),d.stroke());return y.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(c,u,s){if("undefined"!==typeof c){var l=c("./cbrowser").Browser;c=c("./utils");var p=c.makeElement,r=c.removeChildren}l.prototype.openExportPanel=function(){var h=this;if("export"===this.uiMode)this.hideToolPanel(),
this.setUiMode("none");else{var c=p("div",null,{className:"export-form"}),l=p("select");l.appendChild(p("option","SVG",{value:"svg"}));l.appendChild(p("option","Image",{value:"png"}));l.appendChild(p("option","Dalliance config",{value:"config"}));l.appendChild(p("option","Dalliance sources",{value:"sources"}));l.appendChild(p("option","Dalliance page",{value:"page"}));l.value="svg";l.addEventListener("change",function(a){r(d);C()},!1);c.appendChild(p("p",["Export as: ",l]));var y=p("input",null,{type:"checkbox",
checked:this.exportHighlights});y.addEventListener("change",function(a){h.exportHighlights=y.checked;h.storeStatus()},!1);var b=p("input",null,{type:"checkbox",checked:this.exportRuler});b.addEventListener("change",function(a){h.exportRuler=b.checked;h.storeStatus()},!1);var a=p("input",null,{type:"text",value:"1.0"}),n=p("button","Export",{className:"btn btn-primary"});n.addEventListener("click",function(e){r(d);var g,k,n,c;if("svg"===l.value)g=URL.createObjectURL(h.makeSVG({highlights:y.checked,
ruler:b.checked?h.rulerLocation:"none"})),k="SVG",n="image/svg",c="dalliance-view.svg";else if("png"===l.value){n=parseFloat(a.value);if(0.1>n||10<n){alert("bad scale "+n);return}g=h.exportImage({highlights:y.checked,ruler:b.checked?h.rulerLocation:"none",resolutionMultiplier:n});k="Image";n="image/png";c="dalliance-view.png"}else"config"===l.value?(n=JSON.stringify(h.exportFullConfig(),null,2),k=new Blob([n],{type:"text/plain"}),g=URL.createObjectURL(k),k="Configuration",n="text/plain",c="dalliance-config.json"):
"sources"===l.value?(n=JSON.stringify(h.exportSourceConfig(),null,2),k=new Blob([n],{type:"text/plain"}),g=URL.createObjectURL(k),k="Source array",n="text/plain",c="dalliance-sources.json"):"page"===l.value&&(k=h.exportPageTemplate(),n="text/html",k=new Blob([k],{type:n}),g=URL.createObjectURL(k),k="Page template",c="dalliance-view.html");g&&(e=p("a","[Download]",{href:g,download:c,type:n}),n=p("a","[Preview in browser]",{href:g,type:n,target:"_new"}),d.appendChild(p("p",[""+k+" created: ",e,n])))},
!1);h.addViewListener(function(){r(d)});h.addTierListener(function(){r(d)});var d=p("p",""),k=p("tr",[p("th","Include highlights",{},{width:"200px",textAlign:"right"}),p("td",y)]),g=p("tr",[p("th","Include vertical guideline"),p("td",b)]),e=p("tr",[p("th","Scale multiplier"),p("td",a)]),t=p("table",[k,g,e]),C=function(){var a=l.value;k.style.display="svg"==a||"png"==a?"table-row":"none";g.style.display="svg"==a||"png"==a?"table-row":"none";e.style.display="png"==a?"table-row":"none"};C();c.appendChild(t);
c.appendChild(n);c.appendChild(d);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(c,this.svgHolder);this.activeToolPanel=c;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":50}],17:[function(c,u,s){u=c("./cbrowser");s=c("./chainset");var l=c("./sourceadapters"),p=c("./utils");c=c("./das");window.Browser=u.Browser;window.sourcesAreEqual=u.sourcesAreEqual;window.Chainset=s.Chainset;window.makeElement=p.makeElement;window.dalliance_registerSourceAdapterFactory=l.registerSourceAdapterFactory;
window.dalliance_registerParserFactory=l.registerParserFactory;window.dalliance_makeParser=l.makeParser;window.DASSequence=c.DASSequence;window.DASFeature=c.DASFeature;window.DASGroup=c.DASGroup;window.DASStylesheet=c.DASStylesheet;window.DASStyle=c.DASStyle;window.DASSource=c.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./utils":50}],18:[function(c,u,s){function l(){this.glyphs=[];this.height=0;this.quant=null}function p(f){Date.now();X=f.viewport.getContext("2d");
a(f);f.padding="number"===typeof f.dasSource.padding?f.dasSource.padding:ca;var e=[],m={},d={},g;for(g in f.ungroupedFeatures)for(var k=f.ungroupedFeatures[g],n=0;n<k.length;++n){var c=k[n];if(!c.parts){var t=f.styleForFeature(c);if(t)if("LINEPLOT"==t.glyph)b(m,t.id,c),d[t.id]=t;else{var z=h(c,0,t,f);z&&e.push(z)}}}for(var q in m)g=m[q],t=d[q],"LINEPLOT"==t.glyph&&e.push(v(g,t,f));if(f.dasSource.collapseSuperGroups&&!f.bumped)for(var F in f.superGroups){m=f.superGroups[F];f.groups[F]=y(f.groups[F]);
f.groups[F].isSuperGroup=!0;d={};q=1E10;k=-1E10;n=null;for(z=0;z<m.length;++z)if(g=f.groupedFeatures[m[z]]){for(t=0;t<g.length;++t)c=g[t],b(d,c.type,c),q=Math.min(c.min,q),k=Math.max(c.max,k),c.segment&&!n&&(n=c.segment);if(f.groups[F]&&!f.groups[F].links||0==f.groups[F].links.length)f.groups[F].links=f.groups[m[0]].links;delete f.groupedFeatures[m[z]]}f.groups[F].max=k;f.groups[F].min=q;f.groups[F].segment=n;for(var w in d){g=d[w];q=g[0];k=null;for(t=0;t<g.length;++t)c=g[t],c=new S(c.min,c.max),
k=k?G(k,c):c;k=k.ranges();for(n=0;n<k.length;++n){for(var B=k[n],p=((B.max()|0)-(B.min()|0)+1)*m.length,x=0,t=0;t<g.length;++t)if(c=g[t],(c.min|0)<=B.max()&&(c.max|0)>=B.min())var C=Math.max(c.min|0,B.min()),c=Math.min(c.max|0,B.max()),x=x+(c-C+1);var c=new Q,A;for(A in q)c[A]=q[A];c.min=B.min();c.max=B.max();c.label&&1<m.length&&(c.label+=" ("+m.length+" vars)");c.visualWeight=1*x/p;b(f.groupedFeatures,F,c)}}delete f.superGroups[F]}A=[];for(var E in f.groupedFeatures)A.push(E);A.sort(function(a,
b){var e=f.groupedFeatures[a][0].score-f.groupedFeatures[b][0].score;return 0<e?-1:0==e?0:1});w={};for(c=0;c<A.length;++c)if(E=A[c],z=r(f.groupedFeatures[E],0,f.groups[E],f,f.dasSource.collapseSuperGroups&&!f.bumped?"collapsed_gene":"tent"))z.group=f.groups[E],w[E]=z;for(F in f.superGroups){m=f.superGroups[F];E=[];q=1E10;k=-1E10;for(A=0;A<m.length;++A)c=w[m[A]],w[m[A]]=null,c&&(E.push(c),q=Math.min(q,c.min()),k=Math.max(k,c.max()));for(A=0;A<E.length;++A)c=E[A],e.push(new L(c,q,k))}for(z in w)(c=
w[z])&&e.push(c);F=new l;E=[];w=f.subtierMax||f.dasSource.subtierMax||f.browser.defaultSubtierMax;A=!1;c=0;a:for(;c<e.length;++c)if(z=e[c],z.bump&&(f.bumped||f.dasSource.collapseSuperGroups)){for(m=0;m<E.length;++m)if(d=E[m],d.hasSpaceFor(z)){d.add(z);continue a}E.length>=w?A=!0:(d=new l,d.add(z),E.push(d))}else F.add(z);0<F.glyphs.length&&(E=[F].concat(E));for(m=0;m<E.length;++m)d=E[m],d.quant&&d.glyphs.unshift(new J(d.height));for(m=0;m<E.length;++m)d=E[m],d.glyphs.sort(function(a,b){return(a.zindex||
0)-(b.zindex||0)});f.subtiers=E;f.glyphCacheOrigin=f.browser.viewStart;A?f.updateStatus("Bumping limit exceeded, use the track editor to see more features"):f.updateStatus()}function r(a,b,f,e,m){m=e.styleForFeature(f);var k,n=!1,c=[];b=null;for(var t=0;t<a.length;++t){var l=a[t];l.orientation&&null==b&&(b=l.orientation);!k&&l.label&&(k=l.label);var z=e.styleForFeature(l);z&&!l.parts&&(V(z.LABEL)&&(n=!0),(l=h(l,0,z,e,null,!0))&&c.push(l))}if(0==c.length)return null;a="flat";m&&"LINE"===m.glyph||(e.dasSource.collapseSuperGroups&&
!e.bumped?"+"===b?a="collapsed+":"-"===b&&(a="collapsed-"):"+"===b?a="hat+":"-"===b&&(a="hat-"));e=null;if(k&&n||m&&(V(m.LABEL)||V(m.LABELS)))e=f.label||k;f=new d(c,a);e&&("+"===b?e=">"+e:"-"===b&&(e="<"+e),f=new g(X,f,e,!1));f.bump=!0;return f}function h(a,b,m,k,c,h){function l(a,b,f){var m=null;if(a.currentSequence){var e=a.currentSequence.start|0,d=a.currentSequence.end|0;if(e<=f&&d>=b){for(var g=Math.max(b,e),d=Math.min(f,d),m=a.currentSequence.seq.substr(g-e,d-g+1);b<g;)m="N"+m,g--;for(;f>d;)m+=
"N",d++}}return m}var q=k.browser.scale,r=k.browser.viewStart,p=m.glyph||"BOX",y=a.min,G=a.max,J=a.orientation,v=a.score,M=a.label||a.id,s=(y-r)*q,S=Math.max((G-r+1)*q,s+1),Q=k.forceHeight||m.HEIGHT||c||12,u=Q*=1,r=m.BUMP&&V(m.BUMP),T;if("CROSS"===p||"EX"===p||"TRIANGLE"===p||"DOT"===p||"SQUARE"===p||"STAR"===p||"PLIMSOLL"===p){var W=m.FGCOLOR||"black",O=m.BGCOLOR||"none",y=m.STROKECOLOR;m.BGITEM&&a.itemRgb?W=a.itemRgb:V(m.COLOR_BY_SCORE2)&&(q=m.BGGRAD||m._gradient,q||(q=F(50,m.COLOR1,m.COLOR2,m.COLOR3),
m._gradient=q),Q=a.score2,void 0==Q&&W||(u=m.MIN2?1*m.MIN2:0,G=(1*(Q||0)-u)/((m.MAX2?1*m.MAX2:1)-u)*q.length|0,0>G&&(G=0),G>=q.length&&(G=q.length-1),W=q[G]));Q=k.forceHeight||m.HEIGHT||c||12;u=Q*=1;G=m.SIZE||Q;m.RSIZE&&(G=1*m.RSIZE*Q);m.STROKETHRESHOLD&&G<1*m.STROKETHRESHOLD&&(y=null);G*=1;Q=(s+S)/2;q=G/2;"EX"===p?y=new t(Q,G,W):"TRIANGLE"===p?y=new C(Q,G,m.DIRECTION||"N",m.LINEWIDTH||G,W,y):"DOT"===p?y=new R(Q,G,W,y):"PLIMSOLL"===p?y=new I(Q,G,0.2*G,W,y):"SQUARE"===p?y=new n(Q-q,0,G,G,W,y):"STAR"===
p?(p=5,m.POINTS&&(p=m.POINTS|0),y=new A(Q,q,p,W,y)):y=new e(Q,G,W);O&&"none"!=O&&5<S-s&&(s=new n(s,0,S-s,G,O),y=new d([s,y]));if(V(m.SCATTER)){O=k.quantMin(m);(G=k.quantMax(m))||(G=0>O?0:10);O||(O=0);k=(1*v-O)/(G-O);v=-1*O/(G-O);if(0>k||1<k)return null;k>=v?(Q=Math.max(1,(k-v)*u),b=b+(1-v)*u-Q):(Q=Math.max(1,(k-v)*u),b+=(1-v)*u);T={min:O,max:G};s=0;S="undefined"!==typeof a.forceLabel?a.forceLabel:m.LABEL;Z(S)&&M&&!h&&(y=new g(X,y,M,!0,null,"above"==S?"above":"below"),"above"==S&&(s=y.textHeight+2),
h=!0);y=new K(y,0,b-q-s,u)}}else if("HISTOGRAM"===p||"GRADIENT"===p&&"undefined"!==v)O=k.quantMin(m),(G=k.quantMax(m))||(G=0>O?0:10),O||(O=0),1*v<1*O&&(v=O),1*v>1*G&&(v=G),k=(1*v-O)/(G-O),v=-1*O/(G-O),"HISTOGRAM"===p&&(k>=v?(Q=(k-Math.max(0,v))*u,b=b+(1-Math.max(0,v))*u-Q):(Q=(Math.max(0,v)-k)*u,b+=(1-Math.max(0,v))*u),T={min:O,max:G}),W=m.FGCOLOR||null,O=m.BGCOLOR||m.COLOR1||"green",m.BGITEM&&a.itemRgb&&(O=a.itemRgb),v=m.ALPHA?1*m.ALPHA:null,m.BGGRAD&&(q=m.BGGRAD,G=k*q.length|0,0>G&&(G=0),G>=q.length&&
(G=q.length-1),O=q[G]),m.COLOR2&&(q=m._gradient,q||(q=F(50,m.COLOR1,m.COLOR2,m.COLOR3),m._gradient=q),G=k*q.length|0,0>G&&(G=0),G>=q.length&&(G=q.length-1),O=q[G]),y=new n(s,b,S-s,Q,O,W,v),y=new K(y,0,0,u);else if("HIDDEN"===p)y=new L(null,s,S),h=!0;else if("ARROW"===p)k=m.FGCOLOR||"purple",b=V(m.PARALLEL),u=V(m.SOUTHWEST),v=V(m.NORTHEAST),y=new H(s,S,Q,k,b,u,v);else if("ANCHORED_ARROW"===p)W=m.FGCOLOR||"none",O=m.BGCOLOR||"green",y=new E(s,S,Q,O,W,J),y.bump=!0;else if("SPAN"===p)W=m.FGCOLOR||"black",
y=new N(s,S,Q,W);else if("LINE"===p)W=m.FGCOLOR||"black",y=new P(s,S,Q,m.STYLE||"solid",J,W);else if("PRIMERS"===p)W=m.FGCOLOR||"black",O=m.BGCOLOR||"red",y=new x(s,S,Q,O,W);else if("TEXT"===p)k=m.STRING||"text",O=m.FGCOLOR||"black",y=new f(X,s,S,Q,O,k);else if("TOOMANY"===p)W=m.FGCOLOR||"gray",O=m.BGCOLOR||"orange",y=new D(s,S,Q,O,W);else if("POINT"===p)Q=k.forceHeight||m.HEIGHT||30,O=k.quantMin(m),G=k.quantMax(m),k=(1*v-O)/(G-O),b=1*Q/(G-O)*(v-1*O)|0,T={min:O,max:G},O=m.FGCOLOR||m.COLOR1||"black",
m.COLOR2&&(q=m._gradient,q||(q=F(50,m.COLOR1,m.COLOR2,m.COLOR3),m._gradient=q),G=k*q.length|0,0>G&&(G=0),G>=q.length&&(G=q.length-1),O=q[G]),y=new w((s+S)/2,Q-b,Q,O);else if("__SEQUENCE"===p){v=p=a.seq;O=W=a.quals;b=V(m.__INSERTIONS);u=[];if(a.cigar){c=ja(a.cigar);for(var O=v="",ca=J=0;ca<c.length;++ca){var aa=c[ca];if("M"==aa.op)v+=p.substr(J,aa.cnt),O+=W.substr(J,aa.cnt),J+=aa.cnt;else if("D"==aa.op)for(var ia=0;ia<aa.cnt;++ia)v+="-",O+="Z";else if("I"==aa.op){var ba=p.substr(J,aa.cnt),ia=new C(s+
v.length*q,5,"S",5,k.browser.baseColors.I);b&&(ia=new g(X,ia,ba,!1,"center","above","7px sans-serif"));ia.feature={label:"Insertion: "+ba,type:"insertion",method:"insertion"};u.push(ia);J+=aa.cnt}else"S"==aa.op?J+=aa.cnt:console.log("unknown cigop"+aa.op)}}q=l(k,y,G);if(v&&q&&("mismatch"===m.__SEQCOLOR||"mismatch-all"===m.__SEQCOLOR)){y=[];G="-"===a.orientation?",":".";for(p=0;p<v.length;++p)y.push(v[p]==q[p]?G:v[p]);v=y.join("")}y="-"===a.orientation?m._minusColor||"lightskyblue":m._plusColor||"lightsalmon";
m.__disableQuals&&(O=!1);y=new z(k.browser.baseColors,y,s,S,Q,v,q,m.__SEQCOLOR,O,!V(m.__CLEARBG));b&&(y=new K(y,0,7));0<u.length&&(u.splice(0,0,y),y=new d(u))}else if("__INSERTION"===p)ia=new C(s,5,"S",5,k.browser.baseColors.I),y=new g(X,ia,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<S-s&&(O=m.BGCOLOR||m.COLOR1||"green",s=new n(s,5,S-s,Q,O,W),y=new d([s,y]));else{if("__NONE"===p)return null;W=m.FGCOLOR||null;O=m.BGCOLOR||m.COLOR1||"green";m.BGITEM&&a.itemRgb&&(O=a.itemRgb);
q=(S-s)/(G-y);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!k.dasSource.collapseSuperGroups||k.bumped)&&0.5<=q?(q=l(k,y,G),y=new B(s,S,Q,O,q,a.orientation,a.readframe)):y=new n(s,0,S-s,Q,O,W)}(V(m.LABEL)||a.forceLabel)&&M&&!h&&(y=new g(X,y,M,!1));r&&(y.bump=!0);y.feature=a;T&&(y.quant=T);m.ZINDEX&&(y.zindex=m.ZINDEX|0);return y}function v(a,b,f){var m=f.browser.viewStart,e=f.browser.scale,d=f.forceHeight||
b.HEIGHT||30,g=f.quantMin(b);f=f.quantMax(b);for(var n=1*d/(f-g),c=b.FGCOLOR||b.COLOR1||"black",h=[],t=0;t<a.length;++t){var l=a[t],z=d-((l.score-1*g)*n|0);h.push((((l.min|0)+(l.max|0))/2-m)*e);h.push(z)}a=new k(h,c,d);a.quant={min:g,max:f};b.ZINDEX&&(a.zindex=b.ZINDEX|0);return a}if("undefined"!==typeof c){var q=c("./utils"),y=q.shallowCopy,b=q.pusho,q=c("./tier").DasTier,a=c("./features").sortFeatures;s=c("./glyphs");var n=s.BoxGlyph,d=s.GroupGlyph,k=s.LineGraphGlyph,g=s.LabelledGlyph,e=s.CrossGlyph,
t=s.ExGlyph,C=s.TriangleGlyph,R=s.DotGlyph,L=s.PaddedGlyph,E=s.AArrowGlyph,N=s.SpanGlyph,P=s.LineGlyph,x=s.PrimersGlyph,H=s.ArrowGlyph,D=s.TooManyGlyph,f=s.TextGlyph,z=s.SequenceGlyph,B=s.AminoAcidGlyph,K=s.TranslatedGlyph,w=s.PointGlyph,J=s.GridGlyph,A=s.StarGlyph,I=s.PlimsollGlyph,m=s.OverlayLabelCanvas,F=c("./color").makeGradient;s=c("./spans");var S=s.Range,G=s.union;s=c("./das");var Q=s.DASFeature,V=s.isDasBooleanTrue,Z=s.isDasBooleanNotFalse,ja=c("./cigar").parseCigar,T=c("./numformats").formatQuantLabel}var ca=
3;l.prototype.indexFor=function(a){a=a.min();for(var b=0,f=this.glyphs.length;f>b;){var m=(b+f)/2|0;if(m>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[m].min()?f=m:b=m+1}return f};l.prototype.add=function(a){var b=this.indexFor(a);this.glyphs.splice(b,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};l.prototype.hasSpaceFor=function(a){var b=this.indexFor(a);return 0<b&&this.glyphs[b-1].max()>=a.min()||b<this.glyphs.length&&this.glyphs[b].min()<=
a.max()?!1:!0};var X;q.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,b=this.subtiers;if(b){var f=this.browser.featurePanelWidth+2E3;a&&(f*=2);var e=this.viewport.width|0;e<f-50&&(this.viewport.width=e=f);for(var f=this.padding,d=0;d<b.length;++d)f=f+b[d].height+this.padding;d=f=Math.max(f+6,this.browser.minTierHeight);a&&(d*=2);d!=this.viewport.height&&(this.viewport.height=d);Math.max(f,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=
a?""+e/2+"px":""+e+"px";this.viewport.style.height=""+f+"px";this.layoutHeight=Math.max(f,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;b=this.viewport.getContext("2d");b.clearRect(0,0,e,d);b.save();a&&b.scale(2,2);e=this.browser.viewStart-1E3/this.browser.scale;d=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var g=this.knownCoverage.ranges(),k=0;k<g.length;++k){var n=g[k];0==k?n.min()>e&&a.push({min:e,max:n.min()-1}):a.push({min:g[k-
1].max()+1,max:n.min()-1});k==g.length-1&&n.max()<d&&a.push({min:n.max()+1,max:d})}if(0<a.length)for(b.fillStyle="gray",e=0;e<a.length;++e)d=a[e],g=(d.min-this.browser.viewStart)*this.browser.scale+1E3,b.fillRect(g,0,(d.max-this.browser.viewStart)*this.browser.scale+1E3-g,f);f=new m;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;b.translate(a,this.padding);f.translate(0,this.padding);this.paintToContext(b,f,a);this.overlayLabelCanvas=0<f.glyphs.length?f:null;b.restore();this.drawOverlay();
this.paintQuant()}};q.prototype.paintToContext=function(a,b,f){var m=this.subtiers,e=this.viewport.width|0;a.save();for(var d=0;d<m.length;++d){for(var g=null,k=m[d].glyphs,n=0;n<k.length;++n){var c=k[n];c.min()<e-f&&c.max()>-f&&(c=k[n],c.draw(a,b),c.quant&&(g=c.quant))}a.translate(0,m[d].height+this.padding);b.translate(0,m[d].height+this.padding)}a.restore();g&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(b=m[0].height*(1-(this.quantLeapThreshold-
g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,b),a.lineTo(e+1E3,b),a.stroke(),a.restore())};q.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,b;this.subtiers&&0<this.subtiers.length&&(b=this.subtiers[0].quant);if(b){var f=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+
"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var m=this.quantOverlay.getContext("2d");a&&m.scale(2,2);a=2;40<f&&(a=1+(f/20|0));var e=(f+2*this.padding)/(a-1),d=(b.max-b.min)/(a-1);m.fillStyle="white";m.globalAlpha=0.6;"right"==this.browser.rulerLocation?m.fillRect(20,0,30,f+2*this.padding):m.fillRect(0,0,30,f+2*this.padding);m.globalAlpha=1;m.strokeStyle="black";m.lineWidth=1;m.beginPath();if("right"==this.browser.rulerLocation){m.moveTo(42,this.padding);m.lineTo(50,
this.padding);m.lineTo(50,f+this.padding);m.lineTo(42,f+this.padding);for(var g=1;g<a-1;++g){var k=g*e;m.moveTo(50,k);m.lineTo(45,k)}}else for(m.moveTo(8,this.padding),m.lineTo(0,this.padding),m.lineTo(0,f+this.padding),m.lineTo(8,f+this.padding),g=1;g<a-1;++g)k=g*e,m.moveTo(0,k),m.lineTo(5,k);m.stroke();m.fillStyle="black";if("right"==this.browser.rulerLocation)for(m.textAlign="right",m.fillText(T(b.max),41,8),m.fillText(T(b.min),41,f+this.padding),g=1;g<a-1;++g)k=g*e,m.fillText(T(1*b.max-g*d),41,
k+3);else for(m.textAlign="left",m.fillText(T(b.max),9,8),m.fillText(T(b.min),9,f+this.padding),g=1;g<a-1;++g)k=g*e,m.fillText(T(1*b.max-g*d),9,k+3)}else this.quantOverlay.style.display="none"}};q.prototype.styleForFeature=function(a){var b=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var f=null,m=this.stylesheet.styles,e=0;e<m.length;++e){var d=m[e];if(!(d.zoom&&d.zoom!=b||d.orientation&&d.orientation!=a.orientation)){var g=d._labelRE;g&&g.test||(g=new RegExp("^"+d.label+
"$"),d._labelRE=g);if(!d.label||g.test(a.label))if(g=d._methodRE,g&&g.test||(g=new RegExp("^"+d.method+"$"),d._methodRE=g),!d.method||g.test(a.method)){if(d.type)if("default"==d.type){f||(f=d.style);continue}else if(g=d._typeRE,g&&g.test||(g=new RegExp("^"+d.type+"$"),d._typeRE=g),!g.test(a.type))continue;return d.style}}}return f};q.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||
0};q.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof u&&(u.exports={drawFeatureTier:p})},{"./cigar":8,"./color":9,"./das":10,"./features":20,"./glyphs":21,"./numformats":26,"./spans":35,"./tier":44,"./utils":50}],19:[function(c,u,s){function l(b,a,n){var d=h(n.type,a.type),k=h(n.label,a.label,n.id,a.id);k&&0!=k.indexOf("__dazzle")&&(d=d+": "+k);this.hit=
b;this.feature=a;this.group=n;this.title=d;this.sections=[]}function p(b,a){var n=[];if(b)for(var d=0;d<b.length;++d)v(n,b[d]);if(a)for(d=0;d<a.length;++d)v(n,a[d]);return n}if("undefined"!==typeof c){var r=c("./cbrowser").Browser;c=c("./utils");var h=c.pick,v=c.pushnew,q=c.makeElement}var y=/^([A-Za-z_-]+)=(.+)/;r.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};l.prototype.setTitle=function(b){this.title=b};l.prototype.add=
function(b,a){"string"===typeof a&&(a=q("span",a));this.sections.push({label:b,info:a})};r.prototype.featurePopup=function(b,a,n,d){var k=n.length;a=0<=--k?n[k]:{};var g=0<=--k?n[k]:{};n=new l(n,a,g);n.tier=d;for(var k=this.featureInfoPlugins||[],e=0;e<k.length;++e)try{k[e](a,n)}catch(c){console.log(c.stack||c)}k=d.featureInfoPlugins||[];for(e=0;e<k.length;++e)try{k[e](a,n)}catch(h){console.log(h.stack||h)}this.removeAllPopups();d=q("table",null,{className:"table table-striped table-condensed"});
d.style.width="100%";d.style.margin="0px";k=0;a.method&&(e=q("tr",[q("th","Method"),q("td",a.method)]),d.appendChild(e),++k);e=g.segment?g:a;e=q("tr",[q("th","Location"),q("td",e.segment+":"+e.min+"-"+e.max,{},{minWidth:"200px"})]);d.appendChild(e);++k;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||(e=q("tr",[q("th","Score"),q("td",""+a.score)]),d.appendChild(e),++k);(e=p(g.links,a.links))&&0<e.length&&(e=q("tr",[q("th","Links"),q("td",e.map(function(a){return q("div",q("a",a.desc,
{href:a.uri,target:"_new"}))}))]),d.appendChild(e),++k);a=p(g.notes,a.notes);for(g=0;g<a.length;++g){var e="Note",r=a[g],L=r.match(y);L&&(e=L[1],r=L[2]);e=q("tr",[q("th",e),q("td",r)]);d.appendChild(e);++k}for(a=0;a<n.sections.length;++a)k=n.sections[a],d.appendChild(q("tr",[q("th",k.label),q("td",k.info)]));this.popit(b,n.title||"Feature",d,{width:450})}},{"./cbrowser":6,"./utils":50}],20:[function(c,u,s){function l(c){for(var l=c.browser.drawnStart,q=c.browser.drawnEnd,y={},b={},a={},n={},d={},
k={},g={},e={},t=[],C,s,L,E=function(){L={};for(var a=0;a<c.currentFeatures.length;++a){var b=c.currentFeatures[a];b.id&&(L[b.id]=b)}},N=function(a){var b=[];if(a.parents)for(var f=0;f<a.parents.length;++f){var e=a.parents[f],d=L[e];d&&"SO:0000704"==d.typeCv&&pushnew(b,e)}return b},P=0;P<c.currentFeatures.length;++P){var x=c.currentFeatures[P];if(!x.parts){var H=x.min<=q&&x.max>=l;if(x.min&&x.max){if(x.score&&"."!=x.score&&"-"!=x.score){var D=1*x.score;if(!C||D<C)C=D;if(!s||D>s)s=D}var D=[],f=null;
if(x.groups)for(var z=0;z<x.groups.length;++z){var B=x.groups[z],K=B.id;if("gene"==B.type)f=K,k[K]=B;else if("translation"!=B.type){p(b,K,x);k[K]=B;D.push(K);B=n[K];if(!B||x.min<B)n[K]=x.min;B=d[K];if(!B||x.max>B)d[K]=x.max}}if(x.parents)for(L||E(),z=0;z<x.parents.length;++z){var w=x.parents[z],J=L[w];if(J){J.parts||(J.parts=[x]);r(b,w,J);p(b,w,x);k[w]||(k[w]={type:J.type,id:J.id,label:J.label||J.id});D.push(w);B=n[w];if(!B||x.min<B)n[w]=x.min;B=d[w];if(!B||x.max>B)d[w]=x.max;B=N(J);0<B.length&&(f=
B[0],w=L[B[0]],k[B[0]]={type:w.type,id:w.id,label:w.label||w.id},c.dasSource.collapseSuperGroups||(c.dasSource.collapseSuperGroups=!0))}}if(0==D.length)H&&p(y,x.type,x);else if(f)for(B=0;B<D.length;++B)K=D[B],r(g,f,K),e[K]=f}else t.push(x)}}for(K in b)t=k[K],"number"!==typeof t.min&&(t.min=n[K]),"number"!==typeof t.max&&(t.max=d[K]),d[K]>=l&&n[K]<=q&&(a[K]=b[K]);c.ungroupedFeatures=y;c.groupedFeatures=a;c.groups=k;c.superGroups=g;c.groupsToSupers=e;C&&(0<C?C=0:0>s&&(s=0),c.currentFeaturesMinScore=
C,c.currentFeaturesMaxScore=s)}if("undefined"!==typeof c){c=c("./utils");var p=c.pusho,r=c.pushnewo}"undefined"!==typeof u&&(u.exports={sortFeatures:l})},{"./utils":50}],21:[function(c,u,s){function l(a,b){this._stroke=a;this._fill=b}function p(a,b,f,e,d,g,k,c){this.x=a;this.y=b;this._width=f;this._height=e;this.fill=d;this.stroke=g;this._alpha=k;this._radius=c||0}function r(a,b){this.glyphs=a;this.connector=b;this.h=a[0].height();for(var f=[],e=0;e<a.length;++e){var d=a[e];f.push(new K(d.min(),d.max()));
this.h=Math.max(this.h,d.height())}this.coverage=B(f)}function h(a,b,f){this.points=a;this.color=b;this._height=f||50}function v(a,b,f,e,d,g,k){this.glyph=b;this.text=f;this.anchor=d||"left";this.align=g||"below";k&&(this.font=k);this.font&&(a.save(),a.font=this.font);f=a.measureText(f);this.font&&a.restore();this.textLen=f.width;this.textHeight=5;this.bump=b.bump;this.measured=!e}function q(a,b,f){this._x=a;this._height=b;this._stroke=f}function y(a,b,f){this._x=a;this._height=b;this._stroke=f}function b(a,
b,f,e,d,g){l.call(this,g,d);this._x=a;this._height=b;this._dir=f;this._width=e}function a(a,b,f,e){this._x=a;this._height=b;this._fill=f;this._stroke=e}function n(a,b,f){this.glyph=a;this._min=b;this._max=f;a&&(this.bump=a.bump)}function d(a,b,f,e,d,g){l.call(this,d,e);this._min=a;this._max=b;this._height=f;this._ori=g}function k(a,b,f,e){l.call(this,e,null);this._min=a;this._max=b;this._height=f}function g(a,b,f,e,d,g){this._min=a;this._max=b;this._height=f;this._style=e;this._strand=d;this._stroke=
g}function e(a,b,f,e,d){this._min=a;this._max=b;this._height=f;this._fill=e;this._stroke=d}function t(a,b,f,e,d,g,k){l.call(this,null,e);this._min=a;this._max=b;this._height=f;this._color=e;this._parallel=d;this._sw=g;this._ne=k}function C(a,b,f,e,d){this._min=a;this._max=b;this._height=f;this._fill=e;this._stroke=d}function R(a,b,f,e,d,g){this._min=b;this._max=f;this._height=e;this._fill=d;this._string=g;this._textLen=a.measureText(g).width}function L(a,b,f){var e={red:"darkred",purple:"mediumpurple",
blue:"darkblue",green:"darkgreen"}[f.toLowerCase()];f=e?[f,e]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":f[b%2]}function E(a){var b={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var f=[],e=0;e<a.length;++e){var d=a.substr(e,1).toUpperCase();f.push(d in b?b[d]:"N")}return f.join("")}function N(a,b,f,e,d,g,k){this._min=a;this._max=b;this._height=f;this._fill=e;this._seq=d;this._orientation=g;this._readframe=k}function P(a,b,f,e){this.glyph=
a;this._height=e;this._x=b;this._y=f}function x(a,b,f,e){this._x=a;this._y=b;this._height=f;this._fill=e}function H(a){this._height=a||50}function D(a,b,f,e,d){l.call(this,d,e);this._x=a;this._r=b;this._points=f}function f(a,b,f,e,d){this._x=a;this._height=b;this._overhang=f;this._fill=e;this._stroke=d;this._hh=b/2}function z(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof c){s=c("./spans");var B=s.union,K=s.Range;s=c("./utils");var w=s.makeElementNS,J=s.AMINO_ACID_TRANSLATION;c=c("./svg-utils");
var A=c.NS_SVG,I=c.SVGPath}l.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};l.prototype.toSVG=function(){var a=new I;this.drawPath(a);return w(A,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};l.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};p.prototype.draw=function(a){var b=this._radius;0<b?(a.beginPath(),
a.moveTo(this.x+b,this.y),a.lineTo(this.x+this._width-b,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+b,b),a.lineTo(this.x+this._width,this.y+this._height-b),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-b,this.y+this._height,b),a.lineTo(this.x+b,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-b,b),a.lineTo(this.x,this.y+b),a.arcTo(this.x,this.y,this.x+b,this.y,b),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=
this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};p.prototype.toSVG=function(){var a=w(A,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,
stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};p.prototype.min=function(){return this.x};p.prototype.max=function(){return this.x+this._width};p.prototype.height=function(){return this.y+this._height};r.prototype.drawConnectors=function(a){for(var b=this.coverage.ranges(),f=1;f<b.length;++f){var e=b[f],d=b[f-1];if(d&&e.min()>d.max()){var d=d.max(),e=e.min(),g=(d+e)/2;"hat+"===this.connector?(a.moveTo(d,this.h/
2),a.lineTo(g,0),a.lineTo(e,this.h/2)):"hat-"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(g,this.h),a.lineTo(e,this.h/2)):"collapsed+"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(e,this.h/2),4<e-d&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(d,this.h/2),a.lineTo(e,this.h/2),4<e-d&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(d,this.h/2),a.lineTo(e,this.h/2))}}};r.prototype.draw=
function(a,b){for(var f=0;f<this.glyphs.length;++f)this.glyphs[f].draw(a,b);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};r.prototype.toSVG=function(){for(var a=w(A,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());b=new I;this.drawConnectors(b);0<b.toPathData().length&&(b=w(A,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(b));return a};r.prototype.min=function(){return this.coverage.min()};r.prototype.max=function(){return this.coverage.max()};
r.prototype.height=function(){return this.h};h.prototype.min=function(){return this.points[0]};h.prototype.max=function(){return this.points[this.points.length-2]};h.prototype.height=function(){return this._height};h.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var b=0;b<this.points.length;b+=2){var f=this.points[b],e=this.points[b+1];0==b?a.moveTo(f,e):a.lineTo(f,e)}a.stroke();a.restore()};h.prototype.toSVG=function(){for(var a=new I,b=0;b<this.points.length;b+=
2){var f=this.points[b],e=this.points[b+1];0==b?a.moveTo(f,e):a.lineTo(f,e)}return w(A,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};v.prototype.toSVG=function(){var a=this.glyph.toSVG(),b={};"above"==this.align?(a=w(A,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return w(A,"g",[a,w(A,
"text",this.text,b)])};v.prototype.min=function(){return this.glyph.min()};v.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};v.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};v.prototype.draw=function(a,b){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();b.registerGlyph(this)};
v.prototype.drawOverlay=function(a,b,f){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?f=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(f=this.glyph.min(),f<b&&(f=Math.min(b,this.glyph.max()-this.textLen)));a.fillText(this.text,f,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};q.prototype.draw=function(a){var b=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-b,b);a.lineTo(this._x+
b,b);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};q.prototype.toSVG=function(){var a=this._height/2,b=new I;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return w(A,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};q.prototype.min=function(){return this._x-this._height/2};q.prototype.max=function(){return this._x+this._height/2};q.prototype.height=function(){return this._height};y.prototype.draw=function(a){var b=
this._height/2;a.beginPath();a.moveTo(this._x-b,0);a.lineTo(this._x+b,this._height);a.moveTo(this._x-b,this._height);a.lineTo(this._x+b,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};y.prototype.toSVG=function(){var a=this._height/2,b=new I;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return w(A,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};y.prototype.min=function(){return this._x-this._height/
2};y.prototype.max=function(){return this._x+this._height/2};y.prototype.height=function(){return this._height};b.prototype=Object.create(l.prototype);b.prototype.drawPath=function(a){var b=this._height/2,f=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-f,0),a.lineTo(this._x+f,0)):"W"===this._dir?(a.moveTo(this._x+f,b),a.lineTo(this._x-f,0),a.lineTo(this._x-f,this._height)):"E"===this._dir?(a.moveTo(this._x-f,b),a.lineTo(this._x+f,0),a.lineTo(this._x+f,this._height)):
(a.moveTo(this._x,0),a.lineTo(this._x+f,this._height),a.lineTo(this._x-f,this._height));a.closePath()};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};a.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,b,b,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=
function(){var a=this._height/2;return w(A,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};n.prototype.draw=function(a,b){this.glyph&&this.glyph.draw(a,b)};n.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():w(A,"g")};n.prototype.min=function(){return this._min};
n.prototype.max=function(){return this._max};n.prototype.height=function(){return this.glyph?this.glyph.height():1};d.prototype=Object.create(l.prototype);d.prototype.min=function(){return this._min};d.prototype.max=function(){return this._max};d.prototype.height=function(){return this._height};d.prototype.drawPath=function(a){var b=this._max,f=this._min,e=this._height,d=0,g=0,k=this._height+2,c=0.333333*this._height;this._ori&&("+"===this._ori?g=0.5*this._height:"-"===this._ori&&(d=0.5*this._height));
b-f<k&&(f=(b+f-k)/2,b=f+k);a.moveTo(f+d,0+c);a.lineTo(b-g,0+c);a.lineTo(b-g,0);a.lineTo(b,0+this._height/2);a.lineTo(b-g,0+e);a.lineTo(b-g,0+c+c);a.lineTo(f+d,0+c+c);a.lineTo(f+d,0+e);a.lineTo(f,0+e/2);a.lineTo(f+d,0);a.lineTo(f+d,0+c)};k.prototype=Object.create(l.prototype);k.prototype.min=function(){return this._min};k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawPath=function(a){var b=this._min,f=this._max,e=this._height,d=e/2;a.moveTo(b,
d);a.lineTo(f,d);a.moveTo(b,0);a.lineTo(b,e);a.moveTo(f,0);a.lineTo(f,e)};g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.drawPath=function(a){var b=this._min,f=this._max,e=this._height,d=e/2;"hat"===this._style?(a.moveTo(b,d),a.lineTo((b+f)/2,"-"===this._strand?e:0)):a.moveTo(b,d);a.lineTo(f,d)};g.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===
this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};g.prototype.toSVG=function(){var a=new I;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return w(A,"path",null,a)};e.prototype.min=function(){return this._min};e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};e.prototype.drawStemPath=function(a){var b=this._max,f=this._height/2;a.moveTo(this._min,
f);a.lineTo(b,f)};e.prototype.drawTrigsPath=function(a){var b=this._min,f=this._max,e=this._height,d=e/2;a.moveTo(b,0);a.lineTo(b+e,d);a.lineTo(b,e);a.lineTo(b,0);a.moveTo(f,0);a.lineTo(f-e,d);a.lineTo(f,e);a.lineTo(f,0)};e.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};e.prototype.toSVG=function(){var a=new I;this.drawStemPath(a);var b=new I;this.drawTrigsPath(b);return w(A,"g",
[w(A,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),w(A,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};t.prototype=Object.create(l.prototype);t.prototype.min=function(){return this._min};t.prototype.max=function(){return this._max};t.prototype.height=function(){return this._height};t.prototype.drawPath=function(a){var b=this._min,f=this._max,e=this._height;if(this._parallel){var d=e/2,g=0.4*e;this._sw?(a.moveTo(b+d,e-g),a.lineTo(b+d,e),a.lineTo(b,d),a.lineTo(b+d,0),a.lineTo(b+
d,g)):(a.moveTo(b,e-g),a.lineTo(b,g));this._ne?(a.lineTo(f-d,g),a.lineTo(f-d,0),a.lineTo(f,d),a.lineTo(f-d,e),a.lineTo(f-d,e-g)):(a.lineTo(f,g),a.lineTo(f,e-g))}else{var d=(b+f)/2,g=0.4*(f-b),k=e/3;this._ne?(a.moveTo(b+g,k),a.lineTo(b,k),a.lineTo(d,0),a.lineTo(f,k),a.lineTo(f-g,k)):(a.moveTo(b+g,0),a.lineTo(f-g,0));this._sw?(a.lineTo(f-g,e-k),a.lineTo(f,e-k),a.lineTo(d,e),a.lineTo(b,e-k),a.lineTo(b+g,e-k)):(a.lineTo(f-g,e),a.lineTo(b+g,e))}a.closePath()};C.prototype.min=function(){return this._min};
C.prototype.max=function(){return this._max};C.prototype.height=function(){return this._height};C.prototype.toSVG=function(){return w(A,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};C.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();
for(var b=2;b<this._height;b+=3)a.moveTo(this._min,b),a.lineTo(this._max,b);a.stroke()}};R.prototype.min=function(){return this._min};R.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};R.prototype.height=function(){return this._height};R.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};R.prototype.toSVG=function(){return w(A,"text",this._string,{x:this._min,y:this._height-4})};N.prototype.min=function(){return this._min};
N.prototype.max=function(){return this._max};N.prototype.height=function(){return this._height};N.prototype.draw=function(a){var b=this._seq,f=this._fill;if(b){var e=(this._max-this._min+1)/b.length,d=(3-this._readframe)%3,g=(b.length-d)%3,d="+"==this._orientation?d:g;0<d&&(a.fillStyle=f,a.fillRect(this._min,0,e*d,this._height));for(;d<b.length;d+=3){g=b.substr(d,3).toUpperCase();"-"==this._orientation&&(g=E(g));var k=g in J?J[g]:"?",f=3==g.length?L(k,d,this._fill):this._fill;a.fillStyle=f;a.fillRect(this._min+
d*e,0,e*g.length,this._height);8<=e&&3==g.length&&(a.fillStyle="white",a.fillText(k,this._min+(d+1)*e,this._height))}}};N.prototype.toSVG=function(){var a=w(A,"g"),b=this._seq,f=this._fill;if(!b)return a;var e=(this._max-this._min+1)/b.length,d=(3-this._readframe)%3,g=(b.length-d)%3,d="+"==this._orientation?d:g;for(0<d&&a.appendChild(w(A,"rect",null,{x:this._min,y:0,width:e*d,height:this._height,fill:f}));d<b.length;d+=3){g=b.substr(d,3).toUpperCase();"-"==this._orientation&&(g=E(g));var k=g in J?
J[g]:"?",f=3==g.length?L(k,d,this._fill):this._fill;a.appendChild(w(A,"rect",null,{x:this._min+d*e,y:0,width:e*g.length,height:this._height,fill:f}));8<=e&&3==g.length&&a.appendChild(w(A,"text",k,{x:this._min+(d+1)*e,y:this._height,fill:"white"}))}return a};(function(a){function b(a,f,e,d,g,m,k,c,n,h){this.baseColors=a;this._strandColor=f;this._min=e;this._max=d;this._height=g;this._seq=m;this._ref=k;this._scheme=c;this._quals=n;this._fillbg=h}var f=1<window.devicePixelRatio,e={},d=/^[ACGT-]$/;b.prototype.min=
function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){var b=this._seq,g=this._ref,m="mismatch-all"===this._scheme,k=b?b.length:this._max-this._min+1,c=(this._max-this._min+1)/k;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=c||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-
this._min,this._height/2));for(var n=0;n<k;++n){var h=b?b.substr(n,1).toUpperCase():"N";if(d.test(h)||8<=c){var t=this.baseColors[h];if(this._quals){var l=this._quals.charCodeAt(n)-33,z=a.globalAlpha;a.globalAlpha=this.alphaForQual(l)}t||(l=g?g.substr(n,1).toUpperCase():"N",t="N"==h||"N"==l?"gray":this._strandColor,m&&(h=l));a.fillStyle=t;l=d.test(h);!this._fillbg&&8<=c&&l||a.fillRect(this._min+n*c,0,c,this._height);if(8<=c&&l){var l=t+"_"+h,q=e[l];if(!q){q=document.createElement("canvas");f?(q.width=
16,q.height=20):(q.width=8,q.height=10);var r=q.getContext("2d");f&&r.scale(2,2);r.fillStyle=this._fillbg?"black":t;t=r.measureText(h).width;r.fillText(h,0.5*(8-t),8);e[l]=q}f?a.drawImage(q,this._min+n*c+0.5*(c-8),0,8,10):a.drawImage(q,this._min+n*c+0.5*(c-8),0)}this._quals&&(a.globalAlpha=z)}}};b.prototype.toSVG=function(){for(var a=this._seq,b=this._ref,f="mismatch-all"===this._scheme,e=(this._max-this._min+1)/this._seq.length,g=w(A,"g"),m=0;m<a.length;++m){var k=a?a.substr(m,1).toUpperCase():"N",
c=this.baseColors[k];if(!c){var n=b?b.substr(m,1).toUpperCase():"N",c="N"==k||"N"==n?"gray":this._strandColor;f&&(k=n)}n=1;this._quals&&(n=this._quals.charCodeAt(m)-33,n=this.alphaForQual(n));var h=d.test(k);!this._fillbg&&8<=e&&h||g.appendChild(w(A,"rect",null,{x:this._min+m*e,y:0,width:e,height:this._height,fill:c,fillOpacity:n}));8<=e&&h&&g.appendChild(w(A,"text",k,{x:this._min+(0.5+m)*e,y:8,textAnchor:"middle",fill:this._fillbg?"black":c,fillOpacity:n}))}return g};a.SequenceGlyph=b})(this);P.prototype.height=
function(){return this._height?this._height:this.glyph.height()+this._y};P.prototype.min=function(){return this.glyph.min()+this._x};P.prototype.max=function(){return this.glyph.max()+this._x};P.prototype.minY=function(){return this._y};P.prototype.maxY=function(){return this._y+this.glyph.height()};P.prototype.draw=function(a,b){a.save();a.translate(this._x,this._y);this.glyph.draw(a,b);a.restore()};P.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+
","+this._y+")");return a};x.prototype.min=function(){return this._x-2};x.prototype.max=function(){return this._x+2};x.prototype.height=function(){return this._height};x.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};x.prototype.toSVG=function(){return w(A,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};H.prototype.notSelectable=!0;H.prototype.min=function(){return-1E5};H.prototype.max=
function(){return 1E5};H.prototype.height=function(){return this._height};H.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);a.stroke();a.restore()};H.prototype.toSVG=function(){for(var a=new I,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,b);return w(A,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};D.prototype=Object.create(l.prototype);D.prototype.min=
function(){return this._x-this._r};D.prototype.max=function(){return this._x+this._r};D.prototype.height=function(){return 2*this._r};D.prototype.drawPath=function(a){for(var b=this._x,f=this._r,e=this._r,d=0;d<this._points;++d){var g=6.28*d/this._points,k=b+e*Math.sin(g),g=f-e*Math.cos(g);0==d?a.moveTo(k,g):a.lineTo(k,g);g=6.28*(d+0.5)/this._points;k=b+0.4*e*Math.sin(g);g=f-0.4*e*Math.cos(g);a.lineTo(k,g)}a.closePath()};f.prototype.draw=function(a){var b=this._height/2;a.fillStyle=this._stroke;a.beginPath();
a.arc(this._x,b,b-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};f.prototype.toSVG=function(){var a=this._hh;return w(A,"g",[w(A,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),w(A,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};f.prototype.min=function(){return this._x-this._hh};f.prototype.max=
function(){return this._x+this._hh};f.prototype.height=function(){return this._height};z.prototype.translate=function(a,b){this.ox+=a;this.oy+=b};z.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};z.prototype.draw=function(a,b,f){for(var e=0;e<this.glyphs.length;++e){var d=this.glyphs[e];a.save();a.translate(d.x,d.y);d.glyph.drawOverlay(a,b,f);a.restore()}};"undefined"!==typeof u&&(u.exports={BoxGlyph:p,GroupGlyph:r,LineGraphGlyph:h,LabelledGlyph:v,CrossGlyph:q,
ExGlyph:y,TriangleGlyph:b,DotGlyph:a,PaddedGlyph:n,AArrowGlyph:d,SpanGlyph:k,LineGlyph:g,PrimersGlyph:e,ArrowGlyph:t,TooManyGlyph:C,TextGlyph:R,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:N,TranslatedGlyph:P,GridGlyph:H,StarGlyph:D,PointGlyph:x,PlimsollGlyph:f,OverlayLabelCanvas:z})},{"./spans":35,"./svg-utils":38,"./utils":50}],22:[function(c,u,s){function l(c,h){this.base=c;this.query=h}if("undefined"!==typeof c)var p=c("./das").DASFeature;l.prototype.features=function(c,h,l){url=this.base+
"/features/"+c.name;h=[];this.query&&h.push(this.query);c.isBounded&&(h.push("start="+c.start),h.push("end="+c.end));0<h.length&&(url=url+"?"+h.join("&"));var q=new XMLHttpRequest;q.onreadystatechange=function(){if(4==q.readyState)if(300<=q.status)l(null,"Error code "+q.status);else{var h=JSON.parse(q.response).features,b=[];for(fi=0;fi<h.length;++fi){var a=h[fi],n=new p;n.segment=c;n.min=(a.start|0)+1;n.max=a.end|0;a.name&&(n.label=a.name);n.type=a.type||"unknown";b.push(n)}l(b)}};q.open("GET",url,
!0);q.responseType="text";q.send("")};"undefined"!==typeof u&&(u.exports={JBrowseStore:l})},{"./das":10}],23:[function(c,u,s){function l(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new P(function(b,e){a.notifyRequestsIssued=b})}function p(a,b,e,f,d,g,k){this.chr=a;this.min=b;this.max=e;this.coverage=k;this.scale=f;this.features=d||[];this.status=g}function r(a,b,e,f,d,k){this.tierMap=a;this.chr=b;this.min=e;this.max=f;this.scale=d;this.seqSource=k||new g;this.viewCount=0;
this.featureCache={};this.latestViews={}}function h(a,b,e){for(var f=[],d={},g=0;g<a.length;++g){var k=a[g];k.min&&k.max?k.groups&&0<k.groups.length?q(d,k.groups[0].id,k):k.min<=e&&k.max>=b&&f.push(k):f.push(k)}for(var c in d){a=d[c];for(var n=1E11,h=-1E11,g=0;g<a.length;++g)k=a[g],n=Math.min(n,k.min),h=Math.max(h,k.max);if(n<=e||h>=b)for(g=0;g<a.length;++g)f.push(a[g])}return f}if("undefined"!==typeof c){s=c("./utils");var v=s.Awaited,q=s.pusho;s=c("./sourceadapters");var y=s.MappedFeatureSource,
b=s.CachingFeatureSource,a=s.BWGFeatureSource,n=s.RemoteBWGFeatureSource,d=s.BAMFeatureSource,k=s.RemoteBAMFeatureSource,g=s.DummySequenceSource,e=s.DummyFeatureSource,t=c("./overlay").OverlayFeatureSource;s=c("./spans");var C=s.Range,R=s.intersection;s=c("./sample");var L=s.downsample,E=s.getBaseCoverage,N=c("./das").DASSequence,P=c("es6-promise").Promise}l.prototype.addRequest=function(a){this.reqs.push(a)};l.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};
p.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};r.prototype.cancel=function(){this.cancelled=!0};r.prototype.bestCacheOverlapping=function(a,b,e){return(a=this.featureCache[this.tierMap[0]])?a:null};r.prototype.viewFeatures=function(a,b,e,f){if(f!=f)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=e;this.scale=f;this.pool&&this.pool.abortAll();this.pool=new l;
this.awaitedSeq=new v;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};r.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};r.prototype.startFetchesForTiers=function(a){for(var b=this,e=this.awaitedSeq,f=!1,d,g=0;g<a.length;++g)try{this.startFetchesFor(a[g],e)&&(f=!0)}catch(k){d=a[g],d.currentFeatures=[],d.currentSequence=null,d.draw(),d.updateHeight(),d.updateStatus(k),console.log("Error fetching tier source"),
console.log(k),d=k}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var c=this.min,n=this.max;if(this.cs&&this.cs.start<=c&&this.cs.end>=n)return a=this.cs.start==c&&this.cs.end==n?this.cs:new N(this.cs.name,c,n,this.cs.alphabet,this.cs.seq.substring(c-this.cs.start,n+1-this.cs.start)),e.provide(a);this.seqSource.fetch(this.chr,c,n,this.pool,function(a,f){if(f){if(!b.cs||c<=b.cs.start&&n>=b.cs.end||c>=b.cs.end||n<=b.cs.start||n-c>b.cs.end-b.cs.start)b.cs=f;e.provide(f)}else console.log("Sequence loading failed",
a),e.provide(null)})}if(d)throw d;};r.prototype.startFetchesFor=function(a,b){var d=this,f=this.viewCount,g=a.getSource()||new e,k=a.needsSequence(this.scale),c=d.featureCache[a],n=a.getActiveStyleFilters(this.scale),t;n&&(t=n.typeList());var l=this.chr,q=this.min,m=this.max;if(void 0===t)return!1;if(c&&c.chr===this.chr&&c.min<=q&&c.max>=m){var r=c.features;if(c.min<q||c.max>m)r=h(r,q,m);d.provision(a,c.chr,R(c.coverage,new C(q,m)),c.scale,t,r,c.status,k?b:null);r=g.getScales();if(c.scale<=this.scale||
!r)return k}g.instrument&&console.log("Starting  fetch "+f+" ("+q+", "+m+")");g.fetch(l,q,m,this.scale,t,this.pool,function(e,n,h,r){g.instrument&&console.log("Finishing fetch "+f);var w=d.latestViews[a]||-1;if(!(d.cancelled||w>f)){r||(r=new C(q,m));if(!c||q<c.min||m>c.max)d.featureCache[a]=new p(l,q,m,h,n,e,r);d.latestViews[a]=f;d.provision(a,l,r,h,t,n,e,k?b:null)}},n);return k};r.prototype.provision=function(e,g,c,f,h,l,q,r){q&&(e.currentFeatures=[],e.currentSequence=null,e.draw(),e.updateHeight());
e.updateStatus(q);if(!q){for(var p=q=!1,C=e.getSource();y.prototype.isPrototypeOf(C)||b.prototype.isPrototypeOf(C)||t.prototype.isPrototypeOf(C);)C=t.prototype.isPrototypeOf(C)?C.sources[0]:C.source;if(a.prototype.isPrototypeOf(C)||n.prototype.isPrototypeOf(C)||d.prototype.isPrototypeOf(C)||k.prototype.isPrototypeOf(C))q=!0;C.opts&&(C.opts.forceReduction||C.opts.noDownsample)||q&&h&&1==h.length&&0<=h.indexOf("density")&&(l=L(l,this.scale));h&&1==h.length&&0<=h.indexOf("base-coverage")&&(p=!0);r?r.await(function(a){p&&
(l=E(l,a,e.browser.baseColors));e.viewFeatures(g,c,f,l,a)}):e.viewFeatures(g,c,f,l)}};"undefined"!==typeof u&&(u.exports={KnownSpace:r})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":35,"./utils":50,"es6-promise":54}],24:[function(c,u,s){function l(a,b){this.block=a;this.offset=b}function p(a,b){var d=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),k=a[b+1]<<8|a[b];return 0==d&&0==k?null:new l(d,k)}function r(a,c){c=Math.min(c||
1,a.byteLength-50);for(var d=[],k=[0],g=0;k[0]<c;){var e=new Uint8Array(a,k[0],12),e=e[11]<<8|e[10],e=y(a,12+e+k[0],Math.min(65536,a.byteLength-12-e-k[0]),k);k[0]+=8;g+=e.byteLength;d.push(e)}if(1==d.length)return d[0];k=new Uint8Array(g);for(e=g=0;e<d.length;++e){var h=new Uint8Array(d[e]);b(h,0,k,g,h.length);g+=h.length}return k.buffer}function h(a,b){this.minv=a;this.maxv=b}function v(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>
23):a>>26==b>>26?1+(a>>26):0}function q(a,b){var d,k=[];--b;k.push(0);for(d=1+(a>>26);d<=1+(b>>26);++d)k.push(d);for(d=9+(a>>23);d<=9+(b>>23);++d)k.push(d);for(d=73+(a>>20);d<=73+(b>>20);++d)k.push(d);for(d=585+(a>>17);d<=585+(b>>17);++d)k.push(d);for(d=4681+(a>>14);d<=4681+(b>>14);++d)k.push(d);return k}if("undefined"!==typeof c){c=c("jszlib");var y=c.inflateBuffer,b=c.arrayCopy}l.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof u&&(u.exports={unbgzf:r,readVob:p,
reg2bin:v,reg2bins:q,Chunk:h})},{jszlib:66}],25:[function(c,u,s){function l(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function p(b){this.source=b;v.call(this);this.storeHolder=new q;this.parser=h(b.payload);if(!this.parser)throw"Unsupported memstore payload: "+b.payload;var a=this;this._load(function(b,d){if(b){for(var k=new l,g=[],e=b.split("\n"),c=a.parser.createSession(function(a){g.push(a)}),h=0;h<e.length;++h){var q=e[h];0<q.length&&c.parse(q)}c.flush();k.addFeatures(g);a.storeHolder.provide(k)}else a.error=
d||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof c){u=c("./sourceadapters");var r=u.registerSourceAdapterFactory,h=u.makeParser,v=u.FeatureSourceBase;c("./das");c=c("./utils");var q=c.Awaited,y=c.textXHR}l.prototype.addFeatures=function(b){for(var a={},c=0;c<b.length;++c){var d=b[c],k=d.segment||d.chr,g=this.featuresByChr[k];g||(g=[],this.featuresByChr[k]=g);g.push(d);a[k]=!0;d=d.max-d.min+1;d>this.maxLength&&(this.maxLength=d)}for(k in a)g=this.featuresByChr[k],g.sort(function(a,
b){var d=a.min-b.min;return 0!=d?d:a.max-b.max});this.chrRing=null};l.prototype._indexFor=function(b,a){for(var c=0,d=b.length;d>c;){var k=(c+d)/2|0;if(k>=b.length)return b.length;a<b[k].min?d=k:c=k+1}return d};l.prototype.fetch=function(b,a,c){var d=this.featuresByChr[b];d||(d=0==b.indexOf("chr")?this.featuresByChr[b.substring(3)]:this.featuresByChr["chr"+b]);if(!d)return[];var k=Math.max(0,this._indexFor(d,a-this.maxLength-1));b=Math.min(d.length-1,this._indexFor(d,c));for(var g=[];k<=b;++k){var e=
d[k];e.min<=c&&e.max>=a&&g.push(e)}return g};l.prototype.findNextFeature=function(b,a,c){if(null==this.chrRing){this.chrRing=[];for(b in this.featuresByChr)this.chrRing.push(b);this.chrRing.sort()}var d=this.featuresByChr[b];d||(b=0==b.indexOf("chr")?b.substring(3):"chr"+b,d=this.featuresByChr[b]);if(!d)return null;var k=Math.max(0,Math.min(this._indexFor(d,a),d.length-1));if(0<c){for(;k<d.length;){var g=d[k++];if(g.min>a)return g}b=this.chrRing.indexOf(b)+1;b>=this.chrRing.length&&(b=0);return this.findNextFeature(this.chrRing[b],
0,c)}for(;0<=k;)if(g=d[k--],g.max<a)return g;b=this.chrRing.indexOf(b)-1;0>b&&(b=this.chrRing.length-1);return this.findNextFeature(this.chrRing[b],1E10,c)};p.prototype=Object.create(v.prototype);p.prototype._load=function(b){if(this.source.blob){var a=new FileReader;a.onloadend=function(){return b(a.result,a.error)};a.readAsText(this.source.blob)}else{if(this.source.credentials)var c={credentials:this.source.credentials};y(this.source.uri,b,c)}};p.prototype.fetch=function(b,a,c,d,k,g,e){var h=this;
this.storeHolder.await(function(d){return d?(d=d.fetch(b,a,c),e(null,d,1E8)):e(h.error)})};p.prototype.getStyleSheet=function(b){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(b)};p.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};p.prototype.getScales=function(){return 1E8};p.prototype.findNextFeature=function(b,a,c,d){var k=this;this.storeHolder.await(function(g){return g?d(g.findNextFeature(b,a,c)):d(null,k.error)})};
p.prototype.capabilities=function(){return{leap:!0}};r("memstore",function(b){return{features:new p(b)}})},{"./das":10,"./sourceadapters":34,"./utils":50}],26:[function(c,u,s){function l(c){return(c|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function p(c){c=""+c;var h=c.indexOf(".");if(0>h)return c;var l=2;"-"==c.substring(0,1)&&++l;return h>=l?c.substring(0,h):c.substring(0,h+2)}"undefined"!==typeof u&&(u.exports={formatLongInt:l,formatQuantLabel:p})},{}],27:[function(c,u,s){function l(c,
l){this.sources=c;this.opts=l||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var b=0;b<this.sources.length;++b)this.initN(b);"function"===typeof l.merge?this.merge=l.merge:"concat"==l.merge?this.merge=h:"alternates"==l.merge?(this.merge=h,this.filterDispatchOnMethod=!0):this.merge=r}function p(c,h,b){this.source=c;this.callback=h;this.sources=b;this.count=b.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=
[];this.statuses=[];this.scale=null}function r(c){for(var h=[],b=1;b<c.length;++b){for(var a={},n=c[b],d=0;d<n.length;++d)a[this.keyForFeature(n[d])]=n[d];h.push(a)}b=[];c=c[0];for(d=0;d<c.length;++d){for(var k=c[d],g=0;g<h.length;++g)if(a=h[g],n=a[this.keyForFeature(k)])for(var e in n)"score"===e?k.score2=n.score:"min"!==e&&"max"!==e&&"segment"!==e&&"_cachedStyle"!==e&&(k[e]=n[e]);b.push(k)}return b}function h(c,h){for(var b=[],a=0;a<c.length;++a)for(var n=c[a],d=h[a].name,k=0;k<n.length;++k){var g=
n[k];g.method=d;b.push(g)}return b}if("undefined"!==typeof c)var v=c("./utils").shallowCopy;l.prototype.initN=function(c){var h=this.sources[c],b=this;this.business[c]=0;h.addActivityListener&&h.addActivityListener(function(a){b.business[c]=a;b.notifyActivity()});h.addChangeListener&&h.addChangeListener(function(){b.notifyChange()});h.addReadinessListener&&h.addReadinessListener(function(a){b.readiness[c]=a;b.notifyReadiness()})};l.prototype.addReadinessListener=function(c){this.readinessListeners.push(c);
this.notifyReadinessListener(c)};l.prototype.notifyReadiness=function(){for(var c=0;c<this.readinessListeners.length;++c)this.notifyReadinessListener(this.readinessListeners[c])};l.prototype.notifyReadinessListener=function(c){for(var h=null,b=0;b<this.readiness.length;++b)if(null!=this.readiness[b]){h=this.readiness[b];break}try{c(h)}catch(a){console.log(a)}};l.prototype.addActivityListener=function(c){this.activityListeners.push(c)};l.prototype.notifyActivity=function(){for(var c=0,h=0;h<this.business.length;++h)c+=
this.business[h];for(h=0;h<this.activityListeners.length;++h)try{this.activityListeners[h](c)}catch(b){console.log(b)}};l.prototype.addChangeListener=function(c){this.changeListeners.push(c)};l.prototype.notifyChange=function(){for(var c=0;c<this.changeListeners.length;++c)try{this.changeListeners[c](this.busy)}catch(h){console.log(h)}};l.prototype.getScales=function(){return this.sources[0].getScales()};l.prototype.getStyleSheet=function(c){return this.sources[0].getStyleSheet(c)};l.prototype.capabilities=
function(){var c={},h=this.sources[0];h.capabilities&&(c=v(h.capabilities()));for(h=1;h<this.sources.length;++h){var b=this.sources[h];b.capabilities&&(b=b.capabilities(),b.search&&(c.search=b.search))}return c};l.prototype.search=function(c,h){for(var b=0;b<this.sources.length;++b){var a;a=this.sources[b];a=a.capabilities?a.capabilities().search:!1;if(a)return this.sources[b].search(c,h)}};l.prototype.fetch=function(c,h,b,a,n,d,k,g){var e;if(this.filterDispatchOnMethod){e=[];for(var t=g.list(),l=
0;l<this.sources.length;++l)for(var r=this.sources[l],L=0;L<t.length;++L){var E=t[L];if(!E.method||E.method==r.name){e.push(r);break}}}else e=this.sources;k=new p(this,k,e);for(l=0;l<e.length;++l)this.fetchN(k,l,e[l],c,h,b,a,n,d,g)};l.prototype.fetchN=function(c,h,b,a,n,d,k,g,e,t){b.fetch(a,n,d,k,g,e,function(a,b,e){return c.completed(h,a,b,e)},t)};l.prototype.quantFindNextFeature=function(c,h,b,a,n){return this.sources[0].quantFindNextFeature(c,h,b,a,n)};l.prototype.findNextFeature=function(c,h,
b,a){return this.sources[0].findNextFeature(c,h,b,a)};p.prototype.completed=function(c,h,b,a){if(null==this.scale||0==c)this.scale=a;if(this.returns[c])throw"Multiple returns for source "+c;this.returns[c]=!0;this.returnCount++;this.features[c]=b;h&&(this.statuses[c]=h,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){c="";for(h=0;h<this.count;++h)if(b=this.statuses[h])0<c.length&&(c+=", "),c+=b;return this.callback(c,null,this.scale)}this.callback(null,this.source.merge(this.features,
this.sources),this.scale)}};l.prototype.getDefaultFIPs=function(c){for(var h=0;h<this.sources.length;++h){var b=this.sources[h];b.getDefaultFIPs&&b.getDefaultFIPs(c)}};l.prototype.keyForFeature=function(c){return""+c.min+".."+c.max};"undefined"!==typeof u&&(u.exports={OverlayFeatureSource:l})},{"./utils":50}],28:[function(c,u,s){function l(g,e,c){var C=/^\w+\s[0-9]+\s[0-9]+.*$/,s=/([^=]+)=\"?([^\"]+)\"?/,L=/^##\s*fileformat=VCFv4\..+/;(g.blob?new h(g.blob):"encode"==g.transport?new k(g.uri):new r(g.uri,
{credentials:g.credentials})).slice(0,65536).salted().fetch(function(k,h){if(!k)return c||(g.credentials=!0,l(g,e,!0)),e(g,"Couldn't fetch data");var r=new Uint8Array(k),x=(new Uint32Array(k,0,1))[0];if(x==q||x==y){g.tier_type="bwg";r=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(r=r.exec(g.uri||g.blob.name))g.name=r[1];return e(g,null)}if(x==n)return g.tier_type="bai",e(g,null);if(31==r[0]||139==r[1]){r=b(k);r=new Uint8Array(r);x=v(r,0);if(x==a){g.tier_type="bam";r=/\/?([^/]+?)(.bam)?$/;if(r=r.exec(g.uri||
g.blob.name))g.name=r[1];return e(g,null)}if(x==d)return g.tier_type="tabix-index",e(g,null);if(1768301347==x){g.tier_type="tabix";g.payload="vcf";r=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(r=r.exec(g.uri||g.blob.name))g.name=r[1];return e(g,null)}console.log("magic = "+x.toString(16));return e(g,"Unsupported format")}r=String.fromCharCode.apply(null,r).split("\n");if(0<r.length&&L.test(r[0]))return g.tier_type="memstore",g.payload="vcf",r=/\/?([^/]+?)(.vcf)?$/,(r=r.exec(g.uri||g.blob.name))&&!g.name&&(g.name=
r[1]),e(g,null);for(var H=0;H<r.length;++H)if(x=r[H].replace("\r",""),0!=x.length&&0!=x.indexOf("browser")){if(0==x.indexOf("track")){r="bed";x=x.split(/\s/);for(H=1;H<x.length;++H){var u=s.exec(x[H]);u&&("type"==u[1]&&"wiggle_0"==u[2]?r="wig":"name"==u[0]&&(g.name=u[2]))}p(g,r);return e(g,null)}if(0==x.indexOf("fixedStep")||0==x.indexOf("variableStep"))return p(g,"wig"),e(g,null);if(C.test(x))return p(g,null),e(g,null);break}return e(g,"Unsupported format")})}function p(a,b){a.tier_type="memstore";
var d=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);d&&(a.name||(a.name=d[1]),!b&&d[3]&&(b=d[3]));a.payload=b||"bed"}if("undefined"!==typeof c){s=c("./bin");var r=s.URLFetchable,h=s.BlobFetchable,v=s.readInt;s=c("./bigwig");var q=s.BIG_WIG_MAGIC,y=s.BIG_BED_MAGIC,b=c("./lh3utils").unbgzf;s=c("./bam");var a=s.BAM_MAGIC,n=s.BAI_MAGIC,d=c("./tabix").TABIX_MAGIC,k=c("./encode").EncodeFetchable}"undefined"!==typeof u&&(u.exports={probeResource:l})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,
"./lh3utils":24,"./tabix":40}],29:[function(c,u,s){function l(a){return n[a%n.length]*Math.pow(10,a/n.length|0)}function p(a,b,g){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=g;this.features=[]}function r(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function h(a,b){for(var g=0;l(g+1)<b;)++g;for(var g=l(g),e=[],c=-1E10,h=1E10,n=0;n<a.length;++n){var r=a[n];if(r.groups&&0<r.groups.length)return a;for(var q=r.min/g|0,s=r.max/g|0,c=Math.max(c,s),h=Math.min(h,
q);q<=s;++q){var P=e[q];P||(P=new p(g,q*g,(q+1)*g-1),e[q]=P);P.feature(r)}}n=[];for(q=h;q<=c;++q)if(P=e[q])r=new y,r.segment=a[0].segment,r.min=q*g+1,r.max=(q+1)*g,r.score=P.score(),r.type="density",n.push(r);Date.now();return n}function v(a){this._pos=a;this._bases={};this._totalCount=0}function q(d,k,g){for(var e,c,h=null,n=null,l=[],r=0;r<d.length;++r){var q=d[r];if(q.groups&&0<q.groups.length)return d;e=q.seq;var p=q.quals,x=b(q.cigar),s=[];c=[];for(var u=0,f=0;f<x.length;++f){var z=x[f];if("M"==
z.op)s.push(e.substr(u,z.cnt)),c.push(p.substr(u,z.cnt)),u+=z.cnt;else if("D"==z.op)for(var B=0;B<z.cnt;++B)s.push("-"),c.push("Z");else"I"==z.op?u+=z.cnt:"S"==z.op?u+=z.cnt:console.log("unknown cigop"+z.op)}e=s.join("");c=c.join("");s=e;u=c;f=q.orientation;z=q.min||0;q=q.max||0;c=0;for(e=z;e<=q;++e)x=l[e],x||(x=new v(e),l[e]=x),p=s.charAt(c),B=u.charCodeAt(c)-33,x.recordBase(p,B,f),c++;h=h?Math.min(h,z):z;n=n?Math.max(n,q):q}q=h;r=n;c=[];if(k&&(e=k.start|0,x=k.end|0,e<=r&&x>=q)){p=Math.max(q,e);
x=Math.min(r,x);for(s=0;s<p-q;s++)c.push("N");c.push(k.seq.substr(p-e,x-p+1));for(s=0;s<r-x;s++)c.push("N")}k=c.join("");r=[];c=0;for(e=h;e<=n;++e){if(x=l[e])if(q=new y,q.segment=d[0].segment,q.min=x.pos(),q.max=q.min,q.notes=[],q.notes=q.notes.concat(x.infoList()),q.type="base-coverage",q.suppressScore=!0,k)for(h=k.charAt(c),q.notes.unshift("Ref="+h),x=x.baseScoreList(h,0.2),s=0;s<x.length;s++){p=x[s].base;u=x[s].score;f=a(q);f.score=u;if(1<x.length||p!=h)f.itemRgb=g[p];r.push(f)}else r.push(q);
c++}return r}if("undefined"!==typeof c)var y=c("./das").DASFeature,b=c("./cigar").parseCigar,a=c("./utils").shallowCopy;var n=[1,2,5];p.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(r);for(var b=-1E10,g=0,e=0,c=1;c<a.length;++c){var h=a[c],n=Math.max(h.min,this.min),h=Math.min(h.max,this.max),e=e+(h-n+1);n>b?(g+=h-n+1,b=h):h>b&&(g+=h-b,b=h)}return 0<g?1*e/g:0};p.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,
this.hasScore=!0);++this.cnt;this.features.push(a)};v.prototype.recordBase=function(a,b,g){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[g]++;else{var e={"+":0,"-":0};e[g]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:e}}this._totalCount++};v.prototype.totalCount=function(){return this._totalCount};v.prototype.pos=function(){return this._pos};v.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var g in this._bases){var e=this._bases[g],
c=e.cnt,h=e.strandCnt["+"],n=e.strandCnt["-"],e=e.totalQual/c,c=[g,"=",c," (",(100*c/b).toFixed(0),"%, ",h," +, ",n," -, Qual: ",e.toFixed(0),")"];a.push(c.join(""))}return a};v.prototype.baseScoreList=function(a,b){var g=[],e=this._totalCount,c=b*e,h;for(h in this._bases){var n=this._bases[h].cnt;n<c||h==a||(g.push({base:h,score:e}),e-=n)}g.push({base:a,score:e});return g};"undefined"!==typeof u&&(u.exports={downsample:h,getBaseCoverage:q})},{"./cigar":8,"./das":10,"./utils":50}],30:[function(c,
u,s){function l(c,h){var b=parseFloat(c.replace(/,/g,""));return"k"===h||"K"===h?1E3*b|0:"m"==h||"M"===h?1E6*b|0:b|0}if("undefined"!==typeof c)var p=c("./cbrowser").Browser,r=c("./bin").URLFetchable,h=c("./trix").connectTrix;var v=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;p.prototype.search=function(c,p){var b=this,a=v.exec(c);if(a){var n=a[1],d;if(a[6])d=l(a[2],a[3]),a=l(a[6],a[7]);else{var k=this.viewEnd-this.viewStart+1;d=l(a[2],a[3])-k/2|0;a=d+k-1}this.setLocation(n,
d,a,p)}else{if(!c||0==c.length)return!1;var g=0,e=!1,t=function(a,d){--g;if(d)return p(d);a||(a=[]);for(var k=5E8,h=-1E8,n=null,l=0;l<a.length;++l){var t=a[l];null==n&&(n=t.segment);k=Math.min(k,t.min);h=Math.max(h,t.max)}if(n)e=!0,b.highlightRegion(n,k,h),l=Math.max(2500,0.3*(h-k+1)|0),b.setLocation(n,k-l,h+l,p);else if(0==g&&!e)return p("no match for '"+c+"'")},C=function(a,b){b.lookup(c,function(b,e){if(null==b||2>b.length)return a.featureSource.search(c,t);var d=b[1].split(",")[0];return a.featureSource.search(d,
t)})};if(this.searchEndpoint)return g=1,this.doDasSearch(b.searchEndpoint,c,t);for(n=0;n<this.tiers.length;++n)(function(a){b.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++g,a.trix?C(a,a.trix):h(new r(a.dasSource.trixURI),new r(a.dasSource.trixURI+"x"),function(b){a.trix=b;C(a,b)})):(++g,a.featureSource.search(c,t)):a.dasSource.provides_search&&(++g,b.doDasSearch(a.dasSource,c,t))})(this.tiers[n])}};p.prototype.doDasSearch=function(c,h,b){c.features(null,{group:h,type:"transcript"},
function(a){a||(a=[]);for(var c=[],d=0;d<a.length;++d){var k=a[d];k.label.toLowerCase()==h.toLowerCase()&&c.push(k)}return b(c)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":47}],31:[function(c,u,s){function l(c,d){d||(d=b);for(var k=a.length;c*a[k%a.length]*Math.pow(10,k/a.length|0)<d;)++k;return a[k%a.length]*Math.pow(10,k/a.length|0)}function p(a,b){var c=a.viewport.getContext("2d"),g=a.browser.retina&&1<window.devicePixelRatio,e=a.browser.featurePanelWidth+2E3;g&&(e*=2);var h=a.viewport.width|0;h<
e-50&&(a.viewport.width=h=e);e=50;b&&b.seq&&(e+=25);var l=e;g&&(l*=2);a.viewport.height=l;a.viewport.style.height=""+e+"px";a.viewport.style.width=g?""+h/2+"px":""+h+"px";a.layoutHeight=e;a.updateHeight();a.background&&(c.fillStyle=a.background,c.fillRect(0,0,h,a.viewport.height));g&&c.scale(2,2);c.translate(1E3,0);r(a,b,c);a.norigin=a.browser.viewStart;a.viewportHolder.style.left="-1000px"}function r(a,b,c){var g=a.browser.scale,e=a.browser.viewStart-1E3/g|0,h=a.browser.viewEnd+2E3/g,r=a.browser.currentSeqMax,
q=h;0<r&&r<h&&(q=r);for(var p=l(g),E=Math.max(0,(e/p|0)*p),r=a.browser.viewStart;E<=q;)c.fillStyle=0==E/p%2?"white":"black",c.strokeStyle="black",c.fillRect((E-r)*g,8,p*g,3),c.strokeRect((E-r)*g,8,p*g,3),c.fillStyle="black",c.fillText(v(E),(E-r)*g,22),E+=p;if(b&&b.seq)for(;e<=h;++e)e>=b.start&&e<=b.end&&(q=b.seq.substr(e-b.start,1).toUpperCase(),(p=a.browser.baseColors[q])||(p="gray"),c.fillStyle=p,8<=g?(p=c.measureText(q).width,c.fillText(q,(e-r)*g+0.5*(g-p),52)):c.fillRect((e-r)*g,42,g,12))}function h(a,
b){var c=a.browser.scale,g=a.browser.viewStart-1E3/c|0,e=a.browser.viewEnd+2E3/c,h=a.browser.currentSeqMax,r=e;0<h&&h<e&&(r=h);for(var p=l(c),s=Math.max(0,(g/p|0)*p),h=a.browser.viewStart,E=q(y,"g",[],{fontSize:"8pt"});s<=r;)E.appendChild(q(y,"rect",null,{x:(s-h)*c,y:8,width:p*c,height:3,fill:0==s/p%2?"white":"black",stroke:"black"})),E.appendChild(q(y,"text",v(s),{x:(s-h)*c,y:28,fill:"black",stroke:"none"})),s+=p;if(b&&b.seq)for(;g<=e;++g)g>=b.start&&g<=b.end&&(r=b.seq.substr(g-b.start,1).toUpperCase(),
(p=a.browser.baseColors[r])||(p="gray"),8<=c?E.appendChild(q(y,"text",r,{x:(0.5+g-h)*c,y:52,textAnchor:"middle",fill:p})):E.appendChild(q(y,"rect",null,{x:(g-h)*c,y:42,width:c,height:12,fill:p})));return E}if("undefined"!==typeof c){s=c("./utils");var v=s.formatLongInt,q=s.makeElementNS,y=c("./svg-utils").NS_SVG,v=c("./numformats").formatLongInt}var b=100,a=[1,2,5],y="http://www.w3.org/2000/svg";"undefined"!==typeof u&&(u.exports={drawSeqTier:p,drawSeqTierGC:r,svgSeqTier:h})},{"./numformats":26,"./svg-utils":38,
"./utils":50}],32:[function(c,u,s){if("undefined"!=typeof c){u=c("./cbrowser");var l=u.Browser,p=u.sourceDataURI,r=u.sourcesAreEqual,h=c("./version"),v=c("./utils").miniJSONify,q=c("./sha1").hex_sha1}l.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+
this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};l.prototype.storeStatus=
function(){this.storeViewStatus();this.storeTierStatus()};l.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,
this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};l.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var c=[],b=0;b<this.tiers.length;++b){var a=this.tiers[b];a.dasSource.noPersist||c.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(c);c={};b=[];for(a=0;a<this.hubObjects.length;++a){var n=this.hubObjects[a],d={url:n.hub.url,genome:n.genome};n.credentials&&
(d.credentials=n.credentials);n.mapping&&(d.mapping=n.mapping);c[d.url]=!0;b.push(d)}for(a=0;a<this.hubs.length;++a)d=this.hubs[a],"string"===typeof d&&(d={url:d}),c[d.url]||b.push(d);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;
localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=h.CONFIG}};l.prototype.restoreStatus=function(){if(!this.noPersist){var c=localStorage["dalliance."+this.cookieKey+".version"];if(h.CONFIG==(c?c|0:-100)){var c=localStorage["dalliance."+this.cookieKey+".configHash"]||
"",b=q(v({sources:this.sources,hubs:this.hubs}));if(b!=c)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{c={};for(b=0;b<this.sources.length;++b){var a=this.sources[b];if(a){var n=p(a),d=c[n];d||(c[n]=d=[]);d.push(a)}}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,d=localStorage["dalliance."+this.cookieKey+".view-end"]|0,b&&a&&d)){this.chr=b;this.viewStart=a;this.viewEnd=d;if(b=localStorage["dalliance."+
this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=
(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var k=JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<k.length;++b)for(a=
this.sources[b]=k[b].source,this.restoredConfigs[b]=k[b].config,n=p(a),d=c[n]||[],n=0;n<d.length;++n){var g=d[n];if(r(a,g))for(var e in g)g.hasOwnProperty(e)&&("function"===typeof g[e]||g[e]instanceof Blob)&&(a[e]=g[e])}}if(e=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(e);return!0}}}};l.prototype.reset=function(){for(var c=this.tiers.length-1;0<=c;--c)this.removeTier({index:c},!0);for(c=0;c<this.defaultSources.length;++c)this.defaultSources[c].disabled||this.addTier(this.defaultSources[c]);
this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./utils":50,"./version":52}],33:[function(c,u,s){function l(b){b=r(h(b));for(var a=q?"0123456789ABCDEF":"0123456789abcdef",c="",d,k=0;k<b.length;k++)d=b.charCodeAt(k),c+=a.charAt(d>>>4&15)+a.charAt(d&15);return c}function p(b){b=r(h(b));for(var a="",c=b.length,d=0;d<c;d+=3)for(var k=b.charCodeAt(d)<<16|(d+1<c?b.charCodeAt(d+1)<<8:0)|(d+2<c?b.charCodeAt(d+
2):0),g=0;4>g;g++)a=8*d+6*g>8*b.length?a+y:a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-g)&63);return a}function r(b){for(var a=Array(b.length>>2),c=0;c<a.length;c++)a[c]=0;for(c=0;c<8*b.length;c+=8)a[c>>5]|=(b.charCodeAt(c/8)&255)<<24-c%32;b=8*b.length;a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;b=Array(80);for(var c=1732584193,d=-271733879,k=-1732584194,g=271733878,e=-1009589776,h=0;h<a.length;h+=16){for(var l=c,r=d,q=k,p=g,s=e,u=0;80>u;u++){if(16>u)b[u]=a[h+
u];else{var x=b[u-3]^b[u-8]^b[u-14]^b[u-16];b[u]=x<<1|x>>>31}var x=c<<5|c>>>27,y;y=20>u?d&k|~d&g:40>u?d^k^g:60>u?d&k|d&g|k&g:d^k^g;x=v(v(x,y),v(v(e,b[u]),20>u?1518500249:40>u?1859775393:60>u?-1894007588:-899497514));e=g;g=k;k=d<<30|d>>>2;d=c;c=x}c=v(c,l);d=v(d,r);k=v(k,q);g=v(g,p);e=v(e,s)}a=[c,d,k,g,e];b="";for(c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>24-c%32&255);return b}function h(b){for(var a="",c=-1,d,k;++c<b.length;)d=b.charCodeAt(c),k=c+1<b.length?b.charCodeAt(c+1):0,55296<=
d&&56319>=d&&56320<=k&&57343>=k&&(d=65536+((d&1023)<<10)+(k&1023),c++),127>=d?a+=String.fromCharCode(d):2047>=d?a+=String.fromCharCode(192|d>>>6&31,128|d&63):65535>=d?a+=String.fromCharCode(224|d>>>12&15,128|d>>>6&63,128|d&63):2097151>=d&&(a+=String.fromCharCode(240|d>>>18&7,128|d>>>12&63,128|d>>>6&63,128|d&63));return a}function v(b,a){var c=(b&65535)+(a&65535);return(b>>16)+(a>>16)+(c>>16)<<16|c&65535}var q=0,y="";"undefined"!==typeof u&&(u.exports={b64_sha1:p,hex_sha1:l})},{}],34:[function(c,u,
s){function l(a,b){ka[a]=b}function p(a,b){ga[a]=b}function r(a){if(ga[a])return ga[a](a)}function h(a){var b=this;this.source=a;this.cfsid="cfs"+ ++la;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){b.cfsid="cfs"+ ++la})}function v(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function q(a){this.dasSource=new z(a);this.busy=0;this.activityListeners=[]}function y(a){this.dasSource=new z(a);this.awaitedEntryPoints=new N;var b=
this;this.dasSource.entryPoints(function(a){b.awaitedEntryPoints.provide(a)})}function b(a){var b=this;this.source=a;this.twoBit=new N;if(a.twoBitURI)a=new A(a.twoBitURI);else if(a.twoBitBlob)a=new I(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");m(a,function(a,f){f?console.log(f):b.twoBit.provide(a)})}function a(a){v.call(this);var b=this;this.readiness="Connecting";this.bwgSource=this.opts=a;b.bwgHolder=new N;if(this.opts.preflight){var f=ea[this.opts.preflight];if(!f){f=
new N;ea[this.opts.preflight]=f;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?f.provide("success"):f.provide("failure"))};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials=!0);e.send("")}f.await(function(a){"success"===a&&b.init()})}else b.init()}function n(a,b){v.call(this);this.worker=b;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new N;this.init()}function d(a,b){if(!(a.flag&
G.SEGMENT_UNMAPPED)){var f;f=a.seq?a.seq.length:a.seqLength;if(a.cigar){f=0;for(var e=Z(a.cigar),d=0;d<e.length;++d){var g=e[d];if("M"==g.op||"D"==g.op)f+=g.cnt}}e=new K;e.min=a.pos+1;e.max=a.pos+f;e.segment=a.segment;e.type="bam";e.id=a.readName;e.notes=["MQ="+a.mq];e.cigar=a.cigar;e.seq=a.seq;e.quals=a.quals;e.orientation=a.flag&G.REVERSE_COMPLEMENT?"-":"+";e.bamRecord=a;b&&a.flag&G.MULTIPLE_SEGMENTS&&(e.groups=[{id:a.readName,type:"readpair"}]);return e}}function k(a){v.call(this);var b=this;this.bamSource=
a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new N;if(this.opts.preflight){var f=ea[this.opts.preflight];if(!f){f=new N;ea[this.opts.preflight]=f;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?f.provide("success"):f.provide("failure"))};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials="true");e.send("")}f.await(function(a){"success"===a&&b.init()})}else b.init()}
function g(a,b){v.call(this);this.bamSource=a;this.worker=b;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new N;this.init()}function e(a,b){this.source=a;this.mapping=b;this.activityListeners=[];this.busy=0}function t(){}function C(){}function R(a){this.store=new T(a.jbURI,a.jbQuery)}if("undefined"!==typeof c){var L=c("./cbrowser").Browser,E=c("./tier").DasTier;s=c("./utils");var N=s.Awaited,P=s.arrayIndexOf,x=s.shallowCopy,H=s.resolveUrlToPage;s=c("./das");
var D=s.DASStylesheet,f=s.DASStyle,z=s.DASSource,B=s.DASSegment,K=s.DASFeature,w=s.DASSequence,J=s.DASLink;s=c("./bin");var A=s.URLFetchable,I=s.BlobFetchable,m=c("./twoBit").makeTwoBit,F=c("./bigwig").makeBwg;s=c("./bam");var S=s.makeBam,G=s.BamFlags;s=c("./spans");var Q=s.Range,V=s.union,Z=c("./cigar").parseCigar,ja=c("./overlay").OverlayFeatureSource,T=c("./jbjson").JBrowseStore,ca=c("./chainset").Chainset;c("./style");var X=c("./encode").EncodeFetchable}var ka={},ga={};E.prototype.initSources=
function(){var a=this,b=this.browser.createSources(this.dasSource);this.featureSource=b.features||new t;this.sequenceSource=b.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};L.prototype.createSources=function(f){var d=this.sourceCache.get(f);if(d)return d;var c,m;if("sequence"==f.tier_type||f.twoBitURI||f.twoBitBlob)m=f.twoBitURI||f.twoBitBlob?new b(f):new y(f);else if(f.tier_type&&ka[f.tier_type])m=(0,ka[f.tier_type])(f),
c=m.features,m=m.sequence;else if(f.bwgURI||f.bwgBlob)c=(c=this.getWorker())?new n(f,c):new a(f);else if(f.bamURI||f.bamBlob)c=(c=this.getWorker())?new g(f,c):new k(f);else if(f.jbURI)c=new R(f);else if(f.uri||f.features_uri)c=new q(f);if(f.overlay){d=[];c&&d.push(new h(c));for(c=0;c<f.overlay.length;++c){var l=this.createSources(f.overlay[c]);l&&l.features&&d.push(l.features)}c=new ja(d,f)}f.sequenceAliases&&(c=new e(c,new ca({type:"alias",sequenceAliases:f.sequenceAliases})));f.mapping&&(c=new e(c,
this.chains[f.mapping]));f.name&&c&&!c.name&&(c.name=f.name);null!=c&&(c=new h(c));if(null!=c||null!=m)d={features:c,sequence:m},this.sourceCache.put(f,d);return d};E.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new q(this.dasSource):this.getSource()).getStyleSheet(a)};
var la=0;h.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};h.prototype.search=function(a,b){if(this.source.search)return this.source.search(a,b)};h.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};h.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};h.prototype.getScales=function(){return this.source.getScales()};h.prototype.addActivityListener=
function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};h.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};h.prototype.findNextFeature=function(a,b,f,e){this.source.findNextFeature(a,b,f,e)};h.prototype.quantFindNextFeature=function(a,b,f,e,d){this.source.quantFindNextFeature(a,b,f,e,d)};h.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};h.prototype.fetch=function(a,b,f,
e,d,g,c,k){if(!g)throw Error("Fetch pool is null");var m=this,h=this.cfsid,l=g.awaitedFeatures[h];if(l&&l.started){if(l.styleFilters.doesNotContain(k)){m.source.fetch(a,b,f,e,d,g,c,k);return}}else l?l.styleFilters.addAll(k):(l=new N,l.styleFilters=k,g.awaitedFeatures[h]=l,g.requestsIssued.then(function(){l.started=!0;m.source.fetch(a,b,f,e,l.styleFilters.typeList(),g,function(a,b,f,e){l.res||l.provide({status:a,features:b,scale:f,coverage:e})},l.styleFilters)}).catch(function(a){console.log(a)}));
l.await(function(a){c(a.status,a.features,a.scale,a.coverage)})};v.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};v.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(b){console.log(b)}};v.prototype.addActivityListener=function(a){this.activityListeners.push(a)};v.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
v.prototype.getScales=function(){return null};v.prototype.fetch=function(a,b,f,e,d,g,c){return c(null,[],1E9)};v.prototype.getStyleSheet=function(a){var b=new D,e=new f;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};q.prototype.addActivityListener=function(a){this.activityListeners.push(a)};q.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};q.prototype.getStyleSheet=
function(a){this.dasSource.stylesheet(function(b){a(b)},function(){a(null,"Couldn't fetch DAS stylesheet")})};q.prototype.fetch=function(a,b,f,e,d,g,c){if(d&&0==d.length)c(null,[],e);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return c(null,this.cachedStaticFeatures,this.cachedStaticScale);var k=!1!==this.dasSource.maxbins;d={type:d};k&&(d.maxbins=1+((f-b)/e|0));var m=this;m.busy++;m.notifyActivity();this.dasSource.features(new B(a,
b,f),d,function(a,b){m.busy--;m.notifyActivity();var f=e;k||(f=0.1);!b&&m.dasSource.dasStaticFeatures&&(m.cachedStaticFeatures=a,m.cachedStaticScale=f);c(b,a,f)})}};q.prototype.findNextFeature=this.sourceFindNextFeature=function(a,b,f,e){if(this.dasSource.capabilities&&0<=P(this.dasSource.capabilities,"das1:adjacent-feature")){var d=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(b|0)+":"+(0<f?"F":"B")};if(b=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
b;thisTier.dasSource.features(null,a,function(a){d.dasAdjLock=!1;0<a.length&&null!=a[0]&&e(a[0])})}};y.prototype.fetch=function(a,b,f,e,d){this.dasSource.sequence(new B(a,b,f),function(a){return 1==a.length?d(null,a[0]):d("Didn't get sequence")})};y.prototype.getSeqInfo=function(a,b){this.awaitedEntryPoints.await(function(f){for(var e=0;e<f.length;++e)if(f[e].name==a)return b({length:f[e].end});return b()})};b.prototype.fetch=function(a,b,f,e,d){this.twoBit.await(function(e){e.fetch(a,b,f,function(e,
g){if(g)return d(g,null);var c=new w(a,b,f,"DNA",e);return d(null,c)})})};b.prototype.getSeqInfo=function(a,b){this.twoBit.await(function(f){f.getSeq(a)?f.getSeq(a).length(function(a){b({length:a})}):b()})};q.prototype.getScales=function(){return[]};var ea={};a.prototype=Object.create(v.prototype);a.prototype.init=function(){var a=this,b;b=(b=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===this.bwgSource.transport?new X(b,{credentials:this.opts.credentials}):new A(b,{credentials:this.opts.credentials}):
new I(this.bwgSource.bwgBlob);F(b,function(b,f){f?(a.error=f,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(b),a.readiness=null,a.notifyReadiness(),"bigbed"==b.type&&b.getExtraIndices(function(b){a.extraIndices=b}))})};a.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var b=0;b<this.extraIndices.length;++b)a.search.push(this.extraIndices[b].field)}return a};
a.prototype.fetch=function(a,b,f,e,d,g,c){var k=this;this.bwgHolder.await(function(g){if(null==g)return c(k.error||"Can't access binary file",null,null);var m;m=!d||0==d.length||0<=P(d,"density");k.opts.clientBin&&(m=!1);if("bigwig"==g.type||m||"undefined"!==typeof k.opts.forceReduction){m=-1;for(var h=0;h<g.zoomLevels.length;++h)if(g.zoomLevels[h].reduction<=e)m=h;else break;"undefined"!==typeof k.opts.forceReduction&&(m=k.opts.forceReduction);m=0>m?g.getUnzoomedView():g.getZoomedView(m)}else m=
g.getUnzoomedView();k.busy++;k.notifyActivity();m.readWigData(a,b,f,function(a){k.busy--;k.notifyActivity();var e=1E9;if("bigwig"===g.type){var d=(f-b)/a.length/2;d<e&&(e=d)}if(k.opts.link)for(d=0;d<a.length;++d){var m=a[d];m.label&&(m.links=[new J("Link",k.opts.link.replace(/\$\$/,m.label))])}c(null,a,e)})})};a.prototype.quantFindNextFeature=function(a,b,f,e,d){var g=this;g.busy++;g.notifyActivity();this.bwgHolder.res.thresholdSearch(a,b,f,e,function(a,b){g.busy--;g.notifyActivity();return d(a,b)})};
a.prototype.findNextFeature=function(a,b,f,e){var d=this;d.busy++;d.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,b,f,function(a){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};a.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var b=[1],f=0;f<a.zoomLevels.length;++f)b.push(a.zoomLevels[f].reduction);return b}return null};a.prototype.search=function(a,b){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,
b):b(null,"No indices available")};a.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(b){b&&b.schema&&b.definedFieldCount<b.schema.fields.length&&a(function(a,f){for(var e=0;e<f.hit.length;++e)if(f.hit[e].isSuperGroup)return;for(e=b.definedFieldCount;e<b.schema.fields.length;++e){var d=b.schema.fields[e];f.add(d.comment,a[d.name])}})})};a.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");
var e=new D;if("bigbed"==b.type){var d=new f;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;e.pushStyle({type:"bigwig"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;e.pushStyle({type:"translation"},null,d);d=new f;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;e.pushStyle({type:"transcript"},null,d);d=new f;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";
d.HEIGHT=30;e.pushStyle({type:"density"},null,d)}else d=new f,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,e.pushStyle({type:"default"},null,d);12==b.definedFieldCount&&14<=b.fieldCount&&(e.geneHint=!0);return a(e)})};n.prototype=Object.create(v.prototype);n.prototype.init=function(){var a=this,b=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,f=this.bwgSource.blob||this.bwgSource.bwgBlob,e=function(b,f){a.readiness=null;a.notifyReadiness();b?a.worker.postCommand({command:"meta",
connection:b},function(f,e){e?(a.error=e,a.keyHolder.provide(null)):(a.meta=f,a.keyHolder.provide(b))}):(a.error=f,a.keyHolder.provide(null))};f?this.worker.postCommand({command:"connectBBI",blob:f},e):this.worker.postCommand({command:"connectBBI",uri:H(b),transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},e)};n.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=
[];for(var b=0;b<this.meta.extraIndices.length;++b)a.search.push(this.meta.extraIndices[b].field)}return a};n.prototype.fetch=function(a,b,f,e,d,g,c){var k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(g){if(!g)return k.busy--,k.notifyActivity(),c(k.error||"Can't access binary file",null,null);var m=-1,h=!d||0==d.length||0<=P(d,"density");k.opts.clientBin&&(h=!1);if("bigwig"==k.meta.type||h||"undefined"!==typeof k.opts.forceReduction){for(h=1;h<k.meta.zoomLevels.length;++h)if(k.meta.zoomLevels[h]<=
e)m=h-1;else break;"undefined"!==typeof k.opts.forceReduction&&(m=k.opts.forceReduction)}k.worker.postCommand({command:"fetch",connection:g,chr:a,min:b,max:f,zoom:m},function(a,e){k.busy--;k.notifyActivity();var d=1E9;if("bigwig"===k.meta.type){var g=(f-b)/a.length/2;g<d&&(d=g)}if(k.opts.link)for(g=0;g<a.length;++g){var m=a[g];m.label&&(m.links=[new J("Link",k.opts.link.replace(/\$\$/,m.label))])}c(e,a,d)})})};n.prototype.quantFindNextFeature=function(a,b,f,e,d){var g=this;this.busy++;this.notifyActivity();
this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:b,dir:f,threshold:e,under:!1},function(a,b){console.log(a,b);g.busy--;g.notifyActivity();return d(a,b)})};n.prototype.findNextFeature=function(a,b,f,e){var d=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:b,dir:f},function(a,b){d.busy--;d.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};n.prototype.getScales=function(){var a=this.meta;return a?
a.zoomLevels:null};n.prototype.search=function(a,b){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return b(null,"No indices available");var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,e){f.busy--;f.notifyActivity();b(a,e)})};n.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var b=this;this.keyHolder.await(function(f){var e=b.meta;e&&
e.schema&&e.definedFieldCount<e.schema.fields.length&&a(function(a,b){for(var f=0;f<b.hit.length;++f)if(b.hit[f].isSuperGroup)return;for(f=e.definedFieldCount;f<e.schema.fields.length;++f){var d=e.schema.fields[f];b.add(d.comment,a[d.name])}})})};n.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(e){e=b.meta;if(!e)return a(null,"bbi error");var d=new D;if("bigbed"==e.type){var g=new f;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="blue";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=
20;d.pushStyle({type:"bigwig"},null,g);g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=10;g.BUMP=!0;g.ZINDEX=20;d.pushStyle({type:"translation"},null,g);g=new f;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="white";g.HEIGHT=10;g.ZINDEX=10;g.BUMP=!0;g.LABEL=!0;d.pushStyle({type:"transcript"},null,g);g=new f;g.glyph="HISTOGRAM";g.COLOR1="white";g.COLOR2="black";g.HEIGHT=30;d.pushStyle({type:"density"},null,g)}else g=new f,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,d.pushStyle({type:"default"},
null,g);12==e.definedFieldCount&&14<=e.fieldCount&&(d.geneHint=!0);return a(d)})};k.prototype=Object.create(v.prototype);k.prototype.init=function(){var a=this,b,f;this.bamSource.bamBlob?(b=new I(this.bamSource.bamBlob),f=new I(this.bamSource.baiBlob)):(b=new A(this.bamSource.bamURI,{credentials:this.opts.credentials}),f=new A(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));S(b,f,null,function(b,f){a.readiness=null;a.notifyReadiness();b?a.bamHolder.provide(b):
(a.error=f,a.bamHolder.provide(null))})};k.prototype.fetch=function(a,b,f,e,g,c,k){var m=g&&1==g.length&&"density"==g[0],h=this;h.busy++;h.notifyActivity();this.bamHolder.await(function(e){if(!e)return h.busy--,h.notifyActivity(),k(h.error||"Couldn't fetch BAM");e.fetch(a,b,f,function(a,b){h.busy--;h.notifyActivity();if(b)k(b,null,null);else{for(var f=[],e=0;e<a.length;++e){var g=d(a[e],h.opts.bamGroup);g&&f.push(g)}k(null,f,1E9)}},{light:m})})};k.prototype.getScales=function(){return 1E9};k.prototype.getStyleSheet=
function(a){this.bamHolder.await(function(b){b=new D;var e=new f;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2="red";e.HEIGHT=30;b.pushStyle({type:"density"},"low",e);b.pushStyle({type:"density"},"medium",e);e=new f;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};g.prototype=Object.create(v.prototype);g.prototype.init=function(){var a=this,b=this.bamSource.uri||this.bamSource.bamURI,f=this.bamSource.indexUri||
this.bamSource.baiURI||b+".bai",e=this.bamSource.bamBlob||this.bamSource.blob,d=this.bamSource.baiBlob||this.bamSource.indexBlob,g=function(b,f){a.readiness=null;a.notifyReadiness();b?a.keyHolder.provide(b):(a.error=f,a.keyHolder.provide(null))};e?this.worker.postCommand({command:"connectBAM",blob:e,indexBlob:d},g):this.worker.postCommand({command:"connectBAM",uri:H(b),indexUri:H(f),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},g)};g.prototype.fetch=function(a,b,f,
e,g,c,k){var m=g&&1==g.length&&"density"==g[0],h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(e){if(!e)return h.busy--,h.notifyActivity(),k(h.error||"Couldn't fetch BAM");h.worker.postCommand({command:"fetch",connection:e,chr:a,min:b,max:f,opts:{light:m}},function(a,b){h.busy--;h.notifyActivity();if(b)k(b,null,null);else{for(var f=[],e=0;e<a.length;++e){var g=d(a[e],h.opts.bamGroup);g&&f.push(g)}k(null,f,1E9)}})})};g.prototype.getScales=function(){return 1E9};g.prototype.getStyleSheet=
function(a){this.keyHolder.await(function(b){b=new D;var e=new f;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2="red";e.HEIGHT=30;b.pushStyle({type:"density"},"low",e);b.pushStyle({type:"density"},"medium",e);e=new f;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};e.prototype.addActivityListener=function(a){this.activityListeners.push(a)};e.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(b){console.log(b)}};
e.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};e.prototype.getScales=function(){return this.source.getScales()};e.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};e.prototype.simplifySegments=function(a,b){if(0==a.length)return a;a.sort(function(a,b){var f=a.name-b.name;return f?f:(f=a.start-b.start)?f:a.end-b.end});for(var f=[],e=a[0],d=0;d<a.length;++d){var g=a[d];g.name!=e.name||g.start>e.end+b?(f.push(e),e=g):
e=new B(e.name,Math.min(e.start,g.start),Math.max(e.end,g.end))}f.push(e);return f};e.prototype.fetch=function(a,b,f,e,d,g,c,k){var m=this,h=f-b+1;m.busy++;m.notifyActivity();this.mapping.sourceBlocksForRange(a,b,f,function(a){if(0==a.length)m.busy--,m.notifyActivity(),c("No mapping available for this regions",[],e);else{a=m.simplifySegments(a,Math.max(100,0.05*h));var b=[],f=null,l=a.length,n;a.map(function(a){m.source.fetch(a.name,a.start,a.end,e,d,g,function(e,d,g){e&&!n&&(n=e);if(d)for(e=0;e<
d.length;++e){var k=d[e],h=k.segment;0==h.indexOf("chr")&&(h=h.substr(3));h=m.mapping.mapSegment(h,k.min,k.max);if(0==h.length)k.parts&&0<k.parts.length&&b.push(k);else for(var r=0;r<h.length;++r){var t=h[r],q=x(k);q.segment=t.segment;q.min=t.min;q.max=t.max;t.partialMin&&(q.partialMin=t.partialMin);t.partialMax&&(q.partialMax=t.partialMax);t.flipped&&("-"==k.orientation?q.orientation="+":"+"==k.orientation&&(q.orientation="-"));b.push(q)}}d=m.mapping.mapPoint(a.name,a.start);e=m.mapping.mapPoint(a.name,
a.end);d&&e&&(d=new Q(d.pos,e.pos),f=f?V(f,d):d);--l;0==l&&(m.busy--,m.notifyActivity(),c(n,b,g,f))},k)})}})};t.prototype.getScales=function(){return null};t.prototype.fetch=function(a,b,f,e,d,g,c){return c(null,[],1E9)};t.prototype.getStyleSheet=function(a){var b=new D,e=new f;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};C.prototype.fetch=function(a,b,f,e,d){return d(null,null)};R.prototype.getScales=function(){return null};R.prototype.getStyleSheet=
function(a){var b=new D,e=new f;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="green";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;b.pushStyle({type:"default"},null,e);return a(b)};R.prototype.fetch=function(a,b,f,e,d,g,c){d&&0==d.length?c(null,[],e):this.store.features(new B(a,b,f),{},function(a,b){c(b,a,1E5)})};L.prototype.sourceAdapterIsCapable=function(a,b){return a.capabilities?a.capabilities()[b]:!1};"undefined"!==typeof u&&(u.exports={FeatureSourceBase:v,TwoBitSequenceSource:b,DASSequenceSource:y,
MappedFeatureSource:e,CachingFeatureSource:h,BWGFeatureSource:a,RemoteBWGFeatureSource:n,BAMFeatureSource:k,RemoteBAMFeatureSource:g,DummyFeatureSource:t,DummySequenceSource:C,registerSourceAdapterFactory:l,registerParserFactory:p,makeParser:r},c("./ensembljson"),c("./tabix-source"),c("./memstore"),c("./bedwig"),c("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,
"./spans":35,"./style":36,"./tabix-source":39,"./tier":44,"./twoBit":49,"./utils":50,"./vcf":51}],35:[function(c,u,s){function l(b,a){if("number"!=typeof b||"number"!=typeof a)throw"Bad range "+b+","+a;this._min=b;this._max=a}function p(b){this._ranges=b}function r(b,a){b instanceof Array||(b=[b],a&&b.push(a));if(0==b.length)return null;if(1==b.length)return b[0];for(var c=[],d=0;d<b.length;++d)b[d]._pushRanges(c);for(var c=c.sort(y),d=[],k=c[0],k=new l(k._min,k._max),g=1;g<c.length;++g){var e=c[g];
e._min>k._max+1?(d.push(k),k=new l(e._min,e._max)):e._max>k._max&&(k._max=e._max)}d.push(k);return 1==d.length?d[0]:new p(d)}function h(b,a){for(var c=b.ranges(),d=a.ranges(),k=c.length,g=d.length,e=0,h=0,r=[];e<k&&h<g;){b=c[e];a=d[h];var q=Math.max(b.min(),a.min()),s=Math.min(b.max(),a.max());s>=q&&r.push(new l(q,s));b.max()>a.max()?++h:++e}return 0==r.length?null:1==r.length?r[0]:new p(r)}function v(b){var a=0;b=b.ranges();for(var c=0;c<b.length;++c)var d=b[c],a=a+(d.max()-d.min()+1);return a}function q(b,
a){return b.min()<a.min()?-1:b.min()>a.min()?1:b.max()<a.max()?-1:a.max()>b.max()?1:0}function y(b,a){return b._min<a._min?-1:b._min>a._min?1:b._max<a._max?-1:a._max>b._max?1:0}l.prototype.min=function(){return this._min};l.prototype.max=function(){return this._max};l.prototype.contains=function(b){return b>=this._min&&b<=this._max};l.prototype.isContiguous=function(){return!0};l.prototype.ranges=function(){return[this]};l.prototype._pushRanges=function(b){b.push(this)};l.prototype.toString=function(){return"["+
this._min+"-"+this._max+"]"};p.prototype.min=function(){return this._ranges[0].min()};p.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};p.prototype.contains=function(b){for(var a=0;a<this._ranges.length;++a)if(this._ranges[a].contains(b))return!0;return!1};p.prototype.isContiguous=function(){return 1<this._ranges.length};p.prototype.ranges=function(){return this._ranges};p.prototype._pushRanges=function(b){for(var a=0;a<this._ranges.length;++a)b.push(this._ranges[a])};p.prototype.toString=
function(){for(var b="",a=0;a<this._ranges.length;++a)0<a&&(b+=","),b+=this._ranges[a].toString();return b};"undefined"!==typeof u&&(u.exports={Range:l,union:r,intersection:h,coverage:v,rangeOver:q,_rangeOrder:y})},{}],36:[function(c,u,s){function l(c,h,l){this.type=c;this.method=h;this.label=l}function p(c){this._filters={};if(c)for(var h=0;h<c.length;++h)this.add(c[h])}l.prototype.equals=function(c){return this.type==c.type&&this.method==c.method&&this.label==c.label};l.prototype.toString=function(){var c=
[];this.type&&c.push("type="+this.type);this.method&&c.push("method="+this.method);this.label&&c.push("label="+this.label);return"StyleFilter<"+c.join(";")+">"};p.prototype.add=function(c){var h=c.toString();this._filters[h]||(this._filters[h]=c,this._list=null)};p.prototype.addAll=function(c){c=c.list();for(var h=0;h<c.length;++h)this.add(c[h])};p.prototype.doesNotContain=function(c){c=c.list();for(var h=0;h<c.length;++h)if(!this._filters[h.toString()])return!0;return!1};p.prototype.list=function(){if(!this._list){this._list=
[];for(var c in this._filters)this._filters.hasOwnProperty(c)&&this._list.push(this._filters[c])}return this._list};p.prototype.typeList=function(){for(var c=[],h=this.list(),l=0;l<h.length;++l){var q=h[l].type;if(!q||"default"==q)return null;0>c.indexOf(q)&&c.push(q)}return c};"undefined"!==typeof u&&(u.exports={StyleFilter:l,StyleFilterSet:p})},{}],37:[function(c,u,s){if("undefined"!==typeof c){var l=c("./cbrowser").Browser,p=c("./utils").makeElementNS,r=c("./version"),h=c("./sequence-draw").svgSeqTier;
u=c("./svg-utils");var v=u.NS_SVG,q=u.NS_XLINK,y=u.SVGPath,b=c("./numformats").formatQuantLabel}l.prototype.makeSVG=function(a){a=a||{};var c=a.minTierHeight||20,d=document.implementation.createDocument(v,"svg",null),k=p(v,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});d.documentElement.appendChild(k);var g=p(v,"a",p(v,"text","Graphics from Dalliance "+r,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));g.setAttribute("xmlns:xlink",q);g.setAttribute("xlink:href",
"http://www.biodalliance.org/");k.appendChild(g);g=p(v,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});g=p(v,"clipPath",g,{id:"featureClip"});k.appendChild(g);for(var g=70,e=p(v,"g",null,{}),l=0;l<this.tiers.length;++l){var C=this.tiers[l],s=p(v,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),u=p(v,"g"),E=g,N=p(v,"rect",null,{x:0,y:E,width:"10000",height:50,fill:C.background});s.appendChild(N);if(C.sequenceSource){var P=h(C,C.currentSequence);s.appendChild(p(v,"g",P,
{transform:"translate(200, "+g+")"}));g+=80}else{if(!C.subtiers)continue;for(var P=(C.glyphCacheOrigin-this.viewStart)*this.scale,x=!1,H=0;H<C.subtiers.length;++H){for(var g=g+3,D=C.subtiers[H],f=[],z=0;z<D.glyphs.length;++z)f.push(D.glyphs[z].toSVG());s.appendChild(p(v,"g",f,{transform:"translate("+(200+P)+", "+g+")"}));if(D.quant){var x=!0,f=D.quant,B=D.height,z=2;40<B&&(z=1+(B/20|0));var B=B/(z-1),K=(f.max-f.min)/(z-1),w=new y;w.moveTo(205,g);w.lineTo(200,g);w.lineTo(200,g+D.height);w.lineTo(205,
g+D.height);for(var J=1;J<z-1;++J){var A=J*B;w.moveTo(200,g+A);w.lineTo(203,g+A)}u.appendChild(p(v,"path",null,{d:w.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));u.appendChild(p(v,"text",b(f.max),{x:197,y:g+7,textAnchor:"end"}));u.appendChild(p(v,"text",b(f.min),{x:197,y:g+D.height,textAnchor:"end"}));for(J=1;J<z-1;++J)A=J*B,u.appendChild(p(v,"text",b(1*f.max-J*K),{x:197,y:g+A+3,textAnchor:"end"}))}g+=D.height+3}g-E<c&&(g=E+c)}u.appendChild(p(v,"text","string"===typeof C.config.name?
C.config.name:C.dasSource.name,{x:200-(x?20:12),y:(g+E+8)/2,fontSize:"10pt",textAnchor:"end"}));N.setAttribute("height",g-E);e.appendChild(p(v,"g",[s,u]))}if(a.highlights)for(c=this.highlights||[],x=0;x<c.length;++x)B=c[x],(B.chr==this.chr||B.chr=="chr"+this.chr)&&B.min<this.viewEnd&&B.max>this.viewStart&&(l=(Math.max(B.min,this.viewStart)-this.viewStart)*this.scale,C=(Math.min(B.max,this.viewEnd)-this.viewStart)*this.scale,e.appendChild(p(v,"rect",null,{x:200+l,y:70,width:C-l,height:g-70,stroke:"none",
fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));c=-1;"center"==a.ruler?c=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?c=200:"right"==a.ruler&&(c=200+(this.viewEnd-this.viewStart)*this.scale);0<=c&&e.appendChild(p(v,"line",null,{x1:c,y1:70,x2:c,y2:g,stroke:"blue"}));k.appendChild(e);d.documentElement.setAttribute("width",this.featurePanelWidth+20+200);d.documentElement.setAttribute("height",g+50);return new Blob([(new XMLSerializer).serializeToString(d)],
{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":38,"./utils":50,"./version":52}],38:[function(c,u,s){function l(){this.ops=[]}l.prototype.moveTo=function(c,l){this.ops.push("M "+c+" "+l)};l.prototype.lineTo=function(c,l){this.ops.push("L "+c+" "+l)};l.prototype.closePath=function(){this.ops.push("Z")};l.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof u&&(u.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",
SVGPath:l})},{}],39:[function(c,u,s){function l(a){h.call(this);this.readiness="Connecting";this.source=a;this.tabixHolder=new y;var c=this,d=r(a.payload);if(d)this.parser=d;else throw"Unsuported tabix payload "+a.payload;var k;this.source.blob?(a=new q(this.source.blob),k=new q(this.source.indexBlob)):(a=new v(this.source.uri,{credentials:this.source.credentials}),k=new v(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));b(a,k,function(a,b){c.tabixHolder.provide(a);
a.fetchHeader(function(a,b){if(a){for(var e=d.createSession(function(){}),g=0;g<a.length;++g)e.parse(a[g]);e.flush()}});c.readiness=null;c.notifyReadiness()})}if("undefined"!==typeof c){u=c("./sourceadapters");var p=u.registerSourceAdapterFactory,r=u.makeParser,h=u.FeatureSourceBase;u=c("./bin");var v=u.URLFetchable,q=u.BlobFetchable,y=c("./utils").Awaited,b=c("./tabix").connectTabix}l.prototype=Object.create(h.prototype);l.prototype.fetch=function(a,b,d,c,g,e,h){var l=this;l.busy++;l.notifyActivity();
this.tabixHolder.await(function(e){e.fetch(a,b,d,function(a,b){l.busy--;l.notifyActivity();for(var e=[],d=l.parser.createSession(function(a){e.push(a)}),g=0;g<a.length;++g)d.parse(a[g]);d.flush();h(null,e,1E9)})})};l.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};l.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};p("tabix",function(a){return{features:new l(a)}})},{"./bin":4,"./sourceadapters":34,
"./tabix":40,"./utils":50}],40:[function(c,u,s){function l(){}function p(a,b,d){var c=new l;c.data=a;c.tbi=b;c.tbi.fetch(function(a){if(!a)return d(null,"Couldn't access Tabix");a=q(a,a.byteLength);var b=new Uint8Array(a);if(h(b,0)!=r)return d(null,"Not a tabix index");var l=h(b,4);c.format=h(b,8);c.colSeq=h(b,12);c.colStart=h(b,16);c.colEnd=h(b,20);c.meta=h(b,24);c.skip=h(b,28);h(b,32);c.indices=[];var n=36;c.chrToIndex={};c.indexToChr=[];for(var p=0;p<l;++p){for(var s="";;){var E=b[n++];if(0==E)break;
s+=String.fromCharCode(E)}c.chrToIndex[s]=p;0==s.indexOf("chr")?c.chrToIndex[s.substring(3)]=p:c.chrToIndex["chr"+s]=p;c.indexToChr.push(s)}s=1E9;for(E=0;E<l;++E){for(var u=n,y=h(b,n),n=n+4,p=0;p<y;++p){h(b,n);var x=h(b,n+4),n=n+(8+16*x)}for(var x=h(b,n),H=n+=4,p=0;p<x;++p){var D=v(b,H),H=H+8;if(D){p=D.block;0<D.offset&&(p+=65536);p<s&&(s=p);break}}n+=8*x;0<y&&(c.indices[E]=new Uint8Array(a,u,n-u))}c.headerMax=s;d(c)})}var r=21578324;if("undefined"!==typeof c){c("./spans");var h=c("./bin").readInt;
c=c("./lh3utils");var v=c.readVob,q=c.unbgzf,y=c.reg2bins,b=c.Chunk}l.prototype.blocksForRange=function(a,c,d){var k=this.indices[a];if(!k)return[];a=y(c,d);for(var g=[],e=0;e<a.length;++e)g[a[e]]=!0;a=[];for(var l=[],e=h(k,0),q=4,r=0;r<e;++r){var p=h(k,q),s=h(k,q+4),q=q+8;if(g[p])for(var u=0;u<s;++u){var P=v(k,q),x=v(k,q+8);(4681>p?l:a).push(new b(P,x));q+=16}else q+=16*s}e=h(k,q);g=null;c=Math.min(c>>14,e-1);d=Math.min(d>>14,e-1);for(e=c;e<=d;++e)(c=v(k,q+4+8*e))&&(!g||c.block<g.block||c.offset<
g.offset)&&(g=c);k=[];if(null!=g)for(e=0;e<l.length;++e)d=l[e],d.maxv.block>=g.block&&d.maxv.offset>=g.offset&&k.push(d);l=k;k=[];for(e=0;e<l.length;++e)k.push(l[e]);for(e=0;e<a.length;++e)k.push(a[e]);k.sort(function(a,b){var f=a.minv.block-b.minv.block;return 0!=f?f:a.minv.offset-b.minv.offset});a=[];if(0<k.length){l=k[0];for(e=1;e<k.length;++e)d=k[e],d.minv.block==l.maxv.block?l=new b(l.minv,d.maxv):(a.push(l),l=d);a.push(l)}return a};l.prototype.fetch=function(a,b,d,c){function g(){if(p>=l.length)return c(r);
if(s){var a=new Uint8Array(s);e.readRecords(a,l[p].minv.offset,r,b,d,h);s=null;++p;return g()}var u=l[p],a=u.minv.block;e.data.slice(a,u.maxv.block+65536-a).fetch(function(a){s=q(a,u.maxv.block-u.minv.block+1);return g()})}var e=this;a=this.chrToIndex[a];if(void 0==a)return c([]);var h=this.indexToChr[a],l;void 0===a?l=[]:(l=this.blocksForRange(a,b,d))||c(null,"Error in index fetch");var r=[],p=0,s;g()};l.prototype.readRecords=function(a,b,d,c,g,e){a:for(;;){for(var h="";b<a.length;){var l=a[b++];
if(10==l){l=h.split("\t");if(l[this.colSeq-1]==e){var q=parseInt(l[this.colStart-1]),r=q;0<this.colEnd&&(r=parseInt(l[this.colEnd-1]));this.format&65536&&++q;q<=g&&r>=c&&d.push(h)}continue a}else h+=String.fromCharCode(l)}break}};l.prototype.fetchHeader=function(a){var b=this;b.data.slice(0,b.headerMax).fetch(function(d){if(!d)return a(null,"Fetch failed");d=new Uint8Array(q(d,d.byteLength));for(var c=0,g="",e=[];c<d.length;){var h=d[c++];if(10==h)if(g.charCodeAt(0)==b.meta)e.push(g),g="";else return a(e);
else g+=String.fromCharCode(h)}a(e)})};"undefined"!==typeof u&&(u.exports={connectTabix:p,TABIX_MAGIC:r})},{"./bin":4,"./lh3utils":24,"./spans":35}],41:[function(c,u,s){function l(a){this.genomes={};this.url=a}function p(){}function r(a){this.hub=a}function h(a,b,c){c=c||{};c.salt=!0;q(a,function(g,h){if(h)return b(null,h);var n=g.split(k),p=new l(a);c.credentials&&(p.credentials=c.credentials);for(var s=0;s<n.length-2;s+=3)p[n[s+1]]=n[s+2];if(p.genomesFile){var x=y(a,p.genomesFile);q(x,function(a,
e){if(e)return b(null,e);for(var f=a.split(d),g=0;g<f.length;++g){var h=f[g].split(k),l=new r(p);c.credentials&&(l.credentials=c.credentials);for(var n=0;n<h.length-2;n+=3)l[h[n+1]]=h[n+2];l.twoBitPath&&(l.twoBitPath=y(x,l.twoBitPath));l.genome&&l.trackDb&&(l.absURL=y(x,l.trackDb),p.genomes[l.genome]=l)}b(p)},c)}else b(null,"No genomesFile")},c)}function v(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==
typeof c){s=c("./utils");var q=s.textXHR,y=s.relativeURL,b=s.shallowCopy;c=c("./das");var a=c.DASStylesheet,n=c.DASStyle}var d=/\n\s*\n/,k=/(\w+) +(.+)\n?/,g=/subGroup[1-9]/;p.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};r.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);q(this.absURL,function(c,h){if(h)return a(null,h);c=c.replace("\\\n"," ");for(var l=[],n={},q=c.split(d),r=0;r<q.length;++r){var s=q[r].replace(/\#.*/g,
"").split(k),u=new p;u._db=b;for(var v=0;v<s.length-2;v+=3){var f=s[v+1],z=s[v+2];if(f.match(g)){u.subgroups||(u.subgroups={});for(var f=z.split(/\s/),z=f[0],B={name:f[1],tags:[],titles:[]},K=2;K<f.length;++K){var w=f[K].split(/=/);B.tags.push(w[0]);B.titles.push(w[1])}u.subgroups[z]=B}else if("subGroups"===f)for(f=z.split(/(\w+)=(\w+)/),u.sgm={},K=0;K<f.length-2;K+=3)u.sgm[f[K+1]]=f[K+2];else u[s[v+1]]=s[v+2]}u.track&&(u.type||u.container||u.view||u.bigDataUrl)&&(l.push(u),n[u.track]=u)}q=[];r=[];
for(f=0;f<l.length;++f)u=l[f],s=!0,u.parent&&(v=u.parent.split(/\s+/),(z=n[v[0]])?(u._parent=z,z.children||(z.children=[]),z.children.push(u),z&&(s=!1)):console.log("Couldn't find parent "+v[0]+"("+u.parent+")")),u.compositeTrack?r.push(u):s&&q.push(u);for(l=0;l<r.length;++l)if(n=r[l],n.children){u=!1;for(s=0;s<n.children.length;++s)f=n.children[s],f.view&&(f.shortLabel=n.shortLabel+": "+f.shortLabel,q.push(f),u=!0);u||q.push(n)}b._tracks=q;return a(b._tracks,null)},{credentials:this.credentials,
salt:!0})};p.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=y(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var d=0;d<b.length;++d){var c=b[d],g=c.toDallianceSource();a.overlay.push(g);if(g.style)for(var k=
0;k<g.style.length;++k){var h=g.style[k];h.method=c.shortLabel;"transparentOverlay"==this.aggregate&&(h.style.ALPHA=0.5);a.style.push(h)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){d=b.split(/\s+/);if("bigBed"==d[0]&&this.bigDataUrl)return b=d[1]|0,d="+"==d[2],a.bwgURI=y(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&d&&(a.collapseSuperGroups=!0),a;if("bigWig"==d[0]&&this.bigDataUrl)return a.bwgURI=
y(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==d[0]&&this.bigDataUrl)return a.bamURI=y(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==d[0]&&this.bigDataUrl)return a.uri=y(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=
!0),a;console.log("Unsupported "+this.type)}};p.prototype.bigwigStyles=function(){var b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){var b=b.split(/\s+/),d,c;3<=b.length&&(d=1*b[1],c=1*b[2]);var g;this.maxHeightPixels&&(b=this.maxHeightPixels.split(/:/),3==b.length?g=b[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));b="bars";this.graphTypeDefault&&(b=this.graphTypeDefault);var k="black",h=null;this.color&&(k="rgb("+this.color+")");this.altColor&&
(h="rgb("+this.altColor+")");var l=new a,q=new n;q.glyph="points"==b?"POINT":"HISTOGRAM";h?(q.COLOR1=k,q.COLOR2=h):q.BGCOLOR=k;q.HEIGHT=g||30;if(d||c)q.MIN=d,q.MAX=c;l.pushStyle({type:"default"},null,q);return l.styles}};p.prototype.bigbedStyles=function(){var e="on"==(""+this.get("itemRgb")).toLowerCase(),d=this.get("visibility")||"full",c=this.get("color"),c=c?"rgb("+c+")":"blue",g=new a,k=new n;k.glyph="BOX";k.FGCOLOR="black";k.BGCOLOR=c;k.HEIGHT="full"==d||"pack"==d?12:8;k.BUMP="full"==d||"pack"==
d;k.LABEL="full"==d||"pack"==d;k.ZINDEX=20;e&&(k.BGITEM=!0);(d=this.get("colorByStrand"))?(d=d.split(/\s+/),c=b(k),c.BGCOLOR="rgb("+d[0]+")",g.pushStyle({type:"bigwig",orientation:"+"},null,c),k=b(k),k.BGCOLOR="rgb("+d[1]+")",g.pushStyle({type:"bigwig",orientation:"-"},null,k)):g.pushStyle({type:"bigwig"},null,k);k=new n;k.glyph="BOX";k.FGCOLOR="black";e&&(k.BGITEM=!0);k.BGCOLOR="red";k.HEIGHT=10;k.BUMP=!0;k.ZINDEX=20;g.pushStyle({type:"translation"},null,k);e=new n;e.glyph="BOX";e.FGCOLOR="black";
e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;g.pushStyle({type:"transcript"},null,e);return g.styles};"undefined"!==typeof u&&(u.exports={connectTrackHub:h,THUB_COMPARE:v})},{"./das":10,"./utils":50}],42:[function(c,u,s){if("undefined"!==typeof c)var l=c("./cbrowser").Browser,p=c("./utils").shallowCopy;l.prototype.mergeSelectedTiers=function(){for(var c=[],h=[],l=0;l<this.selectedTiers.length;++l){var q=this.tiers[this.selectedTiers[l]];c.push(p(q.dasSource));for(var s=q.stylesheet.styles,
b=0;b<s.length;++b){var a=s[b],n=p(a);n.method=q.dasSource.name.replace(/[()+*?]/g,"\\$&");n._methodRE=null;n.style=p(a.style);void 0===n.style.ZINDEX&&(n.style.ZINDEX=l);q.forceMin&&(n.style.MIN=q.forceMin);q.forceMax&&(n.style.MAX=q.forceMax);h.push(n)}}this.addTier({name:"Merged",merge:"concat",overlay:c,noDownsample:!0,style:h});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":50}],43:[function(c,u,s){function l(b){for(var a=0;a<b.styles.length;++a){var c=b.styles[a].style;
if("__SEQUENCE"===c.glyph)return c}}if("undefined"!==typeof c){var p=c("./cbrowser").Browser,r=c("./utils").makeElement;u=c("./das");var h=u.isDasBooleanTrue,v=u.copyStylesheet,q=c("./color").dasColourForName}var y={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};p.prototype.openTierPanel=function(b){if("tier"===this.uiMode&&this.manipulatingTier===b)this.hideToolPanel(),this.setUiMode("none");else{var a=function(a){a.BGGRAD||(1==z?("LINEPLOT"==a.glyph||y[a.glyph]?a.FGCOLOR=L.value:
a.BGCOLOR=L.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=L.value,a.COLOR2=E.value,a.COLOR3=2<z?N.value:null),a._gradient=null,a._plusColor=P.value,a._minusColor=x.value)},c=function(a){for(var f=v(b.stylesheet),e=b.browser.zoomForCurrentScale(),d=0;d<f.styles.length;++d){var c=f.styles[d];c.zoom&&c.zoom!=e||a(c.style)}return f},d=function(f){b.mergeStylesheet(c(a))};this.manipulatingTier=b;var k=r("div",null,{className:"tier-edit"});if(b.dasSource.mapping){var g=this.chains[b.dasSource.mapping].coords;
k.appendChild(r("div","Mapped from "+g.auth+g.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var e=r("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});k.appendChild(e);var p=r("input",null,{type:"text"}),s=r("input",null,{type:"checkbox",disabled:this.disablePinning}),u=r("select");u.appendChild(r("option","Histogram",{value:"HISTOGRAM"}));u.appendChild(r("option",
"Line Plot",{value:"LINEPLOT"}));u.appendChild(r("option","Ribbon",{value:"GRADIENT"}));u.appendChild(r("option","Scatter",{value:"SCATTER"}));var L=r("input",null,{type:"text",value:"#dd00dd"}),E=r("input",null,{type:"text",value:"#dd00dd"}),N=r("input",null,{type:"text",value:"#dd00dd"}),P=r("input",null,{type:"text",value:"#ffa07a"}),x=r("input",null,{type:"text",value:"#87cefa"});try{L.type=E.type=N.type="color",P.type=x.type="color"}catch(H){}var D=[L,E,N],g=r("i",null,{className:"fa fa-plus-circle"}),
f=r("i",null,{className:"fa fa-minus-circle"}),z=1,B=r("td",D),K=function(a){z=a;for(var b=0;b<a;++b)D[b].style.display="block";for(b=a;b<D.length;++b)D[b].style.display="none"};g.addEventListener("click",function(a){3>z&&(K(z+1),d(null))},!1);f.addEventListener("click",function(a){1<z&&(K(z-1),d(null))},!1);var w=r("input",null,{type:"text",value:"0.0"}),J=r("input",null,{type:"text",value:"10.0"}),A=r("input",null,{type:"checkbox"}),I=r("input",null,{type:"checkbox"}),m=r("input",null,{type:"checkbox",
checked:void 0!==b.quantLeapThreshold}),F=r("input",null,{type:"text",value:b.quantLeapThreshold,disabled:!m.checked}),S=r("input",null,{type:"text",value:"50"}),G=r("input",null,{type:"checkbox"}),Q=r("input",null,{type:"text"}),V=r("input",null,{type:"checkbox"}),Z=null;0<b.stylesheet.styles.length&&(Z=b.stylesheet.styles[0].style);var ja=function(){p.value="string"===typeof b.config.name?b.config.name:b.dasSource.name;s.checked=b.pinned;b.forceHeight?S.value=""+b.forceHeight:Z&&Z.HEIGHT&&(S.value=
""+Z.HEIGHT);"number"==typeof b.quantLeapThreshold?(m.checked=!0,F.disabled=!1,parseFloat(F.value)!=b.quantLeapThreshold&&(F.value=b.quantLeapThreshold)):(m.checked=!1,F.disabled=!0);Q.value="number"==typeof b.subtierMax?""+b.subtierMax:""+(b.dasSource.subtierMax||b.browser.defaultSubtierMax);if(0<b.stylesheet.styles.length){for(var a=null,f=!1,d=!1,d=b.browser.zoomForCurrentScale(),c=0,g=0;g<b.stylesheet.styles.length;++g){var k=b.stylesheet.styles[g];if(!k.zoom||k.zoom==d)if(++c,k=b.stylesheet.styles[g].style,
a||(a=Z=k),"LINEPLOT"==k.glyph||"HISTOGRAM"==k.glyph||"GRADIENT"==k.glyph||h(k.SCATTER))f||(a=Z=k),f=!0}if(!a)return;e.style.display=c==b.stylesheet.styles.length?"none":"block";d=f&&1==c;f?(ma.style.display="table-row",oa.style.display="table-row",sa.style.display="none",ta.style.display="none"):(ma.style.display="none",oa.style.display="none",sa.style.display="table-row",G.checked=h(Z.BUMP),Q.disabled=!h(Z.BUMP),ta.style.display="table-row",V.checked=h(Z.LABEL));d?(ea.style.display="table-row",
ra.style.display="table-row"):(ea.style.display="none",ra.style.display="none");c=1;a.COLOR1?(L.value=q(a.COLOR1).toHexString(),a.COLOR2&&(E.value=q(a.COLOR2).toHexString(),a.COLOR3?(N.value=q(a.COLOR3).toHexString(),c=3):c=2)):"LINEPLOT"==a.glyph||"DOT"==a.glyph&&a.FGCOLOR?L.value=q(a.FGCOLOR).toHexString():a.BGCOLOR&&(L.value=q(a.BGCOLOR).toHexString());K(c);a._plusColor&&(P.value=q(a._plusColor).toHexString()||a._plusColor);a._minusColor&&(x.value=q(a._minusColor).toHexString()||a._minusColor);
h(a.SCATTER)?u.value="SCATTER":u.value=a.glyph;var n,r;void 0!==a.MIN&&(c=parseFloat(a.MIN),isNaN(c)||(n=c));b.forceMinDynamic||void 0===a.MIN&&void 0===b.forceMin?(A.checked=!1,w.disabled=!0):(A.checked=!0,w.disabled=!1);void 0!==a.MAX&&(c=parseFloat(a.MAX),isNaN(c)||(r=c));b.forceMaxDynamic||void 0===a.MAX&&void 0===b.forceMax?(I.checked=!1,J.disabled=!0):(I.checked=!0,J.disabled=!1);void 0!=b.forceMin&&(n=b.forceMin);void 0!=b.forceMax&&(r=b.forceMax);"number"==typeof n&&n!=parseFloat(w.value)&&
(w.value=n);"number"==typeof r&&r!=parseFloat(J.value)&&(J.value=r);(a=l(b.stylesheet))?(ca.style.display="table-row",T.checked="mismatch"===a.__SEQCOLOR,ka.style.display="table-row",X.checked=h(a.__INSERTIONS),la.style.display="table-row",ga.checked=void 0===a.__disableQuals||!1===a.__disableQuals,console.log(a.__disableQuals)):(ca.style.display="none",ka.style.display="none",la.style.display="none");a&&T.checked&&!d?($.style.display="table-row",pa.style.display="table-row"):($.style.display="none",
pa.style.display="none")}f&&b.browser.sourceAdapterIsCapable(b.featureSource,"quantLeap")?fa.style.display="table-row":fa.style.display="none"},T=r("input",null,{type:"checkbox"}),ca=r("tr",[r("th","Highlight mismatches & strands"),r("td",T)]);T.addEventListener("change",function(a){a=v(b.stylesheet);l(a).__SEQCOLOR=T.checked?"mismatch":"base";b.mergeStylesheet(a)});var X=r("input",null,{type:"checkbox"}),ka=r("tr",[r("th","Show insertions"),r("td",X)]);X.addEventListener("change",function(a){a=v(b.stylesheet);
l(a).__INSERTIONS=X.checked?"yes":"no";b.mergeStylesheet(a)});var ga=r("input",null,{type:"checkbox"}),la=r("tr",[r("th","Reflect base quality as base color transparency"),r("td",ga)]);ga.addEventListener("change",function(a){a=v(b.stylesheet);var f=l(a);f.__disableQuals=!ga.checked;console.log(f.__disableQuals);b.mergeStylesheet(a)});var ea=r("tr",[r("th","Style"),r("td",u)]),ra=r("tr",[r("th",["Colour(s)",g,f]),B]),$=r("tr",[r("th","Plus Strand Color"),r("td",P)]),pa=r("tr",[r("th","Minus Strand Color"),
r("td",x)]),ma=r("tr",[r("th","Min value"),r("td",[A," ",w])]),oa=r("tr",[r("th","Max value"),r("td",[I," ",J])]),fa=r("tr",[r("th","Threshold leap:"),r("td",[m," ",F])]),sa=r("tr",[r("th","Bump overlaps"),r("td",[G," limit: ",Q])]),ta=r("tr",[r("th","Label features"),r("td",V)]),g=r("table",[r("tr",[r("th","Name",{},{width:"150px",textAlign:"right"}),p]),r("tr",[r("th","Pin to top"),s]),r("tr",[r("th","Height"),r("td",S)]),ea,ra,$,pa,ma,oa,fa,sa,ta,ca,ka,la]);ja();k.appendChild(g);g=r("button","Reset track",
{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});g.addEventListener("click",function(a){b.setConfig({})},!1);k.appendChild(g);p.addEventListener("input",function(a){b.mergeConfig({name:p.value})},!1);s.addEventListener("change",function(a){b.mergeConfig({pinned:s.checked})},!1);for(g=0;g<D.length;++g)D[g].addEventListener("change",d,!1);P.addEventListener("change",d,!1);x.addEventListener("change",d,!1);u.addEventListener("change",function(f){f=c(function(b){"SCATTER"===u.value?
(b.SCATTER=!0,b.glyph="DOT",b.SIZE="3"):(b.glyph=u.value,b.SCATTER=void 0);a(b)});b.mergeStylesheet(f)},!1);A.addEventListener("change",function(a){a={forceMinDynamic:!A.checked};w.disabled=!A.checked;var f=parseFloat(w.value);A.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMin=parseFloat(f));b.mergeConfig(a)});w.addEventListener("input",function(a){a=parseFloat(w.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMin:a})},!1);I.addEventListener("change",function(a){a={forceMaxDynamic:!I.checked};
J.disabled=!I.checked;var f=parseFloat(J.value);I.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMax=parseFloat(f));b.mergeConfig(a)});J.addEventListener("input",function(a){a=parseFloat(J.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMax:a})},!1);S.addEventListener("input",function(a){a=parseFloat(S.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({height:Math.min(500,a|0)})},!1);var U=function(){F.disabled=!m.checked;if(m.checked){var a=parseFloat(F.value);"number"!=typeof a||isNaN(a)||
b.mergeConfig({quantLeapThreshold:parseFloat(F.value)})}else b.mergeConfig({quantLeapThreshold:null})};m.addEventListener("change",function(a){U()},!1);F.addEventListener("input",function(a){U()},!1);V.addEventListener("change",function(a){a=c(function(a){a.LABEL=V.checked?"yes":"no"});b.mergeStylesheet(a)},!1);G.addEventListener("change",function(a){a=c(function(a){a.BUMP=G.checked?"yes":"no"});b.mergeStylesheet(a)},!1);Q.addEventListener("input",function(a){a=parseInt(Q.value);"number"==typeof a&&
0<a&&b.mergeConfig({subtierMax:a})},!1);this.showToolPanel(k);this.setUiMode("tier");b.addTierListener(ja);var Y=b.browser.scale;b.browser.addViewListener(function(){b.browser.scale!=Y&&(Y=b.browser.scale,ja())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":50}],44:[function(c,u,s){function l(a,b,d,c){this.config=d||{};this.id="tier"+ ++n;this.browser=a;this.dasSource=r(b);this.background=c;this.viewport=p("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},
{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=p("div",this.viewport,{className:"viewport-holder_12_5"},{background:c,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=p("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=p("div","",{className:"notifier"});this.notifierHolder=p("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=p("canvas",
null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=p("i",null,{className:"fa fa-times"});this.bumpButton=p("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=p("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=p("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(p("img",null,{src:b.pennant,width:"16",height:"16"})):
b.mapping&&(d=null,this.browser.chains[b.mapping]&&(d=this.browser.chains[b.mapping].coords.version),d&&this.nameButton.appendChild(p("span",""+d,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=p("span",b.name);this.nameButton.appendChild(p("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);
this.nameButton.appendChild(this.loaderButton);this.label=p("span",[this.nameButton],{className:"btn-group track-label"});this.row=p("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});c||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);
this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources();var k=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&k.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){k.notify(a,-1)});this.listeners=[];this.featuresLoadedListeners=
[]}if("undefined"!==typeof c){s=c("./utils");var p=s.makeElement,r=s.shallowCopy,h=s.miniJSONify;s=c("./das");var v=s.DASStylesheet,q=s.DASStyle,y=c("./sha1").b64_sha1;s=c("./style");var b=s.StyleFilter,a=s.StyleFilterSet}var n=0;l.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};l.prototype.toString=function(){return this.id};l.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};
l.prototype.init=function(){var a=this;a.dasSource.style?(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(b,d){if(d||!b){a.error="No stylesheet";b=new v;var c=new q;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();a.browser.refreshTier(a)}))};
l.prototype.setStylesheet=function(a){this.baseStylesheet=r(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=r(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=r(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=y(h(this.baseStylesheet));this._updateFromConfig()};l.prototype.getSource=function(){return this.featureSource};l.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};
l.prototype.getActiveStyleFilters=function(d){d=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var e=new a,c=this.stylesheet.styles,k=0;k<c.length;++k){var h=c[k];h.zoom&&h.zoom!=d||e.add(new b(h.type,h.method,h.label))}return e}};l.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};l.prototype.viewFeatures=function(a,b,d,c,k){this.currentFeatures=c;this.currentSequence=
k;this.notifyFeaturesLoaded();this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};l.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?k(this,a):d(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};l.prototype.findNextFeature=function(a,b,d,c,k){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*d/2|0,this.featureSource.quantFindNextFeature(a,b,d,this.quantLeapThreshold,k);else{if(this.knownCoverage&&
b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var h=null,l=0;l<this.currentFeatures.length;++l){var n=this.currentFeatures[l];if(n.min&&n.max&&!(n.parents&&0<n.parents.length))if(0>d)if(1==c&&n.max>=b&&n.min<b){if(!h||n.min>h.min||n.min==h.min&&n.max<h.max)h=n}else n.max<b&&(!h||n.max>h.max||n.max==h.max&&n.min<h.min||n.min==h.mmin&&h.max>=b)&&(h=n);else if(1==c&&n.min<=b&&n.max>b){if(!h||n.max<h.max||n.max==h.max&&n.min>h.min)h=n}else n.min>b&&(!h||n.min<h.min||
n.min==h.min&&n.max>h.max||n.max==h.max&&h.min<=b)&&(h=n)}if(h)return k(h);b=0>d?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,b,d,k)}};l.prototype.trySourceFNF=function(a,b,d,c){var k=this;this.featureSource.findNextFeature(a,b,d,function(a){a||c(a);var b=k.browser.getSequenceSource();b||c(a);b.getSeqInfo(a.segment,function(b){b?c(a):k.trySourceFNF(a.segment,0<d?1E10:0,d,c)})})};l.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":
"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};l.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};l.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:
a.featurePanelWidth;var d=this.overlay.getContext("2d");b&&d.scale(2,2);var c=b=a.viewStart,k=a.viewEnd;if(this.overlayLabelCanvas){var h=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale;d.save();d.translate(h,0);var l=-h+2;this.dasSource.tierGroup&&(l+=15);this.overlayLabelCanvas.draw(d,l,a.featurePanelWidth-h);d.restore()}for(h=0;h<a.highlights.length;++h)l=a.highlights[h],(l.chr===a.chr||l.chr==="chr"+a.chr)&&l.min<k&&l.max>c&&(d.globalAlpha=a.defaultHighlightAlpha,d.fillStyle=
a.defaultHighlightFill,d.fillRect((l.min-b)*a.scale,0,(l.max-l.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="0px"};l.prototype.updateStatus=function(a){a?(this.status=a,this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};l.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=
null);if(a){if(this._notifierOn(a),0<b){var d=this;this.notifierFadeTimeout=setTimeout(function(){d._notifierToStatus()},b)}}else this._notifierToStatus()};l.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=0.8};l.prototype._notifierOff=function(){this.notifier.style.opacity=0};l.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};l.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();
this.notifyTierListeners()};l.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};l.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};l.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var d=this.config.height||this.dasSource.forceHeight;d!=this.forceHeight&&
(this.forceHeight=d,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);d=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=d&&(this.forceMin=d,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);d=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=d&&(this.forceMax=d,a=!0);d=null;void 0!==this.config.quantLeapThreshold?
d=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(d=this.dasSource.quantLeapThreshold);d!=this.quantLeapThreshold&&(this.quantLeapThreshold=d,a=!0);d=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(d=this.config.stylesheet);d=d||this.baseStylesheet;this.stylesheet!==d&&(this.stylesheet=d,a=!0);d=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;d!==this.pinned&&(this.pinned=d,b=!0);d=typeof("number"===this.config.subtierMax)?this.config.subtierMax:
this.dasSource.subtierMax||this.browser.defaultSubtierMax;d!=this.subtierMax&&(this.subtierMax=d,a=!0);d=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;d!==this.bumped&&(this.bumped=d,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};l.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();
a.redrawTimeout=null},10))}};l.prototype.clearTierListeners=function(){this.listeners=[]};l.prototype.addTierListener=function(a){this.listeners.push(a)};l.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(d){console.log(d)}this.browser.notifyTier()};l.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};l.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};l.prototype.notifyFeaturesLoaded=
function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof u){u.exports={DasTier:l};var d=c("./feature-draw").drawFeatureTier,k=c("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./sequence-draw":31,"./sha1":33,"./style":36,"./utils":50}],45:[function(c,u,s){if("undefined"!==typeof c){var l=c("./cbrowser"),l=l.Browser,p=c("./tsmart-utils").displayError;u=c("./das");var r=u.DASSegment,
h=u.DASRegistry}if("undefined"!==typeof c){l=c("./cbrowser");l=l.Browser;c("./utils");c("./thub");c("./domui");c("./probe");c("./bin");c("./lh3utils");c("./bam");c("./tabix");u=c("./das");var v=u.DASSource,r=u.DASSegment,h=u.DASRegistry}l.prototype.addTrackByNode=function(c,l,b){var a=this,n,d,k=function(a,b,d){var e=[];b=btoa(b);a=""+a;b&&(a+="-"+b);"acgh"==d?(e[0]=new v({name:"acgh-gain",uri:pageInfo.basePath+"/das/acgh-gain-"+a+"/"}),e[1]=new v({name:"acgh-loss",uri:pageInfo.basePath+"/das/acgh-loss-"+
a+"/"}),e[2]=new v({name:"acgh-normal",uri:pageInfo.basePath+"/das/acgh-normal-"+a+"/"}),e[3]=new v({name:"acgh-amp",uri:pageInfo.basePath+"/das/acgh-amp-"+a+"/"}),e[4]=new v({name:"acgh-inv",uri:pageInfo.basePath+"/das/acgh-inv-"+a+"/"})):"vcf"==d?(e[0]=new v({name:"smaf",uri:pageInfo.basePath+"/das/smaf-"+a+"/"}),e[1]=new v({name:"qd",uri:pageInfo.basePath+"/das/qd-"+a+"/"}),e[3]=new v({name:"gv",uri:pageInfo.basePath+"/das/gv-"+a+"/"}),e[4]=new v({name:"vcf",uri:pageInfo.basePath+"/das/vcf-"+a+
"/"})):console.log("Unknown data type",d);return e},g=function(a,b,d,e,c){a.forEach(function(a){a.features(d,{},function(d){!a.name&&(d=/\/([^/]+)\/?$/.exec(a.uri))&&(a.name=d[1]);c&&(a.mapping=c);e(a,b)})})};GLOBAL.CurrentSubsetIDs[1]=null;GLOBAL.CurrentSubsetIDs[2]=null;var e=function(a,b){var d=new XMLHttpRequest;d.open("POST",pageInfo.basePath+"/HighDimension/nodeDetails",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");d.onreadystatechange=function(){if(4==
d.readyState)return 200==d.status||206==d.status?b(d.responseText):b(null)};var e="conceptKeys="+encodeURIComponent([a.id]);d.send(e)};runAllQueries(function(){function b(d,e,c){function g(){if(c)a.sources.push(d),a.makeTier(d);else return b(d,e,!0)}var k=d.uri;if(c){var l=/(.+)\/[^\/]+\/?/.exec(k);l&&(k=l[1]+"/sources")}(new h(k,{credentials:d.credentials})).sources(function(b){if(!b||0==b.length)return g();var c=null;if(1==b.length)c=b[0];else for(var k=0;k<b.length;++k)if(b[k].uri===d.uri){c=b[k];
break}c&&(d.name=c.name+e,d.desc=c.desc,d.maxbins=c.maxbins?!0:!1,c.capabilities&&(d.capabilities=c.capabilities));a.sources.push(d);a.makeTier(d)},function(){return g()})}n=GLOBAL.CurrentSubsetIDs[1];d=GLOBAL.CurrentSubsetIDs[2];var l=a.knownSpace;if(l){var s=Math.max(l.min,(l.min+l.max-100)/2)|0,u=new r(l.chr,s,Math.min(s+99,l.max));e(c,function(e){var h="",l="";e=JSON.parse(e);for(var r in e){var h=r,s=e[r].platforms[0];s.genomeReleaseId&&(l=s.genomeReleaseId.split(".")[0])}r=-1!=c.attributes.visualattributes.indexOf("HIGH_DIMENSIONAL")?
!0:!1;if(r){var v;a:{if(-1==a.coordSystem.compatibleIds.indexOf(l)){r=a.coordSystem.auth+a.coordSystem.version+"/"+a.coordSystem.ucscName;if(a.chains)for(v in a.chains)if(0<=a.chains[v].coords.compatibleIds.indexOf(l)){alert("The newly added tracks will be mapped from genome release '"+l+"' to '"+r+"' using mapping '"+v+"'");break a}l?alert("Could not find a coordinate mapping for the genome release specified in the data ("+l+") to the genome browser's coordinate system ("+r+"). If the coordinate systems differ, displayed information will be incorrect."):
alert("No genome release version specified for the selected data. Make sure it was specified correctly at upload in the platform (gpl_info). Newly added tracks will be displayed as if they were in the genome browser's coordinate system ("+r+"). The displayed information might be incorrect.")}v=""}l=k(n,c.id,h);g(l,d?"-subset 1":"",u,b,v);d&&(l=k(d,c.id,h),g(l,"-subset 2",u,b,v));a.createAddInfoButton()}else p("Error","Cannot display non-High Dimensional node")})}else alert("Can't confirm track-addition to an unit browser.")})};
l.prototype.createAddInfoButton=function(){var c=this,h=jQuery(".pull-right.btn-group").children();jQuery(h[0]).click(function(){if(!(0<jQuery("#btnAddVCFINFO").length)){var b=c.makeButton("Add VCF INFO","Add a custom track with a particular field from the INFO column in a VCF file");b.id="btnAddVCFINFO";b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();a=c.scanCurrentTracksForVCF();if(0<a.length){var b=prompt("You can add custom track from the INFO column. If you know the VCF file's INFO column contains for example: \n\nDP=89;AF1=1;AC1=2;DP4=0,0,81,0;MQ=60;FQ=-271,\n\n you can add a track for DP to see the values of DP plotted. \nPlease, first drop a VCF node from the concept tree on the genome browser. \nNote: please remember to remove the track and add it again if you change the patient subset selection criteria",
"DP");null!=b&&(c.addVCFInfoTrack(b,a[0].id,a[0].concept,1<a.length?"-subset 1":""),1<a.length&&c.addVCFInfoTrack(b,a[1].id,a[1].concept,"-subset 2"))}else alert("Please, first drop a VCF node from the concept tree on the genome browser.")});jQuery(".nav").prepend(b)}})};l.prototype.addVCFInfoTrack=function(c,h,b,a){this.addTier(new v({name:"VCF-"+c.trim()+a,uri:pageInfo.basePath+"/das/vcfInfo-"+c.trim()+"-"+h+"-"+b+"/"}))};l.prototype.scanCurrentTracksForVCF=function(){for(var c=[],h=0;h<this.sources.length;h++){var b=
this.sources[h];if(b.uri&&(-1<b.uri.indexOf("vcf-")||-1<b.uri.indexOf("smaf-")||-1<b.uri.indexOf("qd-")||-1<b.uri.indexOf("gv-"))){var a=/([^\-]+)-([^\-]+)-([^\/]+)\/$/.exec(b.uri);if(a){for(var b=a[2],a=a[3],l=null,d=0;d<c.length;d++)c[d].id==b&&c[d].concept==a&&(l=c[d]);null==l&&(l={id:b,concept:a},c.push(l))}}}return c}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":24,"./probe":28,"./tabix":40,"./thub":41,"./tsmart-utils":48,"./utils":50}],46:[function(c,u,s){function l(a,
b){for(var d=0;d<a.length;++d){var f=a[d];f===b?f.classList.add("active"):f.classList.remove("active")}}if("undefined"!==typeof c){u=c("./cbrowser");var p=u.Browser,r=u.sourcesAreEqual;u=c("./utils");var h=u.makeElement,v=u.removeChildren,q=u.Observed;u=c("./thub");var y=u.THUB_COMPARE,b=u.connectTrackHub,a=c("./domui").makeTreeTableSection,n=c("./probe").probeResource;u=c("./bin");var d=u.URLFetchable,k=u.BlobFetchable,g=u.readInt,e=c("./lh3utils").unbgzf,t=c("./bam").BAI_MAGIC,C=c("./tabix").TABIX_MAGIC;
u=c("./das");var R=u.DASSource,L=u.DASSegment,E=u.DASRegistry,N=u.coordsMatch,P=c("./encode").EncodeFetchable}p.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(r(this.tiers[b].dasSource,a))return this.tiers[b];return!1};p.prototype.makeButton=function(a,b){var d=h("a",a,{href:"#"});b&&this.makeTooltip(d,b);return h("li",d)};p.prototype.showTrackAdder=function(c){function r(b){da.style.display="none";ha.style.display="none";ba.style.display="none";U=!1;v(M);for(var f=h("div",
null,{},{width:"100%"}),d=[],e=0;e<b.length;++e)d.push(b[e]);d.sort(function(a,b){return a.shortLabel.toLowerCase().trim().localeCompare(b.shortLabel.toLowerCase().trim())});b=[];for(var c=[],e=0;e<d.length;++e){var g=d[e];g.children&&0<g.children.length&&"multiWig"!=g.container?b.push(g):c.push(g)}0<c.length&&b.push({shortLabel:"Others",priority:-1E8,children:c});b.sort(y);for(var k=[],d=0;d<b.length;++d){g=c=b[d];!g.dimensions&&g._parent&&g._parent.dimensions&&(g=g._parent);e={};if(g.dimensions)for(var l=
g.dimensions.split(/(\w+)=(\w+)/),n=0;n<l.length-2;n+=3)e[l[n+1]]=l[n+2];if(e.dimX&&e.dimY){for(var q=e.dimX,p=e.dimY,e=g.subgroups[q],l=g.subgroups[p],n={},z=0;z<c.children.length;++z){var w=c.children[z],g=w.sgm[q],B=w.sgm[p];n[g]||(n[g]={});n[g][B]=w}p=h("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});g=h("tr");g.appendChild(h("th",null,{},{width:"150px",height:"100px"}));for(B=0;B<e.titles.length;++B)q=h("th",h("div",e.titles[B],{},{transform:"rotate(-60deg)",
transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),g.appendChild(q);p.appendChild(g);for(var t=h("tbody",null,{className:"table table-striped table-condensed"}),s=0;s<l.titles.length;++s){var B=l.tags[s],A=h("tr");A.appendChild(h("th",l.titles[s]),{});for(var u=0;u<e.titles.length;++u){var g=e.tags[u],x=h("td");if(n[g]&&n[g][B]){g=n[g][B];z=g.toDallianceSource();
if(!z)continue;q=h("tr");w=h("td");w.style.textAlign="center";var K=h("input");K.type="checkbox";K.dalliance_source=z;qa&&(K.dalliance_mapping=qa);k.push(K);x.appendChild(K);K.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)})}A.appendChild(x)}t.appendChild(A)}p.appendChild(t);f.appendChild(a(c.shortLabel,p,0==d))}else{l=h("tbody",null,{className:"table table-striped table-condensed"});n=h("table",l,{className:"table table-striped table-condensed"},
{width:"100%",tableLayout:"fixed"});B=0;c.children.sort(y);for(e=0;e<c.children.length;++e)if(g=c.children[e],z=g.toDallianceSource())q=h("tr"),w=h("td",null,{},{width:"30px"}),w.style.textAlign="center",K=h("input"),K.type="checkbox",K.dalliance_source=z,qa&&(K.dalliance_mapping=qa),k.push(K),w.appendChild(K),K.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)}),q.appendChild(w),p=h("td"),p.appendChild(document.createTextNode(g.shortLabel)),
g.longLabel&&0<g.longLabel.length&&m.makeTooltip(p,g.longLabel),q.appendChild(p),l.appendChild(q),++B;1<b.length||"Others"!==c.shortLabel?f.appendChild(a(c.shortLabel,n,0==d)):f.appendChild(n)}}var I=function(){for(var a=0;a<k.length;++a){var b=k[a],f=m.currentlyActive(b.dalliance_source);f?(b.checked=!0,b.disabled=null!=f.sequenceSource):b.checked=!1}};I();m.addTierListener(function(a){I()});M.appendChild(f)}function p(){l(F,la);U="bin";da.style.display="none";ha.style.display="inline";ba.style.display=
"none";v(M);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom URL-based data"));a.appendChild(h("p",["You can add indexed binary data hosted on an web server that supports CORS (",h("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(h("br"));a.appendChild(document.createTextNode("URL: "));$=h("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},
{width:"100%"});a.appendChild($);a.appendChild(h("br"));a.appendChild(h("b","- or -"));a.appendChild(h("br"));a.appendChild(document.createTextNode("File: "));fa=h("input",null,{type:"file",multiple:"multiple"});a.appendChild(fa);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.'));M.appendChild(a);$.focus()}function f(){l(F,ea);da.style.display="none";ha.style.display="inline";ba.style.display="none";U="hub-connect";da.style.visibility="hidden";v(M);var a=
h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Connect to a track hub."));a.appendChild(h("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));$=h("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild($);M.appendChild(a);$.focus()}function z(){l(F,ga);da.style.display="none";ha.style.display="inline";ba.style.display="none";U="das";v(M);var a=h("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom DAS data"));a.appendChild(h("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(h("br"));$=h("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild($);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));
M.appendChild(a);$.focus()}function B(){if(U)if("das"===U){var a=$.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new R({name:"temporary",uri:a});va(a)}else if("bin"===U){var b=fa.files;if(b&&0<b.length){a=na=[];U="multiple";for(var d=0;d<b.length;++d){var e=b[d];e&&a.push({blob:e})}for(d=0;d<a.length;++d)aa(a[d]);ia()}else a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport="encode"),
W(b)}else if("reset"===U)z();else if("reset-bin"===U)p();else if("reset-hub"===U)f();else if("prompt-bai"===U)(b=fa.files)&&0<b.length&&b[0]?(Y.baiBlob=b[0],u(Y)):(b=Y,da.style.display="none",ha.style.display="inline",ba.style.display="inline",v(M),U="prompt-bai",M.appendChild(h("h2","Select an index file")),M.appendChild(h("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),fa=h("input",null,{type:"file"}),M.appendChild(fa),Y=b);else if("prompt-tbi"===U)(b=fa.files)&&0<b.length&&b[0]?(Y.indexBlob=b[0],A(Y)):(b=Y,da.style.display="none",ha.style.display="inline",ba.style.display="inline",v(M),U="prompt-tbi",M.appendChild(h("h2","Select an index file")),M.appendChild(h("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
M.appendChild(document.createTextNode("Index file: ")),fa=h("input",null,{type:"file"}),M.appendChild(fa),Y=b);else if("finalize"===U||"finalize-bin"===U)Y.name=pa.value,b=ma.value,Y.mapping="__default__"!=b?b:void 0,oa&&(Y.maxbins=oa.checked),1<sa.value.length&&1<ta.value.length&&(Y.xUser=sa.value,Y.xPass=ta.value),m.addTier(Y),"finalize-bin"==U?p():z();else if("hub-connect"===U)a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),s(a);else{if("multiple"===U){for(b=0;b<na.length;++b)if(a=na[b],!a.hidden&&
("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=wa(a)))a.noPersist=!0,m.addTier(a);p()}}else m.removeAllPopups()}function s(a,f,d){f=f||{};for(var e=0;e<m.hubObjects.length;++e){var c=m.hubObjects[e];if(c.hub.url==a){for(e=0;e<F.length;++e)F[e].hub==c&&l(F,F[e]);c.getTracks(function(a,b){b&&console.log(b);r(a)});return}}b(a,function(b,e){if(e){if(!d)return s(a,{credentials:!0},!0);v(M);M.appendChild(h("h2","Error connecting to track hub"));M.appendChild(h("p",
e));U="reset-hub"}else{var c=null,g=null,k;for(k in b.genomes){var n=null,q=!1;if(k==m.coordSystem.ucscName)q=!0;else for(var p in m.chains)k==m.chains[p].coords.ucscName&&(n=p,q=!0);q&&(q={url:a,genome:k},f.credentials&&(q.credentials=!0),n&&(q.mapping=n,b.genomes[k].mapping=n),m.hubs.push(q),m.hubObjects.push(b.genomes[k]),q=ca(b.genomes[k]),ra.appendChild(q),n&&c||(c=b.genomes[k],g=q))}c?(m.notifyTier(),l(F,g),c.getTracks(function(a,b){r(a)})):(v(M),M.appendChild(h("h2","No data for this genome")),
M.appendChild(h("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),M.appendChild(h("p","coordSystem.ucscName = "+m.coordSystem.ucscName)),U="reset-hub")}},f)}function w(a,b){var f=a.uri;if(b){var d=/(.+)\/[^\/]+\/?/.exec(f);d&&(f=d[1]+"/sources")}(new E(f,{credentials:a.credentials})).sources(function(f){if(!f||0==f.length)return b?O(a):w(a,!0);var d=null;if(1==f.length)d=f[0];else for(var e=0;e<f.length;++e)if(f[e].uri===a.uri){d=
f[e];break}e=f=!1;if(d&&(a.name=d.name,a.desc=d.desc,a.maxbins=d.maxbins?!0:!1,d.capabilities&&(a.capabilities=d.capabilities),e=!0,d.coords&&1==d.coords.length))if(d=d.coords[0],N(d,m.coordSystem))f=!0;else if(m.chains)for(var c in m.chains)N(d,m.chains[c].coords)&&(a.mapping=c,f=!0);return O(a,f,e)},function(){return b?O(a):w(a,!0)})}function u(a){(a.baiBlob?new k(a.baiBlob):"encode"==a.transport?new P(a.bamURI+".bai"):new d(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(b){var f=
!1;b&&(b=new Uint8Array(b),f=g(b,0)==t);return f?O(a,!1,!1,!0):I("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function A(a){(a.indexBlob?new k(a.indexBlob):new d(a.uri+".tbi")).slice(0,65536).fetch(function(b){var f=!1;if(b){var d=new Uint8Array(b);if(31==d[0]||139==d[1])b=e(b),d=new Uint8Array(b),f=g(d,0)==C}return f?O(a,!1,!1,!0):I('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function I(a){da.style.display="none";ha.style.display="inline";ba.style.display="inline";v(M);a=a||"Custom data format not recognized";M.appendChild(h("h2","Error adding custom data"));M.appendChild(h("p",a));M.appendChild(h("p","Currently supported formats are bigBed, bigWig, and BAM."));U="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var m=this;c=h("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var F=[],S,G;if(!this.noRegistryTabs){var Q=this.makeButton("Registry","Browse compatible datasources from the DAS registry");F.push(Q);for(var V in this.mappableSources)(function(a){var b=m.makeButton(m.chains[a].srcTag,"Browse datasources mapped from "+m.chains[a].srcTag);F.push(b);b.addEventListener("click",function(f){f.preventDefault();f.stopPropagation();l(F,b);S(m.mappableSources[a],a)},!1)})(V)}V={};for(var Z=0;Z<this.defaultSources.length;++Z){var ja=
this.defaultSources[Z],T=ja.group||"Defaults";V[T]?V[T].push(ja):V[T]=[ja]}var ca=function(a){var b=a.hub,d=h("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),e=b.shortLabel||"Unknown";a.mapping&&(e=e+" ("+a.genome+")");var e=h("span",[e," ",d]),c=m.makeButton(e,b.longLabel);c.hub=a;F.push(c);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();l(F,c);v(M);b=m.makeLoader(24);b.style.marginLeft="auto";b.style.marginRight="auto";b.style.marginTop="100px";M.appendChild(h("div",
b,null,{textAlign:"center"}));da.style.display="none";ha.style.display="none";ba.style.display="none";a.getTracks(function(a,b){b&&console.log(b);r(a)})},!1);d.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var d=h("li",h("a","Remove hub")),e=h("li",h("a","Enable all")),g=h("li",h("a","Disable all")),k=h("ul",[d,e,g],{className:"dropdown-menu"},{display:"block"}),n=b.clientX;b=b.clientY;n+=document.documentElement.scrollLeft||document.body.scrollLeft;b+=document.documentElement.scrollTop||
document.body.scrollTop;k.style.position="absolute";k.style.top=""+(b+10)+"px";k.style.left=""+(n-30)+"px";m.hPopupHolder.appendChild(k);var q=function(a){console.log("cc");document.body.removeEventListener("click",q,!0);m.hPopupHolder.removeChild(k)};document.body.addEventListener("click",q,!0);d.addEventListener("click",function(b){for(b=0;b<m.hubObjects.length;++b)if(m.hubObjects[b].absURL==a.absURL){m.hubObjects.splice(b,1);break}for(b=0;b<m.hubs.length;++b){var d=m.hubs[b];"string"===typeof d&&
(d={url:d});if(d.url==a.hub.url&&!d.genome||d.genome==a.genome){m.hubs.splice(b,1);break}}m.notifyTier();ra.removeChild(c);l(F,ea);f()},!1);e.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var f=0;f<a.length;++f){var d=a[f].toDallianceSource();m.currentlyActive(d)||m.addTier(d)}})},!1);g.addEventListener("click",function(b){a.getTracks(function(a,b){b&&console.log(b);for(var f=0;f<a.length;++f){var d=a[f].toDallianceSource();m.currentlyActive(d)&&m.removeTier(d)}})},
!1)},!1);return c},X=null,ka=null;for(T in V)(function(a,b){var f=m.makeButton(a,"Browse the default set of data for this browser");f.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();l(F,f);S(new q(b))},!1);F.push(f);X||(X=f,ka=b)})(T,V[T]);var ga=this.makeButton("DAS","Add arbitrary DAS data");F.push(ga);var la=this.makeButton("Binary","Add data in bigwig or bigbed format");F.push(la);for(T=0;T<this.hubObjects.length;++T)ca(this.hubObjects[T]);var ea=this.makeButton("+",
"Connect to a new track-hub");F.push(ea);var ra=h("ul",F,{className:"nav nav-tabs"},{marginBottom:"0px"});c.appendChild(ra);var $,pa,ma,oa,fa,sa,ta,U=!1,Y=null,T=h("form",null,{},{display:"inline-block",width:"100%"});T.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();B();return!1},!0);var M=h("div");M.style.position="relative";M.style.overflow="scroll";T.appendChild(M);var qa,ua;S=function(a,b){da.style.display="none";ha.style.display="none";ba.style.display="none";ua&&
ua.removeListener(G);qa=b;ua=a;ua.addListenerAndFire(G)};G=function(a){U=!1;var b=[];v(M);if(a){for(var f=h("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),d=h("table",f,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),e=0,c=[],g=0;g<a.length;++g)c.push(a[g]);c.sort(function(a,b){return a.name.toLowerCase().trim().localeCompare(b.name.toLowerCase().trim())});for(g=0;g<c.length;++g){a=c[g];var k=h("tr"),l=h("td",null,{},{width:"30px"});
l.style.textAlign="center";if(!a.props||a.props.cors){var n=h("input");n.type="checkbox";n.dalliance_source=a;qa&&(n.dalliance_mapping=qa);l.appendChild(n);b.push(n);n.addEventListener("change",function(a){a.target.checked?m.addTier(a.target.dalliance_source):m.removeTier(a.target.dalliance_source)})}else l.appendChild(document.createTextNode("!")),m.makeTooltip(l,h("span",["This data source isn't accessible because it doesn't support ",h("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));k.appendChild(l);
l=h("td");l.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&m.makeTooltip(l,a.desc);k.appendChild(l);f.appendChild(k);++e}var q=function(){for(var a=0;a<b.length;++a){var f=b[a];m.currentlyActive(f.dalliance_source)?f.checked=!0:f.checked=!1}};q();m.addTierListener(function(a){q()});M.appendChild(d)}else M.appendChild(h("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};Q&&Q.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();l(F,Q);S(m.availableSources)},!1);la.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p()},!1);ea.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();f()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();z()},!1);var ha=h("button","Add",{className:"btn btn-primary"});ha.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();B()},!1);var va=function(a,b){var f=m.knownSpace;
if(f){var d=Math.max(f.min,(f.min+f.max-100)/2)|0,f=new L(f.chr,d,Math.min(d+99,f.max));a.features(f,{},function(f,d){if(d)b?(v(M),M.appendChild(h("h2","Custom data not found")),M.appendChild(h("p","DAS uri: "+a.uri+" is not answering features requests")),U="reset"):(a.credentials=!0,va(a,!0));else{var e=/\/([^/]+)\/?$/.exec(a.uri);e&&(a.name=e[1]);w(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},wa=function(a){var b={name:a.name};a.credentials&&(b.credentials=a.credentials);
a.mapping&&"__default__"!=a.mapping&&(b.mapping=a.mapping);a.transport&&(b.transport=a.transport);if("bwg"==a.tier_type)return a.blob?b.bwgBlob=a.blob:a.uri&&(b.bwgURI=a.uri),b;if("bam"==a.tier_type)return a.blob?(b.bamBlob=a.blob,b.baiBlob=a.indexBlob):(b.bamURI=a.uri,b.baiURI=a.indexUri),b;if("tabix"==a.tier_type)return b.tier_type="tabix",b.payload=a.payload,a.blob?(b.blob=a.blob,b.indexBlob=a.indexBlob):(b.uri=a.uri,b.indexUri=a.indexUri),b;if("memstore"==a.tier_type)return b.tier_type="memstore",
b.payload=a.payload,a.blob?b.blob=a.blob:b.uri=a.uri,b},W=function(a){n(a,function(a,b){if(b)v(M),M.appendChild(h("h2","Couldn't access custom data")),M.appendChild(h("p",""+b)),U="reset-bin";else{var f=wa(a);return"bam"==a.tier_type?u(f):"tabix"==a.tier_type?A(f):O(f,!1,!1,!0)}})},O=function(a,b,f,d){da.style.display="none";ha.style.display="inline";ba.style.display="inline";v(M);M.appendChild(h("h2","Add custom data: step 2"));M.appendChild(document.createTextNode("Label: "));pa=h("input","",{value:a.name});
M.appendChild(pa);sa=h("input","");ta=h("input","");M.appendChild(h("br"));M.appendChild(h("br"));M.appendChild(h("h4","Coordinate system: "));ma=h("select",null);ma.appendChild(h("option",m.nameForCoordSystem(m.coordSystem),{value:"__default__"}));if(m.chains)for(var e in m.chains)ma.appendChild(h("option",m.nameForCoordSystem(m.chains[e].coords),{value:e}));ma.value=a.mapping||"__default__";M.appendChild(ma);b?M.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):(M.appendChild(h("p",
[h("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),M.appendChild(h("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));d||(M.appendChild(document.createTextNode("Quantitative: ")),oa=h("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(oa.checked=a.maxbins),M.appendChild(oa),f?M.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):M.appendChild(h("p",
[h("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&M.appendChild(h("p",[h("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));pa.focus();U="bin"===U||"prompt-bai"===U||"prompt-tbi"===U?"finalize-bin":"finalize";Y=a},na=null,aa=function(a){n(a,function(a,b){b&&(a.error=b);for(var f=[],d={},e={},c=0;c<na.length;++c){var g=na[c];"bam"!=g.tier_type||g.indexBlob||(d[g.blob.name]=
g);"tabix"!=g.tier_type||g.indexBlob||(e[g.blob.name]=g)}for(c=0;c<na.length;++c)if(g=na[c],"bai"===g.tier_type){var k=/(.+)\.bai$/.exec(g.blob.name);k&&d[k[1]]&&(d[k[1]].indexBlob=g.blob,f.push(c))}else"tabix-index"===g.tier_type&&(k=/(.+)\.tbi$/.exec(g.blob.name))&&e[k[1]]&&(e[k[1]].indexBlob=g.blob,f.push(c));for(d=f.length-1;0<=d;--d)na.splice(f[d],1);ia()})},ia=function(){v(M);var a=!1,b=h("table",na.filter(function(a){return!a.hidden}).map(function(b){h("tr").appendChild(h("td",b.name||b.blob.name));
var f;f=b.error?h("span","Error",null,{color:"red"}):b.tier_type?b.payload||b.tier_type:m.makeLoader(16);var d,e="unknown";"bwg"==b.tier_type||"memstore"==b.tier_type?e="okay":"bam"==b.tier_type?e=b.indexBlob?"okay":"needs-index":"tabix"==b.tier_type&&(e=b.indexBlob?"okay":"needs-index");if("okay"==e){d=h("select",null,null,{width:"150px"});d.appendChild(h("option",m.nameForCoordSystem(m.coordSystem),{value:"__default__"}));if(m.chains)for(var c in m.chains)d.appendChild(h("option",m.nameForCoordSystem(m.chains[c].coords),
{value:c}));d.value=b.mapping||"__default__";d.addEventListener("change",function(a){b.mapping=d.value;console.log(b)},!1)}else"needs-index"==e&&(d=h("span","Needs index",{},{color:"red"}),a=!0);return h("tr",[h("td",b.name||b.blob.name),h("td",f),h("td",d)])}),{className:"table table-striped table-condensed"});M.appendChild(b);if(a){M.appendChild(h("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
M.appendChild(document.createTextNode("Index file(s): "));var f=h("input",null,{type:"file",multiple:"multiple"});M.appendChild(f);f.addEventListener("change",function(a){console.log("fileset changed");a=f.files||[];for(var b=0;b<a.length;++b){var d=a[b];d&&(d={blob:d,hidden:!0},na.push(d),aa(d))}},!1)}},ba=h("button","Cancel",{className:"btn"});ba.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===U?p():z()},!1);var da=h("button","Refresh",{className:"btn"});
da.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();m.queryRegistry(qa)},!1);this.makeTooltip(da,"Click to re-fetch data from the DAS registry");V=h("div",[ha," ",ba," ",da]);V.style.margin="10px";T.appendChild(V);c.appendChild(T);S(m.availableSources);this.showToolPanel(c);this.setUiMode("add");X&&(l(F,X),S(new q(ka)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./tabix":40,"./thub":41,"./utils":50}],47:[function(c,
u,s){function l(c,h,l){h.fetchAsText(function(h){if(!h)return l(null,"Couldn't fetch index-index");h=h.split(/(.+)([0-9A-F]{10})\n/);for(var s=[],b=[],a=1;a<h.length;a+=3)s.push(h[a]),b.push(parseInt(h[a+1],16));return l(new p(s,b,c))})}function p(c,h,l){this.keys=c;this.offsets=h;this.ix=l}p.prototype.lookup=function(c,h){for(var l,q=(c+"     ").substring(0,5).toLowerCase(),p=0;p<this.keys.length;++p)if(0>q.localeCompare(this.keys[p])){l=this.ix.slice(this.offsets[p-1],this.offsets[p]-this.offsets[p-
1]);break}l||(l=this.ix.slice(this.offsets[this.offsets.length-1]));l.fetchAsText(function(b){b=b.split("\n");for(var a=0;a<b.length;++a)if(0==b[a].indexOf(c.toLowerCase()+" "))return h(b[a].split(" "));return h(null)})};"undefined"!==typeof u&&(u.exports={connectTrix:l})},{}],48:[function(c,u,s){},{}],49:[function(c,u,s){function l(){}function p(b,d){var e=new l;e.data=b;e.data.slice(0,12500).fetch(function(b){if(!b)return d(null,"Couldn't access data");var c=new Uint8Array(b);b=h(c,0);if(b==a)e.readInt=
h;else if(b==n)e.readInt=v;else return d(null,"Not a .2bit file, magic=0x"+b.toString(16));b=e.readInt(c,4);if(0!=b)return d(null,"Unsupported version "+b);e.seqCount=e.readInt(c,8);e.seqDict={};var k=16,l=0,q=0,p=function(){for(;l<e.seqCount;){var a=c[k];if(k+a+6>=c.length)return e.data.slice(q+k,12500).fetch(function(a){q+=k;k=0;c=new Uint8Array(a);p()});++k;for(var b="",h=1;h<=a;++h)b+=String.fromCharCode(c[k++]);a=e.readInt(c,k);k+=4;e.seqDict[b]=new r(e,a);++l}return d(e)};p()})}function r(a,
b){this.tbf=a;this.offset=b}if("undefined"!==typeof c){s=c("./bin");var h=s.readInt,v=s.readIntBE;c=c("./spans");var q=c.Range,y=c.union,b=c.intersection}var a=440477507,n=1126646042;l.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};l.prototype.fetch=function(a,b,d,c){var h=this.getSeq(a);if(h){if(d<=b)return c("");h.fetch(b,d,c)}else return c(null,"Couldn't find "+a)};r.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,
8).fetch(function(d){if(!d)return a("Fetch failed");d=new Uint8Array(d);b._length=b.tbf.readInt(d,0);b.nBlockCnt=b.tbf.readInt(d,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(d){if(!d)return a("Fetch failed");d=new Uint8Array(d);for(var e=null,c=0;c<b.nBlockCnt;++c)var h=b.tbf.readInt(d,4*c),l=b.tbf.readInt(d,4*(c+b.nBlockCnt)),h=new q(h,h+l-1),e=e?y(e,h):h;b.nBlocks=e;b.mBlockCnt=b.tbf.readInt(d,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+
b.mBlockCnt);return a()})})};var d=["T","C","A","G"];r.prototype.fetch=function(a,c,e){--a;--c;var h=this;this.init(function(l){if(l)return e(null,l);var n=a>>2;l=c+3>>2;if(0>n||l>h.seqLength)return e("Coordinates out of bounds: "+a+":"+c);h.tbf.data.slice(h.seqOffset+n,l-n).salted().fetch(function(l){function p(a){for(;v<=a;){var b=v&3,e=r[(v>>2)-n];u+=d[0==b?e>>6&3:1==b?e>>4&3:2==b?e>>2&3:e&3];++v}}if(null==l)return e("SeqFetch failed");var r=new Uint8Array(l);l=[];if(h.nBlocks){var s=b(new q(a,
c),h.nBlocks);s&&(l=s.ranges())}for(var u="",v=a,s=0;s<l.length;++s){var y=l[s];if(v>y.min())throw"N mismatch...";for(v<y.min()&&p(y.min()-1);v<=y.max();)u+="N",++v}v<=c&&p(c);return e(u)})})};r.prototype.length=function(a){var b=this;this.init(function(d){return d?a(null,d):a(b._length)})};"undefined"!==typeof u&&(u.exports={makeTwoBit:p})},{"./bin":4,"./spans":35}],50:[function(c,u,s){function l(a,b){for(var d=0;d<a.length;++d)if(a[d]==b)return;a.push(b)}function p(a,b,d){a[b]?a[b].push(d):a[b]=
[d]}function r(a,b,d){var e=a[b];if(e){for(a=0;a<e.length;++a)if(e[a]==d)return;e.push(d)}else a[b]=[d]}function h(a,b,d,e){if(a)return a;if(b)return b;if(d)return d;if(e)return e}function l(a,b){for(var d=0;d<a.length;++d)if(a[d]==b)return;a.push(b)}function v(a,b){if(!a)return-1;for(var d=0;d<a.length;++d)if(a[d]===b)return d;return-1}function q(a,b,d,e){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var c=0;c<b.length;++c){var g=b[c];g&&("string"==typeof g?g=document.createTextNode(g):
"number"==typeof g&&(g=document.createTextNode(""+g)),a.appendChild(g))}}if(d)for(var f in d)try{a[f]=d[f]}catch(k){throw console.log("error setting "+f),k;}if(e)for(f in e)a.style[f]=e[f];return a}function y(a,b,d,e){a=document.createElementNS(a,b);if(d)for(d instanceof Array||(d=[d]),b=0;b<d.length;++b){var c=d[b];"string"==typeof c&&(c=document.createTextNode(c));a.appendChild(c)}if(e)for(var g in e){d=a;b=g;var c=e[g],f=R[b];if(!f){for(var f="",k=0;k<b.length;++k)var h=b.substring(k,k+1),l=h.toLowerCase(),
f=l!=h?f+"-"+l:f+h;R[b]=f}d.setAttribute(f,c)}return a}function b(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}function a(b,d){if("undefined"===typeof b)return"undefined";if(null==b)return"null";if("string"==typeof b)return"'"+b+"'";if("number"==typeof b||"boolean"==typeof b)return""+b;if("object"==typeof b){if(b instanceof Array){for(var e=null,c=0;c<b.length;++c)e=(null==e?"":e+", ")+a(b[c],d);return"["+(e?e:"")+"]"}d=d||{};e=null;for(c in b)d[c]||void 0!=c&&"function"!=
typeof b[c]&&(e=(null==e?"":e+", ")+c+": "+a(b[c],d));return"{"+(e?e:"")+"}"}return typeof b}function n(a){var b={},d;for(d in a)b[d]=a[d];return b}function d(a){this.value=a;this.listeners=[]}function k(){this.queue=[]}function g(a,b,d){d&&d.salt&&(a=a+"?salt="+C(""+Date.now()+","+ ++L));var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(300<=e.status?b(null,"Error code "+e.status):b(e.responseText))};e.open("GET",a,!0);e.responseType="text";d&&d.credentials&&(e.withCredentials=
!0);e.send("")}function e(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var d=a.lastIndexOf("/");return 0<=d?a.substr(0,d+1)+b:b}function t(a){return q("a",null,{href:a}).href}if("undefined"!==typeof c)var C=c("./sha1").b64_sha1;var R={};d.prototype.addListener=function(a){this.listeners.push(a)};d.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};d.prototype.removeListener=function(a){var b=this.listeners;a=v(b,a);0<=a&&b.splice(a,1)};d.prototype.get=
function(){return this.value};d.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};k.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};k.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var L=0;c={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",
ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,
"").replace(/\s+$/,"")});"undefined"!==typeof u&&(u.exports={textXHR:g,relativeURL:e,resolveUrlToPage:t,shallowCopy:n,pusho:p,pushnew:l,pushnewo:r,arrayIndexOf:v,pick:h,makeElement:q,makeElementNS:y,removeChildren:b,miniJSONify:a,Observed:d,Awaited:k,AMINO_ACID_TRANSLATION:c})},{"./sha1":33}],51:[function(c,u,s){function l(){this.info=[]}function p(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof c){var r=c("./sourceadapters").registerParserFactory;c=c("./das");var h=c.DASStylesheet,v=c.DASStyle,
q=c.DASFeature}var y=/([^;=]+)(=([^;]+))?;?/,b=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;l.prototype.createSession=function(a){return new p(this,a)};p.prototype.parse=function(c){if(0!=c.length)if("#"==c[0]){if(1<c.length&&"#"==c[1]&&(c=b.exec(c))){var d=c[1].split(a),k=null,g=null;for(c=0;c<d.length-1;c+=3){var e=d[c+1],h=d[c+2].replace(/"/g,"");"ID"==e?k=h:"Description"==e&&(g=h)}k&&g&&this.parser.info.push({id:k,desc:g})}}else{d=c.split("\t");k=new q;k.segment=d[0];k.id=d[2];k.refAllele=
d[3];k.altAlleles=d[4].split(",");k.min=parseInt(d[1]);k.max=k.min+k.refAllele.length-1;d=d[7].split(y);k.info={};for(c=0;c<d.length;c+=4)k.info[d[c+1]]=d[c+3];c=k.altAlleles[0];d=k.refAllele;c.length>d.length?(k.type="insertion",0==c.indexOf(d)?(k.insertion=c.substr(d.length),k.min+=d.length,k.max=k.min-1):k.insertion=c):k.type=c.length<d.length?"deletion":"substitution";this.sink(k)}};p.prototype.flush=function(){};l.prototype.getStyleSheet=function(a){var b=new h,c=new v;c.glyph="__INSERTION";
c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"insertion"},null,c);c=new v;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(255, 60, 60)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,c);c=new v;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.BGCOLOR="#888888";c.STROKECOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};l.prototype.getDefaultFIPs=function(a){var b=
this;a(function(a,c){c.add("Ref. allele",a.refAllele);c.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var e=0;e<b.info.length;++e){var h=b.info[e],l=a.info[h.id];void 0!==l&&c.add(h.desc,l)}})};r("vcf",function(){return new l})},{"./das":10,"./sourceadapters":34}],52:[function(c,u,s){c={CONFIG:5,MAJOR:0,MINOR:13,MICRO:2,PATCH:"",BRANCH:"",toString:function(){var c=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(c+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(c=c+"-"+this.BRANCH);
return c}};"undefined"!==typeof u&&(u.exports=c)},{}],53:[function(c,u,s){function l(){function c(b){b=Math.min(b,n);g=b=Math.max(b,a);q.style.left=""+g+"px"}function h(b){b=Math.min(b,n);e=b=Math.max(b,a);s.style.left=""+e+"px"}var l=p("hr",null,{className:"slider-track"}),q=p("hr",null,{className:"slider-thumb active"}),s=p("hr",null,{className:"slider-thumb"}),b=p("div",[l,q,s],{className:"slider"}),a=0,n=200,d=0,k=200,g=50,e=100,t=[];b.removeLabels=function(){for(var a=0;a<t.length;++a)b.removeChild(t[a]);
t=[]};b.addLabel=function(e,c){var g=p("div",c,{className:"slider-label"},{left:""+(a+(e-d)*(n-a)/(k-d)|0)+"px"});b.appendChild(g);t.push(g)};var u=document.createEvent("HTMLEvents");u.initEvent("change",!0,!1);Object.defineProperty(b,"value",{get:function(){return d+(g-a)*(k-d)/(n-a)},set:function(b){c(a+(b-d)*(n-a)/(k-d))}});Object.defineProperty(b,"value2",{get:function(){return d+(e-a)*(k-d)/(n-a)},set:function(b){h(a+(b-d)*(n-a)/(k-d))}});Object.defineProperty(b,"active",{get:function(){return q.classList.contains("active")?
1:2},set:function(a){1==a?(q.classList.add("active"),s.classList.remove("active")):(s.classList.add("active"),q.classList.remove("active"))}});Object.defineProperty(b,"min",{get:function(){return d},set:function(a){d=a}});Object.defineProperty(b,"max",{get:function(){return k},set:function(a){k=a}});var R,L,l=function(a){L=this==q?1:2;L!=b.active&&(b.active=L,b.dispatchEvent(u));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",E,!1);window.addEventListener("mouseup",N,!1);
R=a.clientX-(1==L?g:e)};q.addEventListener("mousedown",l,!1);s.addEventListener("mousedown",l,!1);var E=function(a){1==L?c(a.clientX-R):h(a.clientX-R);b.dispatchEvent(u)},N=function(a){window.removeEventListener("mousemove",E,!1);window.removeEventListener("mouseup",N,!1)};return b}if("undefined"!==typeof c)var p=c("./utils").makeElement;"undefined"!==typeof u&&(u.exports=l)},{"./utils":50}],54:[function(c,u,s){u=c("./promise/promise").Promise;c=c("./promise/polyfill").polyfill;s.Promise=u;s.polyfill=
c},{"./promise/polyfill":59,"./promise/promise":60}],55:[function(c,u,s){var l=c("./utils").isArray,p=c("./utils").isFunction;s.all=function(c){if(!l(c))throw new TypeError("You must pass an array to all.");return new this(function(h,l){function q(a){return function(c){s[a]=c;0===--b&&h(s)}}var s=[],b=c.length,a;0===b&&h([]);for(var n=0;n<c.length;n++)(a=c[n])&&p(a.then)?a.then(q(n),l):(s[n]=a,0===--b&&h(s))})}},{"./utils":64}],56:[function(c,u,s){(function(c,p){function r(){return function(){c.nextTick(q)}}
function h(){var a=0,d=new b(q),e=document.createTextNode("");d.observe(e,{characterData:!0});return function(){e.data=a=++a%2}}function u(){return function(){a.setTimeout(q,1)}}function q(){for(var a=0;a<n.length;a++){var b=n[a];(0,b[0])(b[1])}n=[]}var y="undefined"!==typeof window?window:{},b=y.MutationObserver||y.WebKitMutationObserver,a="undefined"!==typeof p?p:void 0===this?window:this,n=[],d;d="undefined"!==typeof c&&"[object process]"==={}.toString.call(c)?r():b?h():u();s.asap=function(a,b){1===
n.push([a,b])&&d()}}).call(this,c("/Users/pkok/repos/transmart-1.2/dalliance-plugin/web-app/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"/Users/pkok/repos/transmart-1.2/dalliance-plugin/web-app/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65}],57:[function(c,u,s){s.cast=function(c){return c&&
"object"===typeof c&&c.constructor===this?c:new this(function(p){p(c)})}},{}],58:[function(c,u,s){var l={instrument:!1};s.config=l;s.configure=function(c,r){if(2===arguments.length)l[c]=r;else return l[c]}},{}],59:[function(c,u,s){(function(l){var p=c("./promise").Promise,r=c("./utils").isFunction;s.polyfill=function(){var c;c="undefined"!==typeof l?l:"undefined"!==typeof window&&window.document?window:self;"Promise"in c&&"cast"in c.Promise&&"resolve"in c.Promise&&"reject"in c.Promise&&"all"in c.Promise&&
"race"in c.Promise&&function(){var l;new c.Promise(function(c){l=c});return r(l)}()||(c.Promise=p)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":60,"./utils":64}],60:[function(c,u,s){function l(a){if(!e(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
this._subscribers=[];p(a,this)}function p(b,d){function f(a){y(d,a)}function c(b){a(d,b)}try{b(f,c)}catch(e){c(e)}}function r(b,d,f,c){var g=e(f),h,k,l,n;if(g)try{h=f(c),l=!0}catch(p){n=!0,k=p}else h=c,l=!0;q(d,h)||(g&&l?y(d,h):n?a(d,k):b===P?y(d,h):b===x&&a(d,h))}function h(a,b,f,d){a=a._subscribers;var c=a.length;a[c]=b;a[c+P]=f;a[c+x]=d}function v(a,b){for(var f,d,c=a._subscribers,e=a._detail,g=0;g<c.length;g+=3)f=c[g],d=c[g+b],r(b,f,d,e);a._subscribers=null}function q(d,c){var f=null,h;try{if(d===
c)throw new TypeError("A promises callback cannot return that same promise.");if(g(c)&&(f=c.then,e(f)))return f.call(c,function(a){if(h)return!0;h=!0;c!==a?y(d,a):b(d,a)},function(b){if(h)return!0;h=!0;a(d,b)}),!0}catch(k){if(h)return!0;a(d,k);return!0}return!1}function y(a,d){a===d?b(a,d):q(a,d)||b(a,d)}function b(a,b){a._state===E&&(a._state=N,a._detail=b,k.async(n,a))}function a(a,b){a._state===E&&(a._state=N,a._detail=b,k.async(d,a))}function n(a){v(a,a._state=P)}function d(a){v(a,a._state=x)}
var k=c("./config").config;c("./config");var g=c("./utils").objectOrFunction,e=c("./utils").isFunction;c("./utils");u=c("./cast").cast;var t=c("./all").all,C=c("./race").race,R=c("./resolve").resolve,L=c("./reject").reject;c=c("./asap").asap;k.async=c;var E=void 0,N=0,P=1,x=2;l.prototype={constructor:l,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var f=this,d=new this.constructor(function(){});if(this._state){var c=arguments;k.async(function(){r(f._state,d,c[f._state-1],f._detail)})}else h(this,
d,a,b);return d},"catch":function(a){return this.then(null,a)}};l.all=t;l.cast=u;l.race=C;l.resolve=R;l.reject=L;s.Promise=l},{"./all":55,"./asap":56,"./cast":57,"./config":58,"./race":61,"./reject":62,"./resolve":63,"./utils":64}],61:[function(c,u,s){var l=c("./utils").isArray;s.race=function(c){if(!l(c))throw new TypeError("You must pass an array to race.");return new this(function(l,h){for(var s,q=0;q<c.length;q++)(s=c[q])&&"function"===typeof s.then?s.then(l,h):l(s)})}},{"./utils":64}],62:[function(c,
u,s){s.reject=function(c){return new this(function(p,r){r(c)})}},{}],63:[function(c,u,s){s.resolve=function(c){return new this(function(p,r){p(c)})}},{}],64:[function(c,u,s){function l(c){return"function"===typeof c}c=Date.now||function(){return(new Date).getTime()};s.objectOrFunction=function(c){return l(c)||"object"===typeof c&&null!==c};s.isFunction=l;s.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};s.now=c},{}],65:[function(c,u,s){c=u.exports={};c.nextTick=function(){if("undefined"!==
typeof window&&window.setImmediate)return function(c){return window.setImmediate(c)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var c=[];window.addEventListener("message",function(p){var r=p.source;r!==window&&null!==r||"process-tick"!==p.data||(p.stopPropagation(),0<c.length&&c.shift()())},!0);return function(p){c.push(p);window.postMessage("process-tick","*")}}return function(c){setTimeout(c,0)}}();c.title="browser";c.browser=!0;c.env={};c.argv=[];c.binding=function(c){throw Error("process.binding is not supported");
};c.cwd=function(){return"/"};c.chdir=function(c){throw Error("process.chdir is not supported");}},{}],66:[function(c,u,s){function l(){}function p(){this.was=[0]}function r(b,d,c){this.hufts=new Int32Array(3*a);this.window=new Uint8Array(c);this.end=c;this.checkfn=d;this.mode=t;this.reset(b,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new h;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new v}
function h(){}function v(){}function q(a,b,d,c,e){if(0!=e){if(!a)throw"Undef src";if(!d)throw"Undef dest";if(0==b&&e==a.length)d.set(a,c);else if(D)a=a.subarray(b,b+e),d.set(a,c);else if(1==a.BYTES_PER_ELEMENT&&100<e)a=new Uint8Array(a.buffer,a.byteOffset+b,e),d.set(a,c);else for(var g=0;g<e;++g)d[c+g]=a[b+g]}}function y(a,c,e,h){a=c?e?new Uint8Array(a,c,e):new Uint8Array(a,c,a.byteLength-c):new Uint8Array(a);e=new l;e.inflateInit(b,!0);e.next_in=a;e.next_in_index=0;e.avail_in=a.length;a=[];for(var p=
0;;){var r=new Uint8Array(32E3);e.next_out=r;e.next_out_index=0;e.avail_out=r.length;var s=e.inflate(n);if(s!=d&&s!=k&&s!=g)throw e.msg;if(0!=e.avail_out){var t=new Uint8Array(r.length-e.avail_out);q(r,0,t,0,r.length-e.avail_out);r=t}a.push(r);p+=r.length;if(s==k||s==g)break}h&&(h[0]=(c||0)+e.next_in_index);if(1==a.length)return a[0].buffer;c=new Uint8Array(p);for(e=h=0;e<a.length;++e)p=a[e],q(p,0,c,h,p.length),h+=p.length;return c.buffer}var b=15,a=1440,n=0,d=0,k=1,g=-5,e=[0,1,3,7,15,31,63,127,255,
511,1023,2047,4095,8191,16383,32767,65535],t=0,C=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,
0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,
78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,
0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,
8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,
0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,
7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,
0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],R=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,
8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],N=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,
6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];l.prototype.inflateInit=function(a,d){a||(a=b);d&&(d=!1);this.istate=new p;return this.istate.inflateInit(this,d?-a:a)};l.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};l.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};l.prototype.inflateSync=function(){return istate.inflateSync(this)};l.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,
a,b)};p.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return d};p.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return d};p.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new r(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);
return d};p.prototype.inflate=function(a,b){var c,e;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?g:d;for(c=g;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return c;
c=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=
4;case 4:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return c;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:c=a.istate.blocks.proc(a,c);if(-3==c){a.istate.mode=13;a.istate.marker=0;break}c==d&&(c=b);if(c!=k)return c;c=b;a.istate.blocks.reset(a,
a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;
case 11:if(0==a.avail_in)return c;c=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return k;case 13:return-3;default:return-2}};p.prototype.inflateSetDictionary=function(a,b,c){var e=0,g=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);g>=1<<a.istate.wbits&&
(g=(1<<a.istate.wbits)-1,e=c-g);a.istate.blocks.set_dictionary(b,e,g);a.istate.mode=7;return d};var x=[0,0,255,255];p.prototype.inflateSync=function(a){var b,c,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return g;c=a.next_in_index;for(e=a.istate.marker;0!=b&&4>e;)a.next_in[c]==x[e]?e++:e=0!=a.next_in[c]?0:4-e,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;c=
a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return d};p.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];r.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.mode=t;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};r.prototype.proc=function(a,
b){var c,g,h,l,n,p,m;l=a.next_in_index;n=a.avail_in;g=this.bitb;h=this.bitk;p=this.write;for(m=p<this.read?this.read-p-1:this.end-p;;)switch(this.mode){case t:for(;3>h;){if(0!=n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}c=g&7;this.last=c&1;switch(c>>>1){case 0:g>>>=3;h-=3;c=h&7;g>>>=c;h-=c;this.mode=1;break;case 1:var r=new Int32Array(1),s=new Int32Array(1),u=[],v=[];
c=s;var x=u,y=v;r[0]=9;c[0]=5;x[0]=C;y[0]=R;this.codes.init(r[0],s[0],u[0],0,v[0],0,a);g>>>=3;h-=3;this.mode=6;break;case 2:g>>>=3;h-=3;this.mode=3;break;case 3:return g>>>=3,h-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b)}break;case 1:for(;32>h;){if(0!=n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,
b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}if((~g>>>16&65535)!=(g&65535))return this.mode=13,a.msg="invalid stored block lengths",b=-3,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);this.left=g&65535;g=h=0;this.mode=0!=this.left?2:0!=this.last?7:t;break;case 2:if(0==n)return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);if(0==m&&(p==end&&0!=read&&(p=0,m=p<this.read?
this.read-p-1:this.end-p),0==m&&(this.write=p,b=this.inflate_flush(a,b),p=this.write,m=p<this.read?this.read-p-1:this.end-p,p==this.end&&0!=this.read&&(p=0,m=p<this.read?this.read-p-1:this.end-p),0==m)))return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);b=d;c=this.left;c>n&&(c=n);c>m&&(c=m);q(a.next_in,l,this.window,p,c);l+=c;n-=c;p+=c;m-=c;if(0!=(this.left-=c))break;this.mode=0!=this.last?7:t;break;case 3:for(;14>h;){if(0!=
n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}this.table=c=g&16383;if(29<(c&31)||29<(c>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);c=258+(c&31)+(c>>5&31);if(null==this.blens||this.blens.length<c)this.blens=new Int32Array(c);
else for(m=0;m<c;m++)this.blens[m]=0;g>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}this.blens[H[this.index++]]=g&7;g>>>=3;h-=3}for(;19>this.index;)this.blens[H[this.index++]]=0;this.bb[0]=7;c=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(c!=d)return b=
c,-3==b&&(this.blens=null,this.mode=9),this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,write=p,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){c=this.table;if(!(this.index<258+(c&31)+(c>>5&31)))break;for(c=this.bb[0];h<c;){if(0!=n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}c=this.hufts[3*(this.tb[0]+(g&e[c]))+1];s=this.hufts[3*
(this.tb[0]+(g&e[c]))+2];if(16>s)g>>>=c,h-=c,this.blens[this.index++]=s;else{m=18==s?7:s-14;for(r=18==s?11:3;h<c+m;){if(0!=n)b=d;else return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);n--;g|=(a.next_in[l++]&255)<<h;h+=8}g>>>=c;h-=c;r+=g&e[m];g>>>=m;h-=m;m=this.index;c=this.table;if(m+r>258+(c&31)+(c>>5&31)||16==s&&1>m)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=g,this.bitk=h,a.avail_in=
n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);s=16==s?this.blens[m-1]:0;do this.blens[m++]=s;while(0!=--r);this.index=m}}this.tb[0]=-1;r=new Int32Array(1);s=new Int32Array(1);u=new Int32Array(1);v=new Int32Array(1);r[0]=9;s[0]=6;c=this.table;c=this.inftree.inflate_trees_dynamic(257+(c&31),1+(c>>5&31),this.blens,r,s,u,v,this.hufts,a);if(c!=d)return-3==c&&(this.blens=null,this.mode=13),b=c,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=
l,this.write=p,this.inflate_flush(a,b);this.codes.init(r[0],s[0],this.hufts,u[0],this.hufts,v[0],a);this.mode=6;case 6:this.bitb=g;this.bitk=h;a.avail_in=n;a.total_in+=l-a.next_in_index;a.next_in_index=l;this.write=p;if((b=this.codes.proc(this,a,b))!=k)return this.inflate_flush(a,b);b=d;this.codes.free(a);l=a.next_in_index;n=a.avail_in;g=this.bitb;h=this.bitk;p=this.write;m=p<this.read?this.read-p-1:this.end-p;if(0==this.last){this.mode=t;break}this.mode=7;case 7:this.write=p;b=this.inflate_flush(a,
b);p=this.write;if(this.read!=this.write)return this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);mode=12;case 8:return b=k,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);case 9:return b=-3,this.bitb=g,this.bitk=h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b);default:return b=-2,this.bitb=g,this.bitk=
h,a.avail_in=n,a.total_in+=l-a.next_in_index,a.next_in_index=l,this.write=p,this.inflate_flush(a,b)}};r.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};r.prototype.set_dictionary=function(a,b,c){q(a,b,window,0,c);this.read=this.write=c};r.prototype.sync_point=function(){return 1==this.mode};r.prototype.inflate_flush=function(a,b){var c,e,h;e=a.next_out_index;h=this.read;c=(h<=this.write?this.write:this.end)-h;c>a.avail_out&&(c=a.avail_out);0!=c&&b==g&&(b=d);a.avail_out-=
c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,h,c));q(this.window,h,a.next_out,e,c);e+=c;h+=c;h==this.end&&(h=0,this.write==this.end&&(this.write=0),c=this.write-h,c>a.avail_out&&(c=a.avail_out),0!=c&&b==g&&(b=d),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,h,c)),q(this.window,h,a.next_out,e,c),e+=c,h+=c);a.next_out_index=e;this.read=h;return b};h.prototype.init=function(a,b,c,d,e,g,
h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=g;this.tree=null};h.prototype.proc=function(a,b,c){var g,h,l=0,n=0,p=0,m,q,r,p=b.next_in_index;m=b.avail_in;l=a.bitb;n=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=m&&(a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,c=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,
a,b),p=b.next_in_index,m=b.avail_in,l=a.bitb,n=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,c!=d)){this.mode=c==k?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(g=this.need;n<g;){if(0!=m)c=d;else return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);m--;l|=(b.next_in[p++]&255)<<n;n+=8}g=3*(this.tree_index+(l&e[g]));l>>>=this.tree[g+1];n-=this.tree[g+1];h=this.tree[g];if(0==
h){this.lit=this.tree[g+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[g+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=g/3+this.tree[g+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";c=-3;a.bitb=l;a.bitk=n;b.avail_in=m;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,c);case 2:for(g=this.get;n<g;){if(0!=m)c=d;else return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=
p,a.write=q,a.inflate_flush(b,c);m--;l|=(b.next_in[p++]&255)<<n;n+=8}this.len+=l&e[g];l>>=g;n-=g;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(g=this.need;n<g;){if(0!=m)c=d;else return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);m--;l|=(b.next_in[p++]&255)<<n;n+=8}g=3*(this.tree_index+(l&e[g]));l>>=this.tree[g+1];n-=this.tree[g+1];h=this.tree[g];if(0!=(h&16)){this.get=h&15;this.dist=
this.tree[g+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=g/3+this.tree[g+2];break}this.mode=9;b.msg="invalid distance code";c=-3;a.bitb=l;a.bitk=n;b.avail_in=m;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,c);case 4:for(g=this.get;n<g;){if(0!=m)c=d;else return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);m--;l|=(b.next_in[p++]&255)<<n;n+=8}this.dist+=l&e[g];l>>=g;n-=g;this.mode=
5;case 5:for(g=q-this.dist;0>g;)g+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);a.window[q++]=a.window[g++];r--;g==a.end&&(g=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&
(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,c=a.inflate_flush(b,c),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);c=d;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<n&&(n-=8,m++,p--);a.write=q;c=a.inflate_flush(b,c);q=a.write;if(a.read!=a.write)return a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,
b.next_in_index=p,a.write=q,a.inflate_flush(b,c);this.mode=8;case 8:return c=k,a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);case 9:return c=-3,a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c);default:return c=-2,a.bitb=l,a.bitk=n,b.avail_in=m,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,c)}};h.prototype.free=function(a){};h.prototype.inflate_fast=
function(a,b,c,g,h,l,n,p){var m,r,s,t,u,v,x,y,C,E,D,H;v=p.next_in_index;x=p.avail_in;t=n.bitb;u=n.bitk;y=n.write;C=y<n.read?n.read-y-1:n.end-y;a=e[a];E=e[b];do{for(;20>u;)x--,t|=(p.next_in[v++]&255)<<u,u+=8;m=t&a;r=c;s=g;H=3*(s+m);if(0==(b=r[H]))t>>=r[H+1],u-=r[H+1],n.window[y++]=r[H+2],C--;else{do{t>>=r[H+1];u-=r[H+1];if(0!=(b&16)){b&=15;D=r[H+2]+(t&e[b]);t>>=b;for(u-=b;15>u;)x--,t|=(p.next_in[v++]&255)<<u,u+=8;m=t&E;r=h;s=l;H=3*(s+m);b=r[H];do if(t>>=r[H+1],u-=r[H+1],0!=(b&16)){for(b&=15;u<b;)x--,
t|=(p.next_in[v++]&255)<<u,u+=8;m=r[H+2]+(t&e[b]);t>>=b;u-=b;C-=D;if(y>=m)m=y-m,n.window[y++]=n.window[m++],n.window[y++]=n.window[m++],D-=2;else{m=y-m;do m+=n.end;while(0>m);b=n.end-m;if(D>b){D-=b;if(0<y-m&&b>y-m){do n.window[y++]=n.window[m++];while(0!=--b)}else q(n.window,m,n.window,y,b),y+=b;m=0}}do n.window[y++]=n.window[m++];while(0!=--D);break}else if(0==(b&64))m+=r[H+2],m+=t&e[b],H=3*(s+m),b=r[H];else return p.msg="invalid distance code",D=p.avail_in-x,D=u>>3<D?u>>3:D,x+=D,v-=D,u-=D<<3,n.bitb=
t,n.bitk=u,p.avail_in=x,p.total_in+=v-p.next_in_index,p.next_in_index=v,n.write=y,-3;while(1);break}if(0==(b&64)){if(m+=r[H+2],m+=t&e[b],H=3*(s+m),0==(b=r[H])){t>>=r[H+1];u-=r[H+1];n.window[y++]=r[H+2];C--;break}}else{if(0!=(b&32))return D=p.avail_in-x,D=u>>3<D?u>>3:D,x+=D,v-=D,u-=D<<3,n.bitb=t,n.bitk=u,p.avail_in=x,p.total_in+=v-p.next_in_index,p.next_in_index=v,n.write=y,k;p.msg="invalid literal/length code";D=p.avail_in-x;D=u>>3<D?u>>3:D;x+=D;v-=D;u-=D<<3;n.bitb=t;n.bitk=u;p.avail_in=x;p.total_in+=
v-p.next_in_index;p.next_in_index=v;n.write=y;return-3}}while(1)}}while(258<=C&&10<=x);D=p.avail_in-x;D=u>>3<D?u>>3:D;v-=D;n.bitb=t;n.bitk=u-(D<<3);p.avail_in=x+D;p.total_in+=v-p.next_in_index;p.next_in_index=v;n.write=y;return d};v.prototype.huft_build=function(b,c,e,h,k,l,n,p,m,r,s){var u,t,v,x,y,C,D,E,H;C=0;t=e;do this.c[b[c+C]]++,C++,t--;while(0!=t);if(this.c[0]==e)return n[0]=-1,p[0]=0,d;y=p[0];for(v=1;15>=v&&0==this.c[v];v++);x=v;y<v&&(y=v);for(t=15;0!=t&&0==this.c[t];t--);r=t;y>t&&(y=t);p[0]=
y;for(p=1<<v;v<t;v++,p<<=1)if(0>(p-=this.c[v]))return-3;if(0>(p-=this.c[t]))return-3;this.c[t]+=p;this.x[1]=v=0;C=1;for(D=2;0!=--t;)this.x[D]=v+=this.c[C],D++,C++;C=t=0;do 0!=(v=b[c+C])&&(this.v[this.x[v]++]=t),C++;while(++t<e);e=this.x[r];C=this.x[0]=t=0;c=-1;E=-y;for(H=D=this.u[0]=0;x<=r;x++)for(b=this.c[x];0!=b--;){for(;x>E+y;){c++;E+=y;H=r-E;H=H>y?y:H;if((u=1<<(v=x-E))>b+1&&(u-=b+1,D=x,v<H))for(;++v<H&&!((u<<=1)<=this.c[++D]);)u-=this.c[D];H=1<<v;if(this.hn[0]+H>a)return-3;this.u[c]=D=this.hn[0];
this.hn[0]+=H;0!=c?(this.x[c]=t,this.r[0]=v,this.r[1]=y,v=t>>>E-y,this.r[2]=D-this.u[c-1]-v,q(this.r,0,m,3*(this.u[c-1]+v),3)):n[0]=D}this.r[1]=x-E;C>=e?this.r[0]=192:s[C]<h?(this.r[0]=256>this.v[C]?0:96,this.r[2]=this.v[C++]):(this.r[0]=l[this.v[C]-h]+16+64,this.r[2]=k[this.v[C++]-h]);u=1<<x-E;for(v=t>>>E;v<H;v+=u)q(this.r,0,m,3*(D+v),3);for(v=1<<x-1;0!=(t&v);v>>>=1)t^=v;t^=v;for(v=(1<<E)-1;(t&v)!=this.x[c];)c--,E-=y,v=(1<<E)-1}return 0!=p&&1!=r?g:d};v.prototype.inflate_trees_bits=function(a,b,c,
d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)e.msg="oversubscribed dynamic bit lengths tree";else if(a==g||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=-3;return a};v.prototype.inflate_trees_dynamic=function(a,b,c,e,h,k,l,n,m){this.initWorkArea(288);this.hn[0]=0;k=this.huft_build(c,0,a,257,L,E,k,e,n,this.hn,this.v);if(k!=d||0==e[0])return-3==k?m.msg="oversubscribed literal/length tree":-4!=k&&(m.msg="incomplete literal/length tree",
k=-3),k;this.initWorkArea(288);k=this.huft_build(c,a,b,0,N,P,l,h,n,this.hn,this.v);return k!=d||0==h[0]&&257<a?(-3==k?m.msg="oversubscribed distance tree":k==g?(m.msg="incomplete distance tree",k=-3):-4!=k&&(m.msg="empty distance tree with lengths",k=-3),k):d};v.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));
for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;q(this.c,0,this.u,0,15);q(this.c,0,this.x,0,16)};var D="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof u&&(u.exports={inflateBuffer:y,arrayCopy:q})},{}]},{},[17]);
